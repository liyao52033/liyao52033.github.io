(window.webpackJsonp=window.webpackJsonp||[]).push([[58],{571:function(a,t,s){"use strict";s.r(t);var r=s(4),p=Object(r.a)({},(function(){var a=this,t=a._self._c;return t("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[t("p",[a._v("经常会遇到一些断点相关的问题，比如：")]),a._v(" "),t("ol",[t("li",[a._v("在文件里打的断点是灰的，一直不生效")]),a._v(" "),t("li",[a._v("断点断在了奇怪的文件和位置")])]),a._v(" "),t("p",[a._v("不知道什么原因导致的，该怎么解决。")]),a._v(" "),t("p",[a._v("这是因为不清楚 VSCode Debugger 里打的断点是怎么在网页里生效的。")]),a._v(" "),t("h2",{attrs:{id:"断点映射的原理"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#断点映射的原理"}},[a._v("#")]),a._v(" 断点映射的原理")]),a._v(" "),t("p",[a._v("我们在 VSCode 里打的断点是这样的：")]),a._v(" "),t("p",[t("img",{staticClass:"lazy",attrs:{alt:"img","data-src":"https://img.xiaoying.org.cn/img/202401141615791.png",loading:"lazy"}})]),a._v(" "),t("p",[a._v("VSCode 会记录你在哪个文件哪行打了个断点。")]),a._v(" "),t("p",[a._v("在 breakpoints 这里可以看到：")]),a._v(" "),t("p",[t("img",{staticClass:"lazy",attrs:{alt:"img","data-src":"https://img.xiaoying.org.cn/img/202401141615875.png",loading:"lazy"}})]),a._v(" "),t("p",[a._v("代码经过编译打包之后，可能会产生一个 bundle.js，网页里运行的是这个 js 文件：")]),a._v(" "),t("p",[t("img",{staticClass:"lazy",attrs:{alt:"img","data-src":"https://img.xiaoying.org.cn/img/202401141615766.png",loading:"lazy"}})]),a._v(" "),t("p",[a._v("我们打的断点最终还是在代码的运行时，也就是网页里断住的，所以在 VSCode 里打的断点会被传递给浏览器，通过 CDP 调试协议。")]),a._v(" "),t("p",[a._v("但是问题来了，我们本地打的断点是一个绝对路径，也就是包含 ${workspaceFolder} 的路径，而网页里根本没有这个路径，那怎么断住的呢？")]),a._v(" "),t("p",[a._v("这是因为有的文件是关联了 sourcemap 的，也就是文件末尾的这行注释：")]),a._v(" "),t("p",[t("img",{staticClass:"lazy",attrs:{alt:"img","data-src":"https://img.xiaoying.org.cn/img/202401141615848.png",loading:"lazy"}})]),a._v(" "),t("p",[a._v("它会把文件路径映射到源码路径。")]),a._v(" "),t("p",[a._v("如果映射到的源码路径直接就是本地的文件路径，那不就对上了么，那断点就生效了：")]),a._v(" "),t("p",[t("img",{staticClass:"lazy",attrs:{alt:"img","data-src":"https://img.xiaoying.org.cn/img/202401141615945.png",loading:"lazy"}})]),a._v(" "),t("p",[a._v("vite 的项目，sourcemap 都是这种绝对路径，所以断点直接就生效了。")]),a._v(" "),t("p",[t("img",{staticClass:"lazy",attrs:{alt:"img","data-src":"https://img.xiaoying.org.cn/img/202401141615419.png",loading:"lazy"}})]),a._v(" "),t("p",[a._v("但是 webpack 的项目，sourcemap 到的路径不是绝对路径，而是这种：")]),a._v(" "),t("p",[t("img",{staticClass:"lazy",attrs:{alt:"img","data-src":"https://img.xiaoying.org.cn/img/202401141615784.png",loading:"lazy"}})]),a._v(" "),t("p",[a._v("或者这种：")]),a._v(" "),t("p",[t("img",{staticClass:"lazy",attrs:{alt:"img","data-src":"https://img.xiaoying.org.cn/img/202401141615787.png",loading:"lazy"}})]),a._v(" "),t("p",[a._v("那怎么办呢？本地打的断点都是绝对路径，而 sourcemap 到的路径不是绝对路径，根本打不上呀！")]),a._v(" "),t("p",[a._v("所以 VSCode Chrome Debugger 支持了 sourceMapPathOverrides 的配置：")]),a._v(" "),t("div",{staticClass:"language-json line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-json"}},[t("code",[a._v(" "),t("span",{pre:!0,attrs:{class:"token property"}},[a._v('"sourceMapPathOverrides"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n   "),t("span",{pre:!0,attrs:{class:"token property"}},[a._v('"meteor://app/*"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"${workspaceFolder}/*"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v("\n   "),t("span",{pre:!0,attrs:{class:"token property"}},[a._v('"webpack:///./~/*"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"${webRoot}/node_modules/*"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v("\n   "),t("span",{pre:!0,attrs:{class:"token property"}},[a._v('"webpack://?:*/*"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"${webRoot}/*"')]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v("\n")])]),a._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[a._v("1")]),t("br"),t("span",{staticClass:"line-number"},[a._v("2")]),t("br"),t("span",{staticClass:"line-number"},[a._v("3")]),t("br"),t("span",{staticClass:"line-number"},[a._v("4")]),t("br"),t("span",{staticClass:"line-number"},[a._v("5")]),t("br")])]),t("p",[a._v("这是默认生成的三个配置，最后一个就是映射 webpack 路径的，其实是把以 ${workspaceFolder} 开头的本地路径映射成了 webpack:// 开头的路径传给浏览器。")]),a._v(" "),t("p",[t("img",{staticClass:"lazy",attrs:{alt:"img","data-src":"https://img.xiaoying.org.cn/img/202401141615949.png",loading:"lazy"}})]),a._v(" "),t("p",[a._v("这样就和浏览器里的 sourcemap 后的文件路径对上了，那断点也就生效了。")]),a._v(" "),t("p",[t("img",{staticClass:"lazy",attrs:{alt:"img","data-src":"https://img.xiaoying.org.cn/img/202401141615012.png",loading:"lazy"}})]),a._v(" "),t("p",[a._v("这就是为什么调试 webpack 项目的时候要配置 sourceMapPathOverrides。")]),a._v(" "),t("p",[a._v("具体怎么配，你可以加个 debugger 看看 Chrome DevTools 里是啥路径，然后映射到本地的路径就行。")]),a._v(" "),t("p",[a._v("React 和 Vue3 项目不用单独配置这个，用默认的那个配置就行。")]),a._v(" "),t("p",[a._v("Vue2 项目需要配一下这样的配置：")]),a._v(" "),t("p",[t("img",{staticClass:"lazy",attrs:{alt:"img","data-src":"https://img.xiaoying.org.cn/img/202401141615482.png",loading:"lazy"}})]),a._v(" "),t("p",[a._v("或者这样的配置：")]),a._v(" "),t("p",[t("img",{staticClass:"lazy",attrs:{alt:"img","data-src":"https://img.xiaoying.org.cn/img/202401141615488.png",loading:"lazy"}})]),a._v(" "),t("p",[a._v("都是为了让打断点的文件路径和 sourcemap 之后的文件路径对上。")]),a._v(" "),t("p",[a._v("但上面都是把项目根目录（workspaceFolder） 映射到 url 的 / 的，有的时候映射的不是 /，会出现这种情况：")]),a._v(" "),t("p",[t("img",{staticClass:"lazy",attrs:{alt:"img","data-src":"https://img.xiaoying.org.cn/img/202401141615885.png",loading:"lazy"}})]),a._v(" "),t("p",[a._v("这就需要 webRoot 的配置了，默认是 workspaceFolder：")]),a._v(" "),t("p",[t("img",{staticClass:"lazy",attrs:{alt:"img","data-src":"https://img.xiaoying.org.cn/img/202401141615752.png",loading:"lazy"}})]),a._v(" "),t("p",[a._v("也就是把项目根目录映射到 url 的 /。")]),a._v(" "),t("p",[a._v("如果出现这种情况，说明要把 /mobile/js/ 这个路径映射到项目根目录：")]),a._v(" "),t("p",[t("img",{staticClass:"lazy",attrs:{alt:"img","data-src":"https://img.xiaoying.org.cn/img/202401141615767.png",loading:"lazy"}})]),a._v(" "),t("p",[a._v("所以要配置下 webRoot")]),a._v(" "),t("p",[t("img",{staticClass:"lazy",attrs:{alt:"img","data-src":"https://img.xiaoying.org.cn/img/202401141615847.png",loading:"lazy"}})]),a._v(" "),t("p",[a._v("综上，"),t("strong",[a._v("如果 sourcemap 到的文件路径不是本地路径，那就映射不到本地文件，导致断点打不上，这时候可以配置下 sourceMapPathOverrides。如果映射之后路径开头多了几层目录，那就要配置下 webRoot。")])]),a._v(" "),t("p",[a._v("那上节讲 vite + vue 项目的调试的时候，我们配置了 webRoot 为 ${workspaceFolder}/aaa，aaa 可以是任意一个本地不存在的目录，这是为什么呢？")]),a._v(" "),t("p",[a._v("因为 Vite 项目有一些热更的文件，这些临时文件没有对应的本地文件，但路径刚好是 VSCode Debugger 传递过去的打断点的文件路径，就断住了，所以你就会发现断点断在了奇怪的文件：")]),a._v(" "),t("p",[t("img",{staticClass:"lazy",attrs:{alt:"img","data-src":"https://img.xiaoying.org.cn/img/202401141616284.png",loading:"lazy"}})]),a._v(" "),t("p",[a._v("为了避免这种情况，我们配置了 webRoot，那实际上传过去的断点信息就是 /aaa/src/App.vue。")]),a._v(" "),t("p",[a._v("这样热更的文件和这个路径就不一样了，也就不会断住。")]),a._v(" "),t("p",[a._v("而有 sourcemap 的文件，因为 sourcemap 到的是绝对路径，不受 webRoot 的影响，依然能映射到本地，所以那些断点能生效。")]),a._v(" "),t("p",[a._v("这就是为什么调试 vite 项目要配置下 webRoot，加上一个本地不存在的目录。")]),a._v(" "),t("h2",{attrs:{id:"总结"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#总结"}},[a._v("#")]),a._v(" 总结")]),a._v(" "),t("p",[a._v("在本地文件打的断点会通过 CDP 传给 Chrome，如果路径和 sourcemap 到的文件匹配，那断点就能生效。")]),a._v(" "),t("p",[a._v("如果不匹配，可以设置下 sourceMapPathOverrides 做下映射。")]),a._v(" "),t("p",[a._v("如果前面多了一段路径，可以配置下 webRoot。")]),a._v(" "),t("p",[a._v("在 vite 项目里，热更文件也会在本地文件打断点的那行断住，为了避免这种情况，我们配了下 webRoot。")]),a._v(" "),t("p",[a._v("理解了 VSCode Chrome Debugger 断点映射的原理，就能解释为什么有时候断点没生效，有时候断点断在奇怪的位置了。")])])}),[],!1,null,null,null);t.default=p.exports}}]);