<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>模板生成工具 | 编程随笔</title>
    <meta name="generator" content="VuePress 1.9.10">
    <link rel="icon" href="/img/logo.png">
    <link rel="stylesheet" href="//at.alicdn.com/t/font_3114978_qe0b39no76.css">
    <link rel="stylesheet" href="//at.alicdn.com/t/font_3077305_pt8umhrn4k9.css">
    <link rel="stylesheet" href="//at.alicdn.com/t/c/font_4397361_l7w8pg1gfn.css">
    <link rel="stylesheet" href="//at.alicdn.com/t/font_3114978_qe0b39no76.css">
    <meta name="description" content="编程随笔">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="referrer" content="no-referrer-when-downgrade">
    <meta name="keywords" content="编程随笔">
    <meta content="编程随笔" property="og:title">
    
    <link rel="preload" href="/assets/css/0.styles.e2f96c8e.css" as="style"><link rel="preload" href="/assets/js/app.0e4893f0.js" as="script"><link rel="preload" href="/assets/js/3.68e95ad6.js" as="script"><link rel="preload" href="/assets/js/2.56a7fb29.js" as="script"><link rel="preload" href="/assets/js/102.e765a012.js" as="script"><link rel="preload" href="/assets/js/25.571f3d43.js" as="script"><link rel="preload" href="/assets/js/45.ab1d84cf.js" as="script"><link rel="preload" href="/assets/js/44.6f56586a.js" as="script"><link rel="prefetch" href="/assets/js/1.ef8116a0.js"><link rel="prefetch" href="/assets/js/10.b7f88af7.js"><link rel="prefetch" href="/assets/js/100.3d7af52e.js"><link rel="prefetch" href="/assets/js/101.74a03766.js"><link rel="prefetch" href="/assets/js/103.51488b9f.js"><link rel="prefetch" href="/assets/js/104.263faaec.js"><link rel="prefetch" href="/assets/js/105.a1a206f3.js"><link rel="prefetch" href="/assets/js/106.b33eed10.js"><link rel="prefetch" href="/assets/js/107.9c371cef.js"><link rel="prefetch" href="/assets/js/108.1ce5ed94.js"><link rel="prefetch" href="/assets/js/109.f630eea5.js"><link rel="prefetch" href="/assets/js/11.faee59f4.js"><link rel="prefetch" href="/assets/js/110.00266b44.js"><link rel="prefetch" href="/assets/js/111.09a2c6db.js"><link rel="prefetch" href="/assets/js/112.d97cd154.js"><link rel="prefetch" href="/assets/js/113.e45a2bd2.js"><link rel="prefetch" href="/assets/js/114.9ea73cb3.js"><link rel="prefetch" href="/assets/js/115.e07a67af.js"><link rel="prefetch" href="/assets/js/116.ac66d3a2.js"><link rel="prefetch" href="/assets/js/117.6fe61452.js"><link rel="prefetch" href="/assets/js/118.d289c1ce.js"><link rel="prefetch" href="/assets/js/119.6b5d1f61.js"><link rel="prefetch" href="/assets/js/12.bacd53f3.js"><link rel="prefetch" href="/assets/js/120.717a0fe5.js"><link rel="prefetch" href="/assets/js/121.5f9db4a5.js"><link rel="prefetch" href="/assets/js/122.fd551826.js"><link rel="prefetch" href="/assets/js/123.08694ea4.js"><link rel="prefetch" href="/assets/js/124.489aa0ec.js"><link rel="prefetch" href="/assets/js/125.d66d836f.js"><link rel="prefetch" href="/assets/js/126.ce1f16d6.js"><link rel="prefetch" href="/assets/js/127.c052eebf.js"><link rel="prefetch" href="/assets/js/128.ea22cbd1.js"><link rel="prefetch" href="/assets/js/129.ce25db30.js"><link rel="prefetch" href="/assets/js/13.690ea45f.js"><link rel="prefetch" href="/assets/js/130.3ee794cc.js"><link rel="prefetch" href="/assets/js/131.e5020a3d.js"><link rel="prefetch" href="/assets/js/132.963afdf1.js"><link rel="prefetch" href="/assets/js/133.dea4c0b0.js"><link rel="prefetch" href="/assets/js/134.676e9f0f.js"><link rel="prefetch" href="/assets/js/135.7d732b20.js"><link rel="prefetch" href="/assets/js/136.c5548b0c.js"><link rel="prefetch" href="/assets/js/137.616c0ed7.js"><link rel="prefetch" href="/assets/js/138.e315e008.js"><link rel="prefetch" href="/assets/js/139.0ed71a3e.js"><link rel="prefetch" href="/assets/js/14.32a83c78.js"><link rel="prefetch" href="/assets/js/140.624f1154.js"><link rel="prefetch" href="/assets/js/141.2fb402e8.js"><link rel="prefetch" href="/assets/js/142.b9222f76.js"><link rel="prefetch" href="/assets/js/15.e7f41ace.js"><link rel="prefetch" href="/assets/js/16.4c34058c.js"><link rel="prefetch" href="/assets/js/17.4ee973ef.js"><link rel="prefetch" href="/assets/js/18.4537b4a1.js"><link rel="prefetch" href="/assets/js/19.b1adfa2e.js"><link rel="prefetch" href="/assets/js/20.2d2f5ec0.js"><link rel="prefetch" href="/assets/js/21.8c620069.js"><link rel="prefetch" href="/assets/js/22.abaca844.js"><link rel="prefetch" href="/assets/js/23.4bcd1d44.js"><link rel="prefetch" href="/assets/js/24.8038f950.js"><link rel="prefetch" href="/assets/js/26.9baa02cc.js"><link rel="prefetch" href="/assets/js/27.52bd5feb.js"><link rel="prefetch" href="/assets/js/28.4a8f2ea4.js"><link rel="prefetch" href="/assets/js/29.c5f230a2.js"><link rel="prefetch" href="/assets/js/30.0a9772e9.js"><link rel="prefetch" href="/assets/js/31.cf2ecd3c.js"><link rel="prefetch" href="/assets/js/32.fd6ebf8f.js"><link rel="prefetch" href="/assets/js/33.2d6f3e77.js"><link rel="prefetch" href="/assets/js/34.238bd5cd.js"><link rel="prefetch" href="/assets/js/35.ce5398c3.js"><link rel="prefetch" href="/assets/js/36.eb2c8d91.js"><link rel="prefetch" href="/assets/js/37.c3dd8455.js"><link rel="prefetch" href="/assets/js/38.326b72b6.js"><link rel="prefetch" href="/assets/js/39.f3716d7d.js"><link rel="prefetch" href="/assets/js/4.ca954612.js"><link rel="prefetch" href="/assets/js/40.7bacb629.js"><link rel="prefetch" href="/assets/js/41.ffa6db35.js"><link rel="prefetch" href="/assets/js/42.3e7e3b5b.js"><link rel="prefetch" href="/assets/js/43.67e6acc0.js"><link rel="prefetch" href="/assets/js/46.dd0f6b4c.js"><link rel="prefetch" href="/assets/js/47.83dbcc61.js"><link rel="prefetch" href="/assets/js/48.2adf391b.js"><link rel="prefetch" href="/assets/js/49.31016c50.js"><link rel="prefetch" href="/assets/js/5.af4b6d4f.js"><link rel="prefetch" href="/assets/js/50.fbd7b6ec.js"><link rel="prefetch" href="/assets/js/51.1378d432.js"><link rel="prefetch" href="/assets/js/52.c6d9a98a.js"><link rel="prefetch" href="/assets/js/53.55299c1d.js"><link rel="prefetch" href="/assets/js/54.ec81ce2a.js"><link rel="prefetch" href="/assets/js/55.b9f65aa8.js"><link rel="prefetch" href="/assets/js/56.e3c39f51.js"><link rel="prefetch" href="/assets/js/57.7eaa6987.js"><link rel="prefetch" href="/assets/js/58.d724256d.js"><link rel="prefetch" href="/assets/js/59.65e97ab7.js"><link rel="prefetch" href="/assets/js/6.4fff4874.js"><link rel="prefetch" href="/assets/js/60.79314c0f.js"><link rel="prefetch" href="/assets/js/61.a42c827d.js"><link rel="prefetch" href="/assets/js/62.4ed4bba8.js"><link rel="prefetch" href="/assets/js/63.c1778f4e.js"><link rel="prefetch" href="/assets/js/64.06cb129d.js"><link rel="prefetch" href="/assets/js/65.ffd81066.js"><link rel="prefetch" href="/assets/js/66.41520bd5.js"><link rel="prefetch" href="/assets/js/67.278ad307.js"><link rel="prefetch" href="/assets/js/68.a3d17362.js"><link rel="prefetch" href="/assets/js/69.63562ca7.js"><link rel="prefetch" href="/assets/js/70.bf311b4b.js"><link rel="prefetch" href="/assets/js/71.f689cfa1.js"><link rel="prefetch" href="/assets/js/72.1d975c5d.js"><link rel="prefetch" href="/assets/js/73.a27435c6.js"><link rel="prefetch" href="/assets/js/74.f5e8c8c9.js"><link rel="prefetch" href="/assets/js/75.ece2eb52.js"><link rel="prefetch" href="/assets/js/76.3195e6d1.js"><link rel="prefetch" href="/assets/js/77.f6b2d8ef.js"><link rel="prefetch" href="/assets/js/78.fd11a6bf.js"><link rel="prefetch" href="/assets/js/79.2e2437ad.js"><link rel="prefetch" href="/assets/js/80.8f38edbb.js"><link rel="prefetch" href="/assets/js/81.9bd5b23c.js"><link rel="prefetch" href="/assets/js/82.4c5327f8.js"><link rel="prefetch" href="/assets/js/83.fffee18e.js"><link rel="prefetch" href="/assets/js/84.4b9c8db9.js"><link rel="prefetch" href="/assets/js/85.ee448df3.js"><link rel="prefetch" href="/assets/js/86.bb57ceff.js"><link rel="prefetch" href="/assets/js/87.5a9aa391.js"><link rel="prefetch" href="/assets/js/88.4f9f8388.js"><link rel="prefetch" href="/assets/js/89.57f8cacf.js"><link rel="prefetch" href="/assets/js/90.4334b210.js"><link rel="prefetch" href="/assets/js/91.dd030b91.js"><link rel="prefetch" href="/assets/js/92.29ed5a98.js"><link rel="prefetch" href="/assets/js/93.4fc6381a.js"><link rel="prefetch" href="/assets/js/94.fba294a0.js"><link rel="prefetch" href="/assets/js/95.2ebcb9a6.js"><link rel="prefetch" href="/assets/js/96.537457a5.js"><link rel="prefetch" href="/assets/js/97.268e50f0.js"><link rel="prefetch" href="/assets/js/98.9323c5b2.js"><link rel="prefetch" href="/assets/js/99.8e97fec6.js"><link rel="prefetch" href="/assets/js/vendors~docs-searchbar.1d46a9b6.js"><link rel="prefetch" href="/assets/js/vendors~docsearch.09dae32d.js">
    <link rel="stylesheet" href="/assets/css/0.styles.e2f96c8e.css">
  </head>
  <body class="theme-mode-light">
    <div id="app" data-server-rendered="true"><div class="theme-container sidebar-open have-rightmenu have-body-img"><header class="navbar blur"><div title="目录" class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/img/logo.png" alt="编程随笔" class="logo"> <span class="site-name can-hide">编程随笔</span></a> <div class="links"><form id="search-form" role="search" class="meilisearch-search-wrapper search-box theme-false"><input id="meilisearch-search-input" class="search-query"></form> <nav class="nav-links can-hide"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="编程" class="dropdown-title"><!----> <span class="title" style="display:;">编程</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/7765ba/" class="nav-link">前端</a></li><li class="dropdown-item"><!----> <a href="/pages/17352a/" class="nav-link">后端</a></li><li class="dropdown-item"><!----> <a href="/pages/31c4d3/" class="nav-link">嵌入式</a></li><li class="dropdown-item"><!----> <a href="/pages/cf83bf/" class="nav-link">python</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="项目实战" class="dropdown-title"><!----> <span class="title" style="display:;">项目实战</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/7a1d12/" class="nav-link">星球项目</a></li><li class="dropdown-item"><!----> <a href="/pages/91eb9e/" class="nav-link">开源项目</a></li></ul></div></div><div class="nav-item"><a href="/pages/a5da02/" class="nav-link">工具类</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Github" class="dropdown-title"><!----> <span class="title" style="display:;">Github</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>项目仓库</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="https://github.com/liyao52033/liyao52033.github.io" target="_blank" rel="noopener noreferrer" class="nav-link external">
  部署仓库
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-subitem"><a href="https://github.com/liyao52033/vuepress-default" target="_blank" rel="noopener noreferrer" class="nav-link external">
  代码仓库
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></li><li class="dropdown-item"><h4>vuepress插件</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="https://github.com/shanyuhai123/vuepress-plugin-auto-sidebar" target="_blank" rel="noopener noreferrer" class="nav-link external">
  自动生成导航栏与侧边栏
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-subitem"><a href="https://github.com/dongyuanxin/vuepress-plugin-comment" target="_blank" rel="noopener noreferrer" class="nav-link external">
  评论系统
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-subitem"><a href="https://github.com/meilisearch/vuepress-plugin-meilisearch" target="_blank" rel="noopener noreferrer" class="nav-link external">
  全文搜索
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-subitem"><a href="https://github.com/lq782655835/vuepress-plugin-element-ui" target="_blank" rel="noopener noreferrer" class="nav-link external">
  选项卡
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-subitem"><a href="https://github.com/ekoeryanto/vuepress-plugin-sitemap" target="_blank" rel="noopener noreferrer" class="nav-link external">
  自动生成sitemap
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></li><li class="dropdown-item"><h4>自主开发插件</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="https://github.com/liyao52033/vuepress-plugin-editfrontmatter" target="_blank" rel="noopener noreferrer" class="nav-link external">
  批量操作frontmatter
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-subitem"><a href="https://github.com/liyao52033/vuepress-plugin-replaceurl" target="_blank" rel="noopener noreferrer" class="nav-link external">
  链接美化
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-subitem"><a href="https://github.com/liyao52033/vuepress-plugins/tree/main/vuepress-plugin-blocktoggle" target="_blank" rel="noopener noreferrer" class="nav-link external">
  折叠代码块
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-subitem"><a href="https://github.com/liyao52033/vuepress-plugins/tree/main/vuepress-plugin-copycodeblock" target="_blank" rel="noopener noreferrer" class="nav-link external">
  复制代码块
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar-hover-trigger"></div> <aside class="sidebar" style="display:none;"><div class="blogger"><img src="/img/avatar.png"> <div class="blogger-info"><h3>liyao52033</h3> <span>走运时，要想到倒霉，不要得意得过了头；倒霉时，要想到走运，不必垂头丧气。心态始终保持平衡，情绪始终保持稳定，此亦长寿之道</span></div></div> <nav class="nav-links"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="编程" class="dropdown-title"><!----> <span class="title" style="display:;">编程</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/7765ba/" class="nav-link">前端</a></li><li class="dropdown-item"><!----> <a href="/pages/17352a/" class="nav-link">后端</a></li><li class="dropdown-item"><!----> <a href="/pages/31c4d3/" class="nav-link">嵌入式</a></li><li class="dropdown-item"><!----> <a href="/pages/cf83bf/" class="nav-link">python</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="项目实战" class="dropdown-title"><!----> <span class="title" style="display:;">项目实战</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/7a1d12/" class="nav-link">星球项目</a></li><li class="dropdown-item"><!----> <a href="/pages/91eb9e/" class="nav-link">开源项目</a></li></ul></div></div><div class="nav-item"><a href="/pages/a5da02/" class="nav-link">工具类</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Github" class="dropdown-title"><!----> <span class="title" style="display:;">Github</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>项目仓库</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="https://github.com/liyao52033/liyao52033.github.io" target="_blank" rel="noopener noreferrer" class="nav-link external">
  部署仓库
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-subitem"><a href="https://github.com/liyao52033/vuepress-default" target="_blank" rel="noopener noreferrer" class="nav-link external">
  代码仓库
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></li><li class="dropdown-item"><h4>vuepress插件</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="https://github.com/shanyuhai123/vuepress-plugin-auto-sidebar" target="_blank" rel="noopener noreferrer" class="nav-link external">
  自动生成导航栏与侧边栏
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-subitem"><a href="https://github.com/dongyuanxin/vuepress-plugin-comment" target="_blank" rel="noopener noreferrer" class="nav-link external">
  评论系统
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-subitem"><a href="https://github.com/meilisearch/vuepress-plugin-meilisearch" target="_blank" rel="noopener noreferrer" class="nav-link external">
  全文搜索
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-subitem"><a href="https://github.com/lq782655835/vuepress-plugin-element-ui" target="_blank" rel="noopener noreferrer" class="nav-link external">
  选项卡
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-subitem"><a href="https://github.com/ekoeryanto/vuepress-plugin-sitemap" target="_blank" rel="noopener noreferrer" class="nav-link external">
  自动生成sitemap
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></li><li class="dropdown-item"><h4>自主开发插件</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="https://github.com/liyao52033/vuepress-plugin-editfrontmatter" target="_blank" rel="noopener noreferrer" class="nav-link external">
  批量操作frontmatter
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-subitem"><a href="https://github.com/liyao52033/vuepress-plugin-replaceurl" target="_blank" rel="noopener noreferrer" class="nav-link external">
  链接美化
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-subitem"><a href="https://github.com/liyao52033/vuepress-plugins/tree/main/vuepress-plugin-blocktoggle" target="_blank" rel="noopener noreferrer" class="nav-link external">
  折叠代码块
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-subitem"><a href="https://github.com/liyao52033/vuepress-plugins/tree/main/vuepress-plugin-copycodeblock" target="_blank" rel="noopener noreferrer" class="nav-link external">
  复制代码块
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span> 代码生成器</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/pages/7a1d12/" class="sidebar-link">开发本地代码生成器</a></li><li><a href="/pages/b972ff/" class="sidebar-link">命令行开发</a></li><li><a href="/pages/617ec1/" aria-current="page" class="active sidebar-link">模板生成工具</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level2"><a href="/pages/617ec1/#前情回顾" class="sidebar-link">前情回顾</a></li><li class="sidebar-sub-header level2"><a href="/pages/617ec1/#本节重点" class="sidebar-link">本节重点</a></li><li class="sidebar-sub-header level2"><a href="/pages/617ec1/#一、需求分析" class="sidebar-link">一、需求分析</a></li><li class="sidebar-sub-header level2"><a href="/pages/617ec1/#二、核心设计" class="sidebar-link">二、核心设计</a></li><li class="sidebar-sub-header level2"><a href="/pages/617ec1/#三、基础功能实现" class="sidebar-link">三、基础功能实现</a></li><li class="sidebar-sub-header level2"><a href="/pages/617ec1/#四、更多功能实现" class="sidebar-link">四、更多功能实现</a></li><li class="sidebar-sub-header level2"><a href="/pages/617ec1/#最后" class="sidebar-link">最后</a></li></ul></li></ul></section></li></ul> </aside> <div><main class="page"><div class="theme-vdoing-wrapper "><div class="articleInfo-wrap" data-v-13c63eef><div class="articleInfo" data-v-13c63eef><ul class="breadcrumbs" data-v-13c63eef><li data-v-13c63eef><a href="/" title="首页" class="iconfont icon-home router-link-active" data-v-13c63eef></a></li> <li data-v-13c63eef><a href="/categories/?category=%E9%A1%B9%E7%9B%AE%E5%AE%9E%E6%88%98" title="分类" data-v-13c63eef>项目实战</a></li><li data-v-13c63eef><a href="/categories/?category=%20%E4%BB%A3%E7%A0%81%E7%94%9F%E6%88%90%E5%99%A8" title="分类" data-v-13c63eef> 代码生成器</a></li></ul> <div class="info" data-v-13c63eef><div title="作者" class="author iconfont icon-touxiang" data-v-13c63eef><a href="https://xiaoying.org.cn/" target="_blank" title="作者" class="beLink" data-v-13c63eef>华总</a></div> <div title="创建时间" class="date iconfont icon-riqi" data-v-13c63eef><a href="javascript:;" data-v-13c63eef>2025-02-18</a></div> <div title="文章字数" class="book-words iconfont icon-book" style="float: left; margin-left: 20px; font-size: 0.8rem;" data-v-13c63eef><a href="javascript:;" style="margin-left: 3px; color: #888" data-v-13c63eef>0</a></div> <div title="预计阅读时间" class="reading-time iconfont icon-shijian" style="float: left; margin-left: 20px; font-size: 0.8rem;" data-v-13c63eef><a href="javascript:;" style="margin-left: 3px; color: #888" data-v-13c63eef>0</a></div> <div title="文章访问量" class="page-view iconfont icon-view" style="float: left; margin-left: 20px; font-size: 0.8rem;" data-v-13c63eef><a href="javascript:;" id="busuanzi_page_pv" class="view-data" data-v-13c63eef><i title="正在获取..." class="loading iconfont icon-loading" data-v-13c63eef></i></a></div> <div title="本文总访客量" class="page_total_view iconfont icon-tongji" style="float: left; margin-left: 20px; font-size: 0.8rem;" data-v-13c63eef><a href="javascript:;" id="busuanzi_page_uv" class="view-data" data-v-13c63eef><i title="正在获取..." class="loading iconfont icon-loading" data-v-13c63eef></i></a></div> <!----></div></div></div> <!----> <div class="content-wrapper"><div class="right-menu-wrapper"><div class="right-menu-margin"><div class="right-menu-title">目录</div> <div class="right-menu-content"></div></div></div> <h1><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAYAAAA7MK6iAAAAAXNSR0IArs4c6QAABGpJREFUSA3tVVtoXFUU3fvOI53UlmCaKIFmwEhsE7QK0ipFEdHEKpXaZGrp15SINsXUWvBDpBgQRKi0+KKoFeJHfZA+ED9KKoIU2gYD9UejTW4rVIzm0VSTziPzuNu1z507dibTTjL4U/DAzLn3nL3X2o91ziX6f9wMFdh6Jvbm9nNSV0msViVO6tN1Rm7NMu2OpeJ9lWBUTDxrJbYTS0hInuwciu9eLHlFxCLCZEk3MegsJmZ5K/JD6t7FkFdEvGUo1g7qJoG3MHImqRIn8/nzY1K9UPKKiJmtnUqHVE3Gbuay6vJE/N2FEmuxFjW2nUuE0yQXRRxLiTUAzs36zhZvOXJPdX850EVnnLZkB8prodQoM5JGj7Xk2mvC7JB8tG04Ef5PiXtG0UtxupRQSfTnBoCy554x18yJHI6I+G5Eru4LHmPJZEQsrvPUbMiA8G/WgMK7w7I+ez7++o2ANfbrjvaOl1tFMs+htG3IrZH9/hDX1Pr8Tc0UvH8tcX29KzAgIGcEkINyW5BF9x891hw6VYqgJHEk0huccS7vh3C6gTiODL+26huuBtbct8eZnqLML8PkxGYpuPZBqtqwkSjgc4mB5gbgig5i+y0UDK35LMxXisn9xQtK+nd26gTIHsHe/oblK/b29fUmN/8Y+9jAQrnBp56m1LcDlDp9irKTExSKduXJVWSqdBMA08pEJnEIOB3FPPMybu/oeV8zFeYN3xx576Q6RH+VmplE4ncQV5v+5rzSoyOU7PuEAg8g803PwBJ0CExno/jcMbN8tONYeOmHiuUNryvm3fRUy4tMPVLdAGkUhNWuggGrJcXPv+ouCjz0MKUHz1J2/E8IC9nqTabcxgaBYM0hPhD5Y65FsbxRQKxCQrDjDctW7PUM3HuZunFyifSAqEfuzCp48Il24luWUWZoyJCaPR82jE0+kFA643wRFVni4RYSq3ohJO2pZ7B5dO4xkDWbEpossJPLSrPjYID8rS2UHTlvyNxqIGsg674XJJ7vnh5L7PNwC4hh2sjCI96mzszOTpxLF0T7l88Yz7lAuK6OnL8gXLOnTvpzSb22YG8W7us3jSebFHeeqnXRG1vt+MoUM84LQIBmMsCTAcOauTh0T0l0neQK7m2bLMt2mGxU3HYssS0J2cdv5wljlPsrIuZLAG/2DOZIXgCYT8uMGZN+e2kSirfxZOPCsC0f24nTZzspnVn9VePS1Z5vubmAGGXG8ZFno9Hel0yfA5ZPhF7Dh972BQJ2qCpgH67lmWtBYbvk6sz02wjky2vXyz0XErP/kFB619js1BtwfOV4OPRqOQBjy3Qbk18vigUPPSD5ceHnwck7W9bhAqZdd7SuG7w4/P2F/GaJh8c7e9qgow+Q7cGBo+98WsLkuktFqiZabtXuQTu/Y5ETbR0v7tNSFnvrmu6pjdoan2KjMu8q/Hmj1EfCO2ZGfEIbIXKUlw8qaX9/b2oeSJmFksSeT/Fn0V3nSypChh4Gjh74ybO9aeZ/AN2dwciu2/MhAAAAAElFTkSuQmCC">模板生成工具<span class="title-tag">原创</span></h1> <!----> <div class="theme-vdoing-content content__default"><h2 id="前情回顾"><a href="#前情回顾" class="header-anchor">#</a> 前情回顾</h2> <p>在上期教程中，我们首先明确了第二阶段的目标 —— 通过代码生成器制作工具快速生成 Spring Boot 项目模板代码生成器，并且介绍了示例生成的 Spring Boot 项目模板。然后我们分析得出了 7 种生成器应具备的功能，并且从中梳理除了几个制作工具应具备的通用配置能力，比如支持用一个参数同时控制多个文件的生成、定义可选开启的参数组等等。</p> <p>但光有这些能力还是不够的，想更快地制作代码生成器，我们还可以从“根源”去解决问题，直接通过制作工具来生成项目模板和配置文件。</p> <p>本期教程，就让我们来进一步增加制作工具的功能，实现上述目标吧！</p> <h2 id="本节重点"><a href="#本节重点" class="header-anchor">#</a> 本节重点</h2> <p>本节教程属于项目的第二阶段 —— 开发代码生成器制作工具。</p> <p>本节主要是开发模板制作工具，这一期的教程和代码甚至可以单独拿出来作为一个 <code>快速挖坑工具</code> 小项目了！</p> <p>重点内容：</p> <ol><li>模板制作工具 - 需求分析</li> <li>模板制作工具 - 核心设计</li> <li>模板制作工具 - 基础功能实现</li> <li>模板制作工具 - 更多功能实现</li></ol> <h2 id="一、需求分析"><a href="#一、需求分析" class="header-anchor">#</a> 一、需求分析</h2> <p>还记得么？在上期教程的最后，我们遇到了一个问题：当我们更改元信息数据模型配置，将模型参数进行分组后，我们之前已经编写的 FreeMarker 动态模板就无法正确生成内容了。这是因为使用的模型参数发生了变更，导致无法正确获得值。</p> <p>通过这个问题，我们会发现，动态模板和元信息配置是有很强的绑定关系的，稍有不慎，就有可能导致代码生成异常。</p> <p>此外，我们上期教程中，还遗留了一个需求无法解决 —— 替换生成的代码包名。</p> <p>因为对于 Spring Boot 项目模板这种相对复杂的项目，里面用到包名的 Java 文件太多了，如果每个文件都要自己“挖坑”来制作模板，不仅成本高、也容易出现遗漏。</p> <p>也就是说，虽然制作工具已经能够生成代码生成器了，但还是存在 2 大问题：</p> <ol><li>需要人工提前准备动态模板，项目文件越多，使用成本越高</li> <li>需要根据动态模板编写对应的配置，参数越多，越容易出现和模板不一致的风险</li></ol> <p>如何解决这个问题呢？</p> <p>答案很简单。我们可以让制作工具根据我们的想法，自动给项目文件“挖坑”，并生成相互对应的动态模板文件和元信息配置。提高效率的同时，减少模型参数和模板不一致的风险。</p> <p>这就是我们本期教程需要完成的需求。</p> <p>不过需要明确一点： <strong>制作工具的作用只是提高效率，无法覆盖所有的定制需求！</strong></p> <p>因为想要如何制作代码生成器，还是取决于开发者。</p> <h2 id="二、核心设计"><a href="#二、核心设计" class="header-anchor">#</a> 二、核心设计</h2> <p>我们先分析下如何实现上述需求。</p> <p>经常跟大家提到这么一句话：程序的本质就是帮我们完成原本人工需要进行的操作。</p> <p>所以想让程序自动制作模板和生成配置，我们就要先想一想：之前我们是怎么完成这些操作的？</p> <p>在使用制作工具生成前，我们依次做了以下事情：</p> <ol><li>先指定一个原始的、待“挖坑”的输入文件</li> <li>明确文件中需要被动态替换的内容和模型参数</li> <li>自己编写 FreeMarker FTL 模板文件</li> <li>自己编写生成器的元信息配置，包括基本信息、文件配置、模型参数配置</li></ol> <p>分析上面的步骤，第 1 - 2 步都是需要用户自主确认的内容，制作工具无法插手；而有了前两步的信息后，3 - 4 步就可以用制作工具来完成。</p> <p>由此，我们可以分析出快速制作模板的 <strong>基本公式</strong> ：</p> <ul><li>向制作工具输入：基本信息 + 输入文件 + 模型参数（+ 输出规则）</li> <li>由制作工具输出：模板文件 + 元信息配置</li></ul> <blockquote><p>跟编写算法题目一样，先明确算法的输入和输出，再去设计实现算法</p></blockquote> <p>对应的算法流程图如下：</p> <p><img alt="img" data-src="https://img.xiaoying.org.cn/img/202502181318048.jpeg" loading="lazy" class="lazy"></p> <p>分别解释一下上述输入参数：</p> <p>1）基本信息：要制作的代码生成器的基本信息，对应元信息的名称、描述、版本号、作者等信息。</p> <p>2）输入文件：要“挖坑”的原始文件。可能是一个文件、也可能是多个文件。</p> <p>3）模型参数：要引导用户输入并填充到模板的模型参数，对应元信息的 modelConfig 模型配置。</p> <p>4）输出规则：作为一个后续扩展功能的可选参数，比如多次制作时是否覆盖旧的配置等。</p> <p>输出参数就比较好理解了，在指定目录下生成 FTL 模板文件、以及 <code>meta.json</code> 元信息配置文件。</p> <p>明确了程序的输入输出后，下面我们就先实现一个最基础的模板制作工具，然后再陆续给工具增加功能。</p> <blockquote><p>小技巧：开发复杂需求或新项目时，先一切从简，完成核心流程的开发。在这个过程中可以记录想法和扩展思路，后面再按需实现。</p></blockquote> <h2 id="三、基础功能实现"><a href="#三、基础功能实现" class="header-anchor">#</a> 三、基础功能实现</h2> <p>首先打开制作工具（maker）项目，在 <code>maker</code> 包下新建 <code>template</code> 包，所有和模板制作相关的代码都放到该包下，实现功能隔离。</p> <blockquote><p>目前项目中的 <code>maker.model</code> 目录和 <code>FileGenerator</code> 的 <code>main</code> 方法是多余的，可以删除。</p></blockquote> <h3 id="_1、基本流程实现"><a href="#_1、基本流程实现" class="header-anchor">#</a> 1、基本流程实现</h3> <p>下面我们就以第一阶段准备好的 ACM 示例模板项目为例，来编写模板制作工具的基本流程代码。</p> <p>预期是以 ACM 示例模板项目为根目录，使用 <code>outputText</code> 模型参数来替换其 <code>src/com/yupi/acm/MainTemplate.java</code> 文件中的 <code>Sum:</code> 输出信息，并在同包下生成 “挖好坑” 的 <code>MainTemplate.java.ftl</code> 模板文件，以及在根目录下生成 <code>meta.json</code> 元信息文件。</p> <p>实现步骤如下：</p> <ol><li>提供输入参数：包括生成器基本信息、原始项目目录、原始文件、模型参数</li> <li>基于字符串替换算法，使用模型参数的字段名称来替换原始文件的指定内容，并使用替换后的内容来创建 FTL 动态模板文件</li> <li>使用输入信息来创建 <code>meta.json</code> 元信息文件</li></ol> <p>在 <code>template</code> 包下新建 <code>TemplateMaker.java</code> 文件，并依次在 main 方法中实现上述步骤。</p> <p>1）输入信息</p> <p>要格外注意输入文件的路径（win 系统需要对路径进行转义），代码如下：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// 一、输入信息</span>
<span class="token comment">// 1. 输入项目基本信息</span>
<span class="token class-name">String</span> name <span class="token operator">=</span> <span class="token string">&quot;acm-template-generator&quot;</span><span class="token punctuation">;</span>
<span class="token class-name">String</span> description <span class="token operator">=</span> <span class="token string">&quot;ACM 示例模板生成器&quot;</span><span class="token punctuation">;</span>

<span class="token comment">// 2. 输入文件信息</span>
<span class="token class-name">String</span> projectPath <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">getProperty</span><span class="token punctuation">(</span><span class="token string">&quot;user.dir&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">String</span> sourceRootPath <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span>projectPath<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getParent</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token class-name">File</span><span class="token punctuation">.</span>separator <span class="token operator">+</span> <span class="token string">&quot;yuzi-generator-demo-projects/acm-template&quot;</span><span class="token punctuation">;</span>
<span class="token comment">// 注意 win 系统需要对路径进行转义</span>
sourceRootPath <span class="token operator">=</span> sourceRootPath<span class="token punctuation">.</span><span class="token function">replaceAll</span><span class="token punctuation">(</span><span class="token string">&quot;\\\\&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;/&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token class-name">String</span> fileInputPath <span class="token operator">=</span> <span class="token string">&quot;src/com/yupi/acm/MainTemplate.java&quot;</span><span class="token punctuation">;</span>
<span class="token class-name">String</span> fileOutputPath <span class="token operator">=</span> fileInputPath <span class="token operator">+</span> <span class="token string">&quot;.ftl&quot;</span><span class="token punctuation">;</span>

<span class="token comment">// 3. 输入模型参数信息</span>
<span class="token class-name">Meta<span class="token punctuation">.</span>ModelConfig<span class="token punctuation">.</span>ModelInfo</span> modelInfo <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Meta<span class="token punctuation">.</span>ModelConfig<span class="token punctuation">.</span>ModelInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
modelInfo<span class="token punctuation">.</span><span class="token function">setFieldName</span><span class="token punctuation">(</span><span class="token string">&quot;outputText&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
modelInfo<span class="token punctuation">.</span><span class="token function">setType</span><span class="token punctuation">(</span><span class="token string">&quot;String&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
modelInfo<span class="token punctuation">.</span><span class="token function">setDefaultValue</span><span class="token punctuation">(</span><span class="token string">&quot;sum = &quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><p>2）使用字符串替换，生成模板文件</p> <p>代码如下：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// 二、使用字符串替换，生成模板文件</span>
<span class="token class-name">String</span> fileInputAbsolutePath <span class="token operator">=</span> sourceRootPath <span class="token operator">+</span> <span class="token class-name">File</span><span class="token punctuation">.</span>separator <span class="token operator">+</span> fileInputPath<span class="token punctuation">;</span>
<span class="token class-name">String</span> fileContent <span class="token operator">=</span> <span class="token class-name">FileUtil</span><span class="token punctuation">.</span><span class="token function">readUtf8String</span><span class="token punctuation">(</span>fileInputAbsolutePath<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">String</span> replacement <span class="token operator">=</span> <span class="token class-name">String</span><span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token string">&quot;${%s}&quot;</span><span class="token punctuation">,</span> modelInfo<span class="token punctuation">.</span><span class="token function">getFieldName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">String</span> newFileContent <span class="token operator">=</span> <span class="token class-name">StrUtil</span><span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span>fileContent<span class="token punctuation">,</span> <span class="token string">&quot;Sum: &quot;</span><span class="token punctuation">,</span> replacement<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 输出模板文件</span>
<span class="token class-name">String</span> fileOutputAbsolutePath <span class="token operator">=</span> sourceRootPath <span class="token operator">+</span> <span class="token class-name">File</span><span class="token punctuation">.</span>separator <span class="token operator">+</span> fileOutputPath<span class="token punctuation">;</span>
<span class="token class-name">FileUtil</span><span class="token punctuation">.</span><span class="token function">writeUtf8String</span><span class="token punctuation">(</span>newFileContent<span class="token punctuation">,</span> fileOutputAbsolutePath<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>上述代码中，使用 <code>FileUtil.readUtf8String</code> 快速读取文件内容，使用 <code>StrUtil.replace</code> 快速替换指定的内容，最后使用 <code>FileUtil.writeUtf8String</code> 将替换后的内容快速写入到文件。</p> <p>3）生成配置文件</p> <p>思路是先构造 Meta 对象并填充属性，再使用 Hutool 工具库的 <code>JSONUtil.toJsonPrettyStr</code> 方法将对象转为格式化后的 JSON 字符串，最后再写入 <code>meta.json</code> 文件。</p> <p>代码如下：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// 三、生成配置文件</span>
<span class="token class-name">String</span> metaOutputPath <span class="token operator">=</span> sourceRootPath <span class="token operator">+</span> <span class="token class-name">File</span><span class="token punctuation">.</span>separator <span class="token operator">+</span> <span class="token string">&quot;meta.json&quot;</span><span class="token punctuation">;</span>

<span class="token comment">// 1. 构造配置参数</span>
<span class="token class-name">Meta</span> meta <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Meta</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
meta<span class="token punctuation">.</span><span class="token function">setName</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
meta<span class="token punctuation">.</span><span class="token function">setDescription</span><span class="token punctuation">(</span>description<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token class-name">Meta<span class="token punctuation">.</span>FileConfig</span> fileConfig <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Meta<span class="token punctuation">.</span>FileConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
meta<span class="token punctuation">.</span><span class="token function">setFileConfig</span><span class="token punctuation">(</span>fileConfig<span class="token punctuation">)</span><span class="token punctuation">;</span>
fileConfig<span class="token punctuation">.</span><span class="token function">setSourceRootPath</span><span class="token punctuation">(</span>sourceRootPath<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Meta<span class="token punctuation">.</span>FileConfig<span class="token punctuation">.</span>FileInfo</span><span class="token punctuation">&gt;</span></span> fileInfoList <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
fileConfig<span class="token punctuation">.</span><span class="token function">setFiles</span><span class="token punctuation">(</span>fileInfoList<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">Meta<span class="token punctuation">.</span>FileConfig<span class="token punctuation">.</span>FileInfo</span> fileInfo <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Meta<span class="token punctuation">.</span>FileConfig<span class="token punctuation">.</span>FileInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
fileInfo<span class="token punctuation">.</span><span class="token function">setInputPath</span><span class="token punctuation">(</span>fileInputPath<span class="token punctuation">)</span><span class="token punctuation">;</span>
fileInfo<span class="token punctuation">.</span><span class="token function">setOutputPath</span><span class="token punctuation">(</span>fileOutputPath<span class="token punctuation">)</span><span class="token punctuation">;</span>
fileInfo<span class="token punctuation">.</span><span class="token function">setType</span><span class="token punctuation">(</span><span class="token class-name">FileTypeEnum</span><span class="token punctuation">.</span><span class="token constant">FILE</span><span class="token punctuation">.</span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
fileInfo<span class="token punctuation">.</span><span class="token function">setGenerateType</span><span class="token punctuation">(</span><span class="token class-name">FileGenerateTypeEnum</span><span class="token punctuation">.</span><span class="token constant">DYNAMIC</span><span class="token punctuation">.</span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
fileInfoList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>fileInfo<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token class-name">Meta<span class="token punctuation">.</span>ModelConfig</span> modelConfig <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Meta<span class="token punctuation">.</span>ModelConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
meta<span class="token punctuation">.</span><span class="token function">setModelConfig</span><span class="token punctuation">(</span>modelConfig<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Meta<span class="token punctuation">.</span>ModelConfig<span class="token punctuation">.</span>ModelInfo</span><span class="token punctuation">&gt;</span></span> modelInfoList <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
modelConfig<span class="token punctuation">.</span><span class="token function">setModels</span><span class="token punctuation">(</span>modelInfoList<span class="token punctuation">)</span><span class="token punctuation">;</span>
modelInfoList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>modelInfo<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 2. 输出元信息文件</span>
<span class="token class-name">FileUtil</span><span class="token punctuation">.</span><span class="token function">writeUtf8String</span><span class="token punctuation">(</span><span class="token class-name">JSONUtil</span><span class="token punctuation">.</span><span class="token function">toJsonPrettyStr</span><span class="token punctuation">(</span>meta<span class="token punctuation">)</span><span class="token punctuation">,</span> metaOutputPath<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br></div></div><p>组合以上几个步骤的代码，完整代码如下：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>yupi<span class="token punctuation">.</span>maker<span class="token punctuation">.</span>template</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">cn<span class="token punctuation">.</span>hutool<span class="token punctuation">.</span>core<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">FileUtil</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">cn<span class="token punctuation">.</span>hutool<span class="token punctuation">.</span>core<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">StrUtil</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">cn<span class="token punctuation">.</span>hutool<span class="token punctuation">.</span>json<span class="token punctuation">.</span></span><span class="token class-name">JSONUtil</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>yupi<span class="token punctuation">.</span>maker<span class="token punctuation">.</span>meta<span class="token punctuation">.</span></span><span class="token class-name">Meta</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>yupi<span class="token punctuation">.</span>maker<span class="token punctuation">.</span>meta<span class="token punctuation">.</span>enums<span class="token punctuation">.</span></span><span class="token class-name">FileGenerateTypeEnum</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>yupi<span class="token punctuation">.</span>maker<span class="token punctuation">.</span>meta<span class="token punctuation">.</span>enums<span class="token punctuation">.</span></span><span class="token class-name">FileTypeEnum</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">File</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">ArrayList</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">List</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TemplateMaker</span> <span class="token punctuation">{</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 一、输入信息</span>
        <span class="token comment">// 1. 输入项目基本信息</span>
        <span class="token class-name">String</span> name <span class="token operator">=</span> <span class="token string">&quot;acm-template-generator&quot;</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> description <span class="token operator">=</span> <span class="token string">&quot;ACM 示例模板生成器&quot;</span><span class="token punctuation">;</span>

        <span class="token comment">// 2. 输入文件信息</span>
        <span class="token class-name">String</span> projectPath <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">getProperty</span><span class="token punctuation">(</span><span class="token string">&quot;user.dir&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> sourceRootPath <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span>projectPath<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getParent</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token class-name">File</span><span class="token punctuation">.</span>separator <span class="token operator">+</span> <span class="token string">&quot;yuzi-generator-demo-projects/acm-template&quot;</span><span class="token punctuation">;</span>
        <span class="token comment">// 注意 win 系统需要对路径进行转义</span>
		sourceRootPath <span class="token operator">=</span> sourceRootPath<span class="token punctuation">.</span><span class="token function">replaceAll</span><span class="token punctuation">(</span><span class="token string">&quot;\\\\&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;/&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        
        <span class="token class-name">String</span> fileInputPath <span class="token operator">=</span> <span class="token string">&quot;src/com/yupi/acm/MainTemplate.java&quot;</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> fileOutputPath <span class="token operator">=</span> fileInputPath <span class="token operator">+</span> <span class="token string">&quot;.ftl&quot;</span><span class="token punctuation">;</span>

        <span class="token comment">// 3. 输入模型参数信息</span>
        <span class="token class-name">Meta<span class="token punctuation">.</span>ModelConfig<span class="token punctuation">.</span>ModelInfo</span> modelInfo <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Meta<span class="token punctuation">.</span>ModelConfig<span class="token punctuation">.</span>ModelInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        modelInfo<span class="token punctuation">.</span><span class="token function">setFieldName</span><span class="token punctuation">(</span><span class="token string">&quot;outputText&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        modelInfo<span class="token punctuation">.</span><span class="token function">setType</span><span class="token punctuation">(</span><span class="token string">&quot;String&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        modelInfo<span class="token punctuation">.</span><span class="token function">setDefaultValue</span><span class="token punctuation">(</span><span class="token string">&quot;sum = &quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 二、使用字符串替换，生成模板文件</span>
        <span class="token class-name">String</span> fileInputAbsolutePath <span class="token operator">=</span> sourceRootPath <span class="token operator">+</span> <span class="token class-name">File</span><span class="token punctuation">.</span>separator <span class="token operator">+</span> fileInputPath<span class="token punctuation">;</span>
        <span class="token class-name">String</span> fileContent <span class="token operator">=</span> <span class="token class-name">FileUtil</span><span class="token punctuation">.</span><span class="token function">readUtf8String</span><span class="token punctuation">(</span>fileInputAbsolutePath<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> replacement <span class="token operator">=</span> <span class="token class-name">String</span><span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token string">&quot;${%s}&quot;</span><span class="token punctuation">,</span> modelInfo<span class="token punctuation">.</span><span class="token function">getFieldName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> newFileContent <span class="token operator">=</span> <span class="token class-name">StrUtil</span><span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span>fileContent<span class="token punctuation">,</span> <span class="token string">&quot;Sum: &quot;</span><span class="token punctuation">,</span> replacement<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 输出模板文件</span>
        <span class="token class-name">String</span> fileOutputAbsolutePath <span class="token operator">=</span> sourceRootPath <span class="token operator">+</span> <span class="token class-name">File</span><span class="token punctuation">.</span>separator <span class="token operator">+</span> fileOutputPath<span class="token punctuation">;</span>
        <span class="token class-name">FileUtil</span><span class="token punctuation">.</span><span class="token function">writeUtf8String</span><span class="token punctuation">(</span>newFileContent<span class="token punctuation">,</span> fileOutputAbsolutePath<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 三、生成配置文件</span>
        <span class="token class-name">String</span> metaOutputPath <span class="token operator">=</span> sourceRootPath <span class="token operator">+</span> <span class="token class-name">File</span><span class="token punctuation">.</span>separator <span class="token operator">+</span> <span class="token string">&quot;meta.json&quot;</span><span class="token punctuation">;</span>

        <span class="token comment">// 1. 构造配置参数</span>
        <span class="token class-name">Meta</span> meta <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Meta</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        meta<span class="token punctuation">.</span><span class="token function">setName</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
        meta<span class="token punctuation">.</span><span class="token function">setDescription</span><span class="token punctuation">(</span>description<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">Meta<span class="token punctuation">.</span>FileConfig</span> fileConfig <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Meta<span class="token punctuation">.</span>FileConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        meta<span class="token punctuation">.</span><span class="token function">setFileConfig</span><span class="token punctuation">(</span>fileConfig<span class="token punctuation">)</span><span class="token punctuation">;</span>
        fileConfig<span class="token punctuation">.</span><span class="token function">setSourceRootPath</span><span class="token punctuation">(</span>sourceRootPath<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Meta<span class="token punctuation">.</span>FileConfig<span class="token punctuation">.</span>FileInfo</span><span class="token punctuation">&gt;</span></span> fileInfoList <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        fileConfig<span class="token punctuation">.</span><span class="token function">setFiles</span><span class="token punctuation">(</span>fileInfoList<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Meta<span class="token punctuation">.</span>FileConfig<span class="token punctuation">.</span>FileInfo</span> fileInfo <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Meta<span class="token punctuation">.</span>FileConfig<span class="token punctuation">.</span>FileInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        fileInfo<span class="token punctuation">.</span><span class="token function">setInputPath</span><span class="token punctuation">(</span>fileInputPath<span class="token punctuation">)</span><span class="token punctuation">;</span>
        fileInfo<span class="token punctuation">.</span><span class="token function">setOutputPath</span><span class="token punctuation">(</span>fileOutputPath<span class="token punctuation">)</span><span class="token punctuation">;</span>
        fileInfo<span class="token punctuation">.</span><span class="token function">setType</span><span class="token punctuation">(</span><span class="token class-name">FileTypeEnum</span><span class="token punctuation">.</span><span class="token constant">FILE</span><span class="token punctuation">.</span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        fileInfo<span class="token punctuation">.</span><span class="token function">setGenerateType</span><span class="token punctuation">(</span><span class="token class-name">FileGenerateTypeEnum</span><span class="token punctuation">.</span><span class="token constant">DYNAMIC</span><span class="token punctuation">.</span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        fileInfoList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>fileInfo<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">Meta<span class="token punctuation">.</span>ModelConfig</span> modelConfig <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Meta<span class="token punctuation">.</span>ModelConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        meta<span class="token punctuation">.</span><span class="token function">setModelConfig</span><span class="token punctuation">(</span>modelConfig<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Meta<span class="token punctuation">.</span>ModelConfig<span class="token punctuation">.</span>ModelInfo</span><span class="token punctuation">&gt;</span></span> modelInfoList <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        modelConfig<span class="token punctuation">.</span><span class="token function">setModels</span><span class="token punctuation">(</span>modelInfoList<span class="token punctuation">)</span><span class="token punctuation">;</span>
        modelInfoList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>modelInfo<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 2. 输出元信息文件</span>
        <span class="token class-name">FileUtil</span><span class="token punctuation">.</span><span class="token function">writeUtf8String</span><span class="token punctuation">(</span><span class="token class-name">JSONUtil</span><span class="token punctuation">.</span><span class="token function">toJsonPrettyStr</span><span class="token punctuation">(</span>meta<span class="token punctuation">)</span><span class="token punctuation">,</span> metaOutputPath<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br></div></div><p>运行 main 方法，测试执行，成功生成了需要的模板和元信息文件：</p> <p><img alt="image.png" data-src="https://img.xiaoying.org.cn/img/202502181318789.png" loading="lazy" class="lazy"></p> <p>虽然制作模板的流程是跑通了，但我们会发现一个问题：上述代码直接在原始项目内生成了模板和元信息配置，其实是对原项目的污染。如果我们想重新生成，就得一个个删除上次生成的文件。</p> <h3 id="_2、工作空间隔离"><a href="#_2、工作空间隔离" class="header-anchor">#</a> 2、工作空间隔离</h3> <p>想解决上面的问题，其实很简单。每次制作模板时，我们都不直接修改原始项目的任何文件，而是先复制原项目到一个临时的、专门用于制作模板的目录，然后在该目录下完成文件的生成和处理。</p> <p>可以将上述临时目录称为 <code>工作空间</code>，每次模板制作应该属于不同的工作空间，互不影响。iZC7DB8PXu/GGlQ4cVha5zDNtNCK+ikSmWAXB1nDW5I=</p> <p>我们约定将 <code>maker</code> 项目下的 <code>.temp</code> 临时目录作为工作空间的根目录，并且在项目的 <code>.gitignore</code> 文件中忽略该目录。</p> <p>在 <code>TemplateMaker</code> 原有代码的基础上新增复制目录的逻辑：</p> <ol><li>需要用户传入 <code>originProjectPath</code> 变量代表原始项目路径</li> <li>每次制作分配一个唯一 id（使用雪花算法），作为工作空间的名称，从而实现隔离</li> <li>通过 <code>FileUtil.copy</code> 复制目录</li> <li>修改变量 <code>sourceRootPath</code> 的值为复制后的工作空间内的项目根目录</li></ol> <p>对应修改的代码如下：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 指定原始项目路径</span>
    <span class="token class-name">String</span> projectPath <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">getProperty</span><span class="token punctuation">(</span><span class="token string">&quot;user.dir&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">String</span> originProjectPath <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span>projectPath<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getParent</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token class-name">File</span><span class="token punctuation">.</span>separator <span class="token operator">+</span> <span class="token string">&quot;yuzi-generator-demo-projects/acm-template&quot;</span><span class="token punctuation">;</span>

    <span class="token comment">// 复制目录</span>
    <span class="token keyword">long</span> id <span class="token operator">=</span> <span class="token class-name">IdUtil</span><span class="token punctuation">.</span><span class="token function">getSnowflakeNextId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">String</span> tempDirPath <span class="token operator">=</span> projectPath <span class="token operator">+</span> <span class="token class-name">File</span><span class="token punctuation">.</span>separator <span class="token operator">+</span> <span class="token string">&quot;.temp&quot;</span><span class="token punctuation">;</span>
    <span class="token class-name">String</span> templatePath <span class="token operator">=</span> tempDirPath <span class="token operator">+</span> <span class="token class-name">File</span><span class="token punctuation">.</span>separator <span class="token operator">+</span> id<span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token class-name">FileUtil</span><span class="token punctuation">.</span><span class="token function">exist</span><span class="token punctuation">(</span>templatePath<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">FileUtil</span><span class="token punctuation">.</span><span class="token function">mkdir</span><span class="token punctuation">(</span>templatePath<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token class-name">FileUtil</span><span class="token punctuation">.</span><span class="token function">copy</span><span class="token punctuation">(</span>originProjectPath<span class="token punctuation">,</span> templatePath<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 一、输入信息</span>
    <span class="token comment">// 1. 输入项目基本信息</span>
    <span class="token class-name">String</span> name <span class="token operator">=</span> <span class="token string">&quot;acm-template-generator&quot;</span><span class="token punctuation">;</span>
    <span class="token class-name">String</span> description <span class="token operator">=</span> <span class="token string">&quot;ACM 示例模板生成器&quot;</span><span class="token punctuation">;</span>

    <span class="token comment">// 2. 输入文件信息</span>
    <span class="token class-name">String</span> sourceRootPath <span class="token operator">=</span> templatePath <span class="token operator">+</span> <span class="token class-name">File</span><span class="token punctuation">.</span>separator <span class="token operator">+</span> <span class="token class-name">FileUtil</span><span class="token punctuation">.</span><span class="token function">getLastPathEle</span><span class="token punctuation">(</span><span class="token class-name">Paths</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>originProjectPath<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">String</span> fileInputPath <span class="token operator">=</span> <span class="token string">&quot;src/com/yupi/acm/MainTemplate.java&quot;</span><span class="token punctuation">;</span>
    <span class="token class-name">String</span> fileOutputPath <span class="token operator">=</span> fileInputPath <span class="token operator">+</span> <span class="token string">&quot;.ftl&quot;</span><span class="token punctuation">;</span>

    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br></div></div><p>再次测试执行，可以看到 maker 项目下新建了一个工作空间，并且生成了模板和元信息配置文件，如下图：</p> <p><img alt="image.png" data-src="https://img.xiaoying.org.cn/img/202502181318832.png" loading="lazy" class="lazy"></p> <h3 id="_3、分步制作能力"><a href="#_3、分步制作能力" class="header-anchor">#</a> 3、分步制作能力</h3> <p>一般来说，我们在制作模板时，不可能只 “挖一个坑”，只允许用户自定义输入一个参数；也不可能一次性 “挖完所有坑”。而是一步一步地替换参数、制作模板。</p> <p>所以，我们的制作工具要有分步制作、追加配置的能力，具体要做到以下 3 点：</p> <ol><li>输入过一次的信息，不用重复输入，比如基本的项目信息</li> <li>后续制作时，不用再次复制原始项目；而是可以在原有文件的基础上，多次追加或覆盖新的文件</li> <li>后续制作时，可以在原有配置的基础上，多次追加或覆盖配置</li></ol> <p>想要实现这个能力，我们首先要让制作工具 “有状态”。</p> <h4 id="有状态和无状态"><a href="#有状态和无状态" class="header-anchor">#</a> 有状态和无状态</h4> <p>什么是有状态？</p> <p>是指程序或请求多次执行时，下一次执行保留对上一次执行的记忆。比如用户登录后服务器会记住用户的信息，下一次请求就能正常使用系统。</p> <p>与之相对的是无状态。是指每次程序或请求执行，都像是第一次执行一样，没有任何历史信息。很多 Restful API 会采用无状态的设计，能够节省服务器的资源占用。</p> <h4 id="有状态实现"><a href="#有状态实现" class="header-anchor">#</a> 有状态实现</h4> <p>想实现有状态，往往需要 2 个要素：唯一标识和存储。</p> <p>其实在上一步 “工作空间隔离” 中，我们已经给每个工作空间分配了一个唯一的 id 作为标识；并且将 id 作为工作空间的目录名称，相当于使用本地文件系统作为了 id 的存储。</p> <p>那么我们只要在第一次制作时，生成唯一的 id；然后在后续制作时，使用相同的 id，就能找到之前的工作空间目录，从而追加文件或配置。</p> <p>修改 <code>TemplateMaker</code> 文件，新建 <code>makeTemplate</code> 方法，并将 id 作为参数，先实现 id 的生成逻辑。</p> <p>代码如下：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">long</span> <span class="token function">makeTemplate</span><span class="token punctuation">(</span><span class="token class-name">Long</span> id<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 没有 id 则生成</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>id <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        id <span class="token operator">=</span> <span class="token class-name">IdUtil</span><span class="token punctuation">.</span><span class="token function">getSnowflakeNextId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    <span class="token comment">// 业务逻辑...</span>
    
    <span class="token keyword">return</span> id<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><h4 id="多次制作实现"><a href="#多次制作实现" class="header-anchor">#</a> 多次制作实现</h4> <p>如果根据 id 判断出并非首次制作，我们又应该做哪些调整呢？应该如何追加配置和文件呢？</p> <p>这里我考虑到 3 点：</p> <ol><li>非首次制作，不需要复制原始项目文件</li> <li>非首次制作，可以在已有模板的基础上再次挖坑</li> <li>非首次制作，不需要重复输入已有元信息，而是在此基础上覆盖和追加元信息配置</li></ol> <p>下面分别实现这几点。</p> <p>1）非首次制作，不需要复制原始项目文件</p> <p>之前的 <code>TemplateMaker</code> 代码已经判断了某 id 对应的工作空间目录是否存在，现在只需要把复制原始项目文件的逻辑移到 “首次制作” 的 if 条件中即可。</p> <p>修改后的代码如下：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// 复制目录</span>
<span class="token keyword">long</span> id <span class="token operator">=</span> <span class="token class-name">IdUtil</span><span class="token punctuation">.</span><span class="token function">getSnowflakeNextId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">String</span> tempDirPath <span class="token operator">=</span> projectPath <span class="token operator">+</span> <span class="token class-name">File</span><span class="token punctuation">.</span>separator <span class="token operator">+</span> <span class="token string">&quot;.temp&quot;</span><span class="token punctuation">;</span>
<span class="token class-name">String</span> templatePath <span class="token operator">=</span> tempDirPath <span class="token operator">+</span> <span class="token class-name">File</span><span class="token punctuation">.</span>separator <span class="token operator">+</span> id<span class="token punctuation">;</span>

<span class="token comment">// 是否为首次制作模板</span>
<span class="token comment">// 目录不存在，则是首次制作</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token class-name">FileUtil</span><span class="token punctuation">.</span><span class="token function">exist</span><span class="token punctuation">(</span>templatePath<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">FileUtil</span><span class="token punctuation">.</span><span class="token function">mkdir</span><span class="token punctuation">(</span>templatePath<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">FileUtil</span><span class="token punctuation">.</span><span class="token function">copy</span><span class="token punctuation">(</span>originProjectPath<span class="token punctuation">,</span> templatePath<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>2）非首次制作，可以在已有模板的基础上再次挖坑</p> <p>由于制作好的模板文件名称就是在原始文件名称后增加 <code>.ftl</code> 后缀，所以我们可以将输出文件路径（包含 <code>.ftl</code> 后缀的路径）作为文件是否重复的判断条件。如果已有 <code>.ftl</code> 文件，表示不是第一次制作，可以在这个模板文件的基础上再去替换内容。</p> <p>修改后的代码如下：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// 二、使用字符串替换，生成模板文件</span>
<span class="token class-name">String</span> fileInputAbsolutePath <span class="token operator">=</span> sourceRootPath <span class="token operator">+</span> <span class="token class-name">File</span><span class="token punctuation">.</span>separator <span class="token operator">+</span> fileInputPath<span class="token punctuation">;</span>
<span class="token class-name">String</span> fileOutputAbsolutePath <span class="token operator">=</span> sourceRootPath <span class="token operator">+</span> <span class="token class-name">File</span><span class="token punctuation">.</span>separator <span class="token operator">+</span> fileOutputPath<span class="token punctuation">;</span>

<span class="token class-name">String</span> fileContent <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
<span class="token comment">// 如果已有模板文件，说明不是第一次制作，则在模板基础上再次挖坑</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">FileUtil</span><span class="token punctuation">.</span><span class="token function">exist</span><span class="token punctuation">(</span>fileOutputAbsolutePath<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    fileContent <span class="token operator">=</span> <span class="token class-name">FileUtil</span><span class="token punctuation">.</span><span class="token function">readUtf8String</span><span class="token punctuation">(</span>fileOutputAbsolutePath<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    fileContent <span class="token operator">=</span> <span class="token class-name">FileUtil</span><span class="token punctuation">.</span><span class="token function">readUtf8String</span><span class="token punctuation">(</span>fileInputAbsolutePath<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token class-name">String</span> replacement <span class="token operator">=</span> <span class="token class-name">String</span><span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token string">&quot;${%s}&quot;</span><span class="token punctuation">,</span> modelInfo<span class="token punctuation">.</span><span class="token function">getFieldName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">String</span> newFileContent <span class="token operator">=</span> <span class="token class-name">StrUtil</span><span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span>fileContent<span class="token punctuation">,</span> <span class="token string">&quot;Sum: &quot;</span><span class="token punctuation">,</span> replacement<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 输出模板文件</span>
<span class="token class-name">FileUtil</span><span class="token punctuation">.</span><span class="token function">writeUtf8String</span><span class="token punctuation">(</span>newFileContent<span class="token punctuation">,</span> fileOutputAbsolutePath<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><p>3）非首次制作，不需要重复输入已有元信息，而是在此基础上覆盖和追加元信息配置。</p> <p>和判断文件模板是否重复的逻辑一致，我们可以通过是否已存在 <code>meta.json</code> 配置文件来判断应该新增还是修改配置。</p> <p>修改后的代码如下：</p> <blockquote><p>我们将 fileInfo 对象的构造移到了前面，使得无论是新增还是修改元信息都能使用该对象</p></blockquote> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// 文件配置信息</span>
<span class="token class-name">Meta<span class="token punctuation">.</span>FileConfig<span class="token punctuation">.</span>FileInfo</span> fileInfo <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Meta<span class="token punctuation">.</span>FileConfig<span class="token punctuation">.</span>FileInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
fileInfo<span class="token punctuation">.</span><span class="token function">setInputPath</span><span class="token punctuation">(</span>fileInputPath<span class="token punctuation">)</span><span class="token punctuation">;</span>
fileInfo<span class="token punctuation">.</span><span class="token function">setOutputPath</span><span class="token punctuation">(</span>fileOutputPath<span class="token punctuation">)</span><span class="token punctuation">;</span>
fileInfo<span class="token punctuation">.</span><span class="token function">setType</span><span class="token punctuation">(</span><span class="token class-name">FileTypeEnum</span><span class="token punctuation">.</span><span class="token constant">FILE</span><span class="token punctuation">.</span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
fileInfo<span class="token punctuation">.</span><span class="token function">setGenerateType</span><span class="token punctuation">(</span><span class="token class-name">FileGenerateTypeEnum</span><span class="token punctuation">.</span><span class="token constant">DYNAMIC</span><span class="token punctuation">.</span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 三、生成配置文件</span>
<span class="token class-name">String</span> metaOutputPath <span class="token operator">=</span> sourceRootPath <span class="token operator">+</span> <span class="token class-name">File</span><span class="token punctuation">.</span>separator <span class="token operator">+</span> <span class="token string">&quot;meta.json&quot;</span><span class="token punctuation">;</span>

<span class="token comment">// 如果已有 meta 文件，说明不是第一次制作，则在 meta 基础上进行修改</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">FileUtil</span><span class="token punctuation">.</span><span class="token function">exist</span><span class="token punctuation">(</span>metaOutputPath<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">Meta</span> oldMeta <span class="token operator">=</span> <span class="token class-name">JSONUtil</span><span class="token punctuation">.</span><span class="token function">toBean</span><span class="token punctuation">(</span><span class="token class-name">FileUtil</span><span class="token punctuation">.</span><span class="token function">readUtf8String</span><span class="token punctuation">(</span>metaOutputPath<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">Meta</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 1. 追加配置参数</span>
    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Meta<span class="token punctuation">.</span>FileConfig<span class="token punctuation">.</span>FileInfo</span><span class="token punctuation">&gt;</span></span> fileInfoList <span class="token operator">=</span> oldMeta<span class="token punctuation">.</span><span class="token function">getFileConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getFiles</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    fileInfoList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>fileInfo<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Meta<span class="token punctuation">.</span>ModelConfig<span class="token punctuation">.</span>ModelInfo</span><span class="token punctuation">&gt;</span></span> modelInfoList <span class="token operator">=</span> oldMeta<span class="token punctuation">.</span><span class="token function">getModelConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getModels</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    modelInfoList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>modelInfo<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 2.更新元信息文件</span>
    <span class="token class-name">FileUtil</span><span class="token punctuation">.</span><span class="token function">writeUtf8String</span><span class="token punctuation">(</span><span class="token class-name">JSONUtil</span><span class="token punctuation">.</span><span class="token function">toJsonPrettyStr</span><span class="token punctuation">(</span>oldMeta<span class="token punctuation">)</span><span class="token punctuation">,</span> metaOutputPath<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token comment">// 1. 构造配置参数</span>
    <span class="token class-name">Meta</span> meta <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Meta</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    meta<span class="token punctuation">.</span><span class="token function">setName</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
    meta<span class="token punctuation">.</span><span class="token function">setDescription</span><span class="token punctuation">(</span>description<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token class-name">Meta<span class="token punctuation">.</span>FileConfig</span> fileConfig <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Meta<span class="token punctuation">.</span>FileConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    meta<span class="token punctuation">.</span><span class="token function">setFileConfig</span><span class="token punctuation">(</span>fileConfig<span class="token punctuation">)</span><span class="token punctuation">;</span>
    fileConfig<span class="token punctuation">.</span><span class="token function">setSourceRootPath</span><span class="token punctuation">(</span>sourceRootPath<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Meta<span class="token punctuation">.</span>FileConfig<span class="token punctuation">.</span>FileInfo</span><span class="token punctuation">&gt;</span></span> fileInfoList <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    fileConfig<span class="token punctuation">.</span><span class="token function">setFiles</span><span class="token punctuation">(</span>fileInfoList<span class="token punctuation">)</span><span class="token punctuation">;</span>
    fileInfoList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>fileInfo<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token class-name">Meta<span class="token punctuation">.</span>ModelConfig</span> modelConfig <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Meta<span class="token punctuation">.</span>ModelConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    meta<span class="token punctuation">.</span><span class="token function">setModelConfig</span><span class="token punctuation">(</span>modelConfig<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Meta<span class="token punctuation">.</span>ModelConfig<span class="token punctuation">.</span>ModelInfo</span><span class="token punctuation">&gt;</span></span> modelInfoList <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    modelConfig<span class="token punctuation">.</span><span class="token function">setModels</span><span class="token punctuation">(</span>modelInfoList<span class="token punctuation">)</span><span class="token punctuation">;</span>
    modelInfoList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>modelInfo<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 2. 输出元信息文件</span>
    <span class="token class-name">FileUtil</span><span class="token punctuation">.</span><span class="token function">writeUtf8String</span><span class="token punctuation">(</span><span class="token class-name">JSONUtil</span><span class="token punctuation">.</span><span class="token function">toJsonPrettyStr</span><span class="token punctuation">(</span>meta<span class="token punctuation">)</span><span class="token punctuation">,</span> metaOutputPath<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br></div></div><p>一定要注意，追加完配置后，需要去重！否则可能出现多个一模一样的模型参数或文件信息。</p> <p>文件信息根据输入路径 <code>inputPath</code> 去重，使用新值覆盖旧值。代码如下：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">/**
 * 文件去重
 *
 * @param fileInfoList
 * @return
 */</span>
<span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Meta<span class="token punctuation">.</span>FileConfig<span class="token punctuation">.</span>FileInfo</span><span class="token punctuation">&gt;</span></span> <span class="token function">distinctFiles</span><span class="token punctuation">(</span><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Meta<span class="token punctuation">.</span>FileConfig<span class="token punctuation">.</span>FileInfo</span><span class="token punctuation">&gt;</span></span> fileInfoList<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Meta<span class="token punctuation">.</span>FileConfig<span class="token punctuation">.</span>FileInfo</span><span class="token punctuation">&gt;</span></span> newFileInfoList <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>
            fileInfoList<span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                    <span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span>
                            <span class="token class-name">Collectors</span><span class="token punctuation">.</span><span class="token function">toMap</span><span class="token punctuation">(</span><span class="token class-name">Meta<span class="token punctuation">.</span>FileConfig<span class="token punctuation">.</span>FileInfo</span><span class="token operator">::</span><span class="token function">getInputPath</span><span class="token punctuation">,</span> o <span class="token operator">-&gt;</span> o<span class="token punctuation">,</span> <span class="token punctuation">(</span>e<span class="token punctuation">,</span> r<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> r<span class="token punctuation">)</span>
                    <span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">values</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> newFileInfoList<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><p>上述代码中，用到了 Java 8 的 Stream API 和 Lambda 表达式来简化代码，其中 <code>Collectors.toMap</code> 表示将列表转换为 Map，详细解释一下：</p> <ul><li>通过第一个参数（inputPath）作为 key 进行分组</li> <li>通过第二个参数作为 value 存储值（<code>o -&gt; o</code> 表示使用原对象作为 value）</li> <li>最后的 <code>(e, r) -&gt; r</code> 其实是 <code>(exist, replacement) -&gt; replacement</code> 的缩写，表示遇到重复的值是保留新值，返回 exist 表示保留旧值。</li></ul> <p>这样一来，相同 key 对应的文件信息只会保留一个，最后再取所有的 values 拿到所有的文件信息列表即可。</p> <p>模型参数根据属性名称 <code>fieldName</code> 去重，使用新值覆盖旧值。和文件信息去重的实现方式完全一致，代码如下：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">/**
 * 模型去重
 *
 * @param modelInfoList
 * @return
 */</span>
<span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Meta<span class="token punctuation">.</span>ModelConfig<span class="token punctuation">.</span>ModelInfo</span><span class="token punctuation">&gt;</span></span> <span class="token function">distinctModels</span><span class="token punctuation">(</span><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Meta<span class="token punctuation">.</span>ModelConfig<span class="token punctuation">.</span>ModelInfo</span><span class="token punctuation">&gt;</span></span> modelInfoList<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Meta<span class="token punctuation">.</span>ModelConfig<span class="token punctuation">.</span>ModelInfo</span><span class="token punctuation">&gt;</span></span> newModelInfoList <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>
            modelInfoList<span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                    <span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span>
                            <span class="token class-name">Collectors</span><span class="token punctuation">.</span><span class="token function">toMap</span><span class="token punctuation">(</span><span class="token class-name">Meta<span class="token punctuation">.</span>ModelConfig<span class="token punctuation">.</span>ModelInfo</span><span class="token operator">::</span><span class="token function">getFieldName</span><span class="token punctuation">,</span> o <span class="token operator">-&gt;</span> o<span class="token punctuation">,</span> <span class="token punctuation">(</span>e<span class="token punctuation">,</span> r<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> r<span class="token punctuation">)</span>
                    <span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">values</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> newModelInfoList<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><p>然后修改生成配置文件的代码，使用去重方法，并将去重后的配置更新到元信息中：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// 如果已有 meta 文件，说明不是第一次制作，则在 meta 基础上进行修改</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">FileUtil</span><span class="token punctuation">.</span><span class="token function">exist</span><span class="token punctuation">(</span>metaOutputPath<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">Meta</span> oldMeta <span class="token operator">=</span> <span class="token class-name">JSONUtil</span><span class="token punctuation">.</span><span class="token function">toBean</span><span class="token punctuation">(</span><span class="token class-name">FileUtil</span><span class="token punctuation">.</span><span class="token function">readUtf8String</span><span class="token punctuation">(</span>metaOutputPath<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">Meta</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 1. 追加配置参数</span>
    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Meta<span class="token punctuation">.</span>FileConfig<span class="token punctuation">.</span>FileInfo</span><span class="token punctuation">&gt;</span></span> fileInfoList <span class="token operator">=</span> oldMeta<span class="token punctuation">.</span><span class="token function">getFileConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getFiles</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    fileInfoList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>fileInfo<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Meta<span class="token punctuation">.</span>ModelConfig<span class="token punctuation">.</span>ModelInfo</span><span class="token punctuation">&gt;</span></span> modelInfoList <span class="token operator">=</span> oldMeta<span class="token punctuation">.</span><span class="token function">getModelConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getModels</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    modelInfoList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>modelInfo<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 配置去重</span>
    oldMeta<span class="token punctuation">.</span><span class="token function">getFileConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setFiles</span><span class="token punctuation">(</span><span class="token function">distinctFiles</span><span class="token punctuation">(</span>fileInfoList<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    oldMeta<span class="token punctuation">.</span><span class="token function">getModelConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setModels</span><span class="token punctuation">(</span><span class="token function">distinctModels</span><span class="token punctuation">(</span>modelInfoList<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 2.更新元信息文件</span>
    <span class="token class-name">FileUtil</span><span class="token punctuation">.</span><span class="token function">writeUtf8String</span><span class="token punctuation">(</span><span class="token class-name">JSONUtil</span><span class="token punctuation">.</span><span class="token function">toJsonPrettyStr</span><span class="token punctuation">(</span>oldMeta<span class="token punctuation">)</span><span class="token punctuation">,</span> metaOutputPath<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><h4 id="抽象方法"><a href="#抽象方法" class="header-anchor">#</a> 抽象方法</h4> <p>由于我们在接下来的测试中，要多次传入不同的参数执行制作，所以可以先抽象出通用的方法，将所有之前我们在 main 方法中硬编码的值都作为方法的参数。包括 originProjectPath（原始项目路径）、inputFilePath（要制作模板的输入文件相对路径）、modelInfo（模型信息）、searchStr（要替换的模板内容）等。</p> <p>我们还要把所有基本信息配置直接用 Meta 类封装，可以节约方法的参数个数，比如：vZvvLYw3j8nTpc1i6/0xN5tNL9Aw+ZOh8FzCTZZoWmo=</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token class-name">String</span> name <span class="token operator">=</span> <span class="token string">&quot;acm-template-generator&quot;</span><span class="token punctuation">;</span>
<span class="token class-name">String</span> description <span class="token operator">=</span> <span class="token string">&quot;ACM 示例模板生成器&quot;</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>改为：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token class-name">Meta</span> meta <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Meta</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
meta<span class="token punctuation">.</span><span class="token function">setName</span><span class="token punctuation">(</span><span class="token string">&quot;acm-template-generator&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
meta<span class="token punctuation">.</span><span class="token function">setDescription</span><span class="token punctuation">(</span><span class="token string">&quot;ACM 示例模板生成器&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>如果非首次制作，我们还要能使用最后传入的 meta 对象更新元信息的基本配置。可以通过 <code>BeanUtil.copyProperties</code> 复制新对象的属性到老对象（如果属性为空则不复制），从而实现新老 meta 对象的合并。</p> <p>代码如下：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token class-name">Meta</span> oldMeta <span class="token operator">=</span> <span class="token class-name">JSONUtil</span><span class="token punctuation">.</span><span class="token function">toBean</span><span class="token punctuation">(</span><span class="token class-name">FileUtil</span><span class="token punctuation">.</span><span class="token function">readUtf8String</span><span class="token punctuation">(</span>metaOutputPath<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">Meta</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">BeanUtil</span><span class="token punctuation">.</span><span class="token function">copyProperties</span><span class="token punctuation">(</span>meta<span class="token punctuation">,</span> oldMeta<span class="token punctuation">,</span> <span class="token class-name">CopyOptions</span><span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ignoreNullValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>抽象方法后的完整代码如下：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">/**
 * 制作模板
 *
 * @param newMeta
 * @param originProjectPath
 * @param inputFilePath
 * @param modelInfo
 * @param searchStr
 * @param id
 * @return
 */</span>
<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">long</span> <span class="token function">makeTemplate</span><span class="token punctuation">(</span><span class="token class-name">Meta</span> newMeta<span class="token punctuation">,</span> <span class="token class-name">String</span> originProjectPath<span class="token punctuation">,</span> <span class="token class-name">String</span> inputFilePath<span class="token punctuation">,</span> <span class="token class-name">Meta<span class="token punctuation">.</span>ModelConfig<span class="token punctuation">.</span>ModelInfo</span> modelInfo<span class="token punctuation">,</span> <span class="token class-name">String</span> searchStr<span class="token punctuation">,</span> <span class="token class-name">Long</span> id<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 没有 id 则生成</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>id <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        id <span class="token operator">=</span> <span class="token class-name">IdUtil</span><span class="token punctuation">.</span><span class="token function">getSnowflakeNextId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 复制目录</span>
    <span class="token class-name">String</span> projectPath <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">getProperty</span><span class="token punctuation">(</span><span class="token string">&quot;user.dir&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">String</span> tempDirPath <span class="token operator">=</span> projectPath <span class="token operator">+</span> <span class="token class-name">File</span><span class="token punctuation">.</span>separator <span class="token operator">+</span> <span class="token string">&quot;.temp&quot;</span><span class="token punctuation">;</span>
    <span class="token class-name">String</span> templatePath <span class="token operator">=</span> tempDirPath <span class="token operator">+</span> <span class="token class-name">File</span><span class="token punctuation">.</span>separator <span class="token operator">+</span> id<span class="token punctuation">;</span>

    <span class="token comment">// 是否为首次制作模板</span>
    <span class="token comment">// 目录不存在，则是首次制作</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token class-name">FileUtil</span><span class="token punctuation">.</span><span class="token function">exist</span><span class="token punctuation">(</span>templatePath<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">FileUtil</span><span class="token punctuation">.</span><span class="token function">mkdir</span><span class="token punctuation">(</span>templatePath<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">FileUtil</span><span class="token punctuation">.</span><span class="token function">copy</span><span class="token punctuation">(</span>originProjectPath<span class="token punctuation">,</span> templatePath<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 一、输入信息</span>
    <span class="token comment">// 输入文件信息</span>
    <span class="token class-name">String</span> sourceRootPath <span class="token operator">=</span> templatePath <span class="token operator">+</span> <span class="token class-name">File</span><span class="token punctuation">.</span>separator <span class="token operator">+</span> <span class="token class-name">FileUtil</span><span class="token punctuation">.</span><span class="token function">getLastPathEle</span><span class="token punctuation">(</span><span class="token class-name">Paths</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>originProjectPath<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 注意 win 系统需要对路径进行转义</span>
	sourceRootPath <span class="token operator">=</span> sourceRootPath<span class="token punctuation">.</span><span class="token function">replaceAll</span><span class="token punctuation">(</span><span class="token string">&quot;\\\\&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;/&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token class-name">String</span> fileInputPath <span class="token operator">=</span> inputFilePath<span class="token punctuation">;</span>
    <span class="token class-name">String</span> fileOutputPath <span class="token operator">=</span> fileInputPath <span class="token operator">+</span> <span class="token string">&quot;.ftl&quot;</span><span class="token punctuation">;</span>

    <span class="token comment">// 二、使用字符串替换，生成模板文件</span>
    <span class="token class-name">String</span> fileInputAbsolutePath <span class="token operator">=</span> sourceRootPath <span class="token operator">+</span> <span class="token class-name">File</span><span class="token punctuation">.</span>separator <span class="token operator">+</span> fileInputPath<span class="token punctuation">;</span>
    <span class="token class-name">String</span> fileOutputAbsolutePath <span class="token operator">=</span> sourceRootPath <span class="token operator">+</span> <span class="token class-name">File</span><span class="token punctuation">.</span>separator <span class="token operator">+</span> fileOutputPath<span class="token punctuation">;</span>

    <span class="token class-name">String</span> fileContent <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token comment">// 如果已有模板文件，说明不是第一次制作，则在模板基础上再次挖坑</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">FileUtil</span><span class="token punctuation">.</span><span class="token function">exist</span><span class="token punctuation">(</span>fileOutputAbsolutePath<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        fileContent <span class="token operator">=</span> <span class="token class-name">FileUtil</span><span class="token punctuation">.</span><span class="token function">readUtf8String</span><span class="token punctuation">(</span>fileOutputAbsolutePath<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        fileContent <span class="token operator">=</span> <span class="token class-name">FileUtil</span><span class="token punctuation">.</span><span class="token function">readUtf8String</span><span class="token punctuation">(</span>fileInputAbsolutePath<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token class-name">String</span> replacement <span class="token operator">=</span> <span class="token class-name">String</span><span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token string">&quot;${%s}&quot;</span><span class="token punctuation">,</span> modelInfo<span class="token punctuation">.</span><span class="token function">getFieldName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">String</span> newFileContent <span class="token operator">=</span> <span class="token class-name">StrUtil</span><span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span>fileContent<span class="token punctuation">,</span> searchStr<span class="token punctuation">,</span> replacement<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 输出模板文件</span>
    <span class="token class-name">FileUtil</span><span class="token punctuation">.</span><span class="token function">writeUtf8String</span><span class="token punctuation">(</span>newFileContent<span class="token punctuation">,</span> fileOutputAbsolutePath<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 文件配置信息</span>
    <span class="token class-name">Meta<span class="token punctuation">.</span>FileConfig<span class="token punctuation">.</span>FileInfo</span> fileInfo <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Meta<span class="token punctuation">.</span>FileConfig<span class="token punctuation">.</span>FileInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    fileInfo<span class="token punctuation">.</span><span class="token function">setInputPath</span><span class="token punctuation">(</span>fileInputPath<span class="token punctuation">)</span><span class="token punctuation">;</span>
    fileInfo<span class="token punctuation">.</span><span class="token function">setOutputPath</span><span class="token punctuation">(</span>fileOutputPath<span class="token punctuation">)</span><span class="token punctuation">;</span>
    fileInfo<span class="token punctuation">.</span><span class="token function">setType</span><span class="token punctuation">(</span><span class="token class-name">FileTypeEnum</span><span class="token punctuation">.</span><span class="token constant">FILE</span><span class="token punctuation">.</span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    fileInfo<span class="token punctuation">.</span><span class="token function">setGenerateType</span><span class="token punctuation">(</span><span class="token class-name">FileGenerateTypeEnum</span><span class="token punctuation">.</span><span class="token constant">DYNAMIC</span><span class="token punctuation">.</span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 三、生成配置文件</span>
    <span class="token class-name">String</span> metaOutputPath <span class="token operator">=</span> sourceRootPath <span class="token operator">+</span> <span class="token class-name">File</span><span class="token punctuation">.</span>separator <span class="token operator">+</span> <span class="token string">&quot;meta.json&quot;</span><span class="token punctuation">;</span>

    <span class="token comment">// 如果已有 meta 文件，说明不是第一次制作，则在 meta 基础上进行修改</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">FileUtil</span><span class="token punctuation">.</span><span class="token function">exist</span><span class="token punctuation">(</span>metaOutputPath<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Meta</span> oldMeta <span class="token operator">=</span> <span class="token class-name">JSONUtil</span><span class="token punctuation">.</span><span class="token function">toBean</span><span class="token punctuation">(</span><span class="token class-name">FileUtil</span><span class="token punctuation">.</span><span class="token function">readUtf8String</span><span class="token punctuation">(</span>metaOutputPath<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">Meta</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">BeanUtil</span><span class="token punctuation">.</span><span class="token function">copyProperties</span><span class="token punctuation">(</span>newMeta<span class="token punctuation">,</span> oldMeta<span class="token punctuation">,</span> <span class="token class-name">CopyOptions</span><span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ignoreNullValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        newMeta <span class="token operator">=</span> oldMeta<span class="token punctuation">;</span>

        <span class="token comment">// 1. 追加配置参数</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Meta<span class="token punctuation">.</span>FileConfig<span class="token punctuation">.</span>FileInfo</span><span class="token punctuation">&gt;</span></span> fileInfoList <span class="token operator">=</span> newMeta<span class="token punctuation">.</span><span class="token function">getFileConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getFiles</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        fileInfoList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>fileInfo<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Meta<span class="token punctuation">.</span>ModelConfig<span class="token punctuation">.</span>ModelInfo</span><span class="token punctuation">&gt;</span></span> modelInfoList <span class="token operator">=</span> newMeta<span class="token punctuation">.</span><span class="token function">getModelConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getModels</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        modelInfoList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>modelInfo<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 配置去重</span>
        newMeta<span class="token punctuation">.</span><span class="token function">getFileConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setFiles</span><span class="token punctuation">(</span><span class="token function">distinctFiles</span><span class="token punctuation">(</span>fileInfoList<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        newMeta<span class="token punctuation">.</span><span class="token function">getModelConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setModels</span><span class="token punctuation">(</span><span class="token function">distinctModels</span><span class="token punctuation">(</span>modelInfoList<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token comment">// 1. 构造配置参数</span>
        <span class="token class-name">Meta<span class="token punctuation">.</span>FileConfig</span> fileConfig <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Meta<span class="token punctuation">.</span>FileConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        newMeta<span class="token punctuation">.</span><span class="token function">setFileConfig</span><span class="token punctuation">(</span>fileConfig<span class="token punctuation">)</span><span class="token punctuation">;</span>
        fileConfig<span class="token punctuation">.</span><span class="token function">setSourceRootPath</span><span class="token punctuation">(</span>sourceRootPath<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Meta<span class="token punctuation">.</span>FileConfig<span class="token punctuation">.</span>FileInfo</span><span class="token punctuation">&gt;</span></span> fileInfoList <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        fileConfig<span class="token punctuation">.</span><span class="token function">setFiles</span><span class="token punctuation">(</span>fileInfoList<span class="token punctuation">)</span><span class="token punctuation">;</span>
        fileInfoList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>fileInfo<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">Meta<span class="token punctuation">.</span>ModelConfig</span> modelConfig <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Meta<span class="token punctuation">.</span>ModelConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        newMeta<span class="token punctuation">.</span><span class="token function">setModelConfig</span><span class="token punctuation">(</span>modelConfig<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Meta<span class="token punctuation">.</span>ModelConfig<span class="token punctuation">.</span>ModelInfo</span><span class="token punctuation">&gt;</span></span> modelInfoList <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        modelConfig<span class="token punctuation">.</span><span class="token function">setModels</span><span class="token punctuation">(</span>modelInfoList<span class="token punctuation">)</span><span class="token punctuation">;</span>
        modelInfoList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>modelInfo<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 2. 输出元信息文件</span>
    <span class="token class-name">FileUtil</span><span class="token punctuation">.</span><span class="token function">writeUtf8String</span><span class="token punctuation">(</span><span class="token class-name">JSONUtil</span><span class="token punctuation">.</span><span class="token function">toJsonPrettyStr</span><span class="token punctuation">(</span>newMeta<span class="token punctuation">)</span><span class="token punctuation">,</span> metaOutputPath<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> id<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br></div></div><h4 id="测试"><a href="#测试" class="header-anchor">#</a> 测试</h4> <p>最后，在 main 方法中指定 2 套不同的模型参数信息作为测试数据，并调用 <code>makeTemplate</code> 方法。</p> <p>代码如下：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">Meta</span> meta <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Meta</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    meta<span class="token punctuation">.</span><span class="token function">setName</span><span class="token punctuation">(</span><span class="token string">&quot;acm-template-generator&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    meta<span class="token punctuation">.</span><span class="token function">setDescription</span><span class="token punctuation">(</span><span class="token string">&quot;ACM 示例模板生成器&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token class-name">String</span> projectPath <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">getProperty</span><span class="token punctuation">(</span><span class="token string">&quot;user.dir&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">String</span> originProjectPath <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span>projectPath<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getParent</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token class-name">File</span><span class="token punctuation">.</span>separator <span class="token operator">+</span> <span class="token string">&quot;yuzi-generator-demo-projects/acm-template&quot;</span><span class="token punctuation">;</span>
    <span class="token class-name">String</span> inputFilePath <span class="token operator">=</span> <span class="token string">&quot;src/com/yupi/acm/MainTemplate.java&quot;</span><span class="token punctuation">;</span>


    <span class="token comment">// 模型参数信息（首次）</span>
    <span class="token class-name">Meta<span class="token punctuation">.</span>ModelConfig<span class="token punctuation">.</span>ModelInfo</span> modelInfo <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Meta<span class="token punctuation">.</span>ModelConfig<span class="token punctuation">.</span>ModelInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    modelInfo<span class="token punctuation">.</span><span class="token function">setFieldName</span><span class="token punctuation">(</span><span class="token string">&quot;outputText&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    modelInfo<span class="token punctuation">.</span><span class="token function">setType</span><span class="token punctuation">(</span><span class="token string">&quot;String&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    modelInfo<span class="token punctuation">.</span><span class="token function">setDefaultValue</span><span class="token punctuation">(</span><span class="token string">&quot;sum = &quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 模型参数信息（第二次）</span>
<span class="token comment">//        Meta.ModelConfig.ModelInfo modelInfo = new Meta.ModelConfig.ModelInfo();</span>
<span class="token comment">//        modelInfo.setFieldName(&quot;className&quot;);</span>
<span class="token comment">//        modelInfo.setType(&quot;String&quot;);</span>

    <span class="token comment">// 替换变量（首次）</span>
    <span class="token class-name">String</span> searchStr <span class="token operator">=</span> <span class="token string">&quot;Sum: &quot;</span><span class="token punctuation">;</span>
    <span class="token comment">// 替换变量（第二次）</span>
<span class="token comment">//        String searchStr = &quot;MainTemplate&quot;;</span>

    <span class="token keyword">long</span> id <span class="token operator">=</span> <span class="token function">makeTemplate</span><span class="token punctuation">(</span>meta<span class="token punctuation">,</span> originProjectPath<span class="token punctuation">,</span> inputFilePath<span class="token punctuation">,</span> modelInfo<span class="token punctuation">,</span> searchStr<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br></div></div><p>第一次执行，成功制作模板并生成元信息，返回了一个新的 id：</p> <p><img alt="image.png" data-src="https://img.xiaoying.org.cn/img/202502181319316.png" loading="lazy" class="lazy"></p> <p>将得到的 id 作为 <code>makeTemplate</code> 方法的参数，修改传入的模型信息和替换变量：</p> <p><img alt="image.png" data-src="https://img.xiaoying.org.cn/img/202502181320065.png" loading="lazy" class="lazy"></p> <p>然后再次执行，可以发现模板文件又多 “挖了一个坑”，并且元信息配置多加了一个模型参数：</p> <p><img alt="image.png" data-src="https://img.xiaoying.org.cn/img/202502181320363.png" loading="lazy" class="lazy"></p> <h4 id="完整代码"><a href="#完整代码" class="header-anchor">#</a> 完整代码</h4> <p><code>TemplateMaker</code> 的完整代码如下：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>yupi<span class="token punctuation">.</span>maker<span class="token punctuation">.</span>template</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">cn<span class="token punctuation">.</span>hutool<span class="token punctuation">.</span>core<span class="token punctuation">.</span>bean<span class="token punctuation">.</span></span><span class="token class-name">BeanUtil</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">cn<span class="token punctuation">.</span>hutool<span class="token punctuation">.</span>core<span class="token punctuation">.</span>bean<span class="token punctuation">.</span>copier<span class="token punctuation">.</span></span><span class="token class-name">CopyOptions</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">cn<span class="token punctuation">.</span>hutool<span class="token punctuation">.</span>core<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">FileUtil</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">cn<span class="token punctuation">.</span>hutool<span class="token punctuation">.</span>core<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">IdUtil</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">cn<span class="token punctuation">.</span>hutool<span class="token punctuation">.</span>core<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">StrUtil</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">cn<span class="token punctuation">.</span>hutool<span class="token punctuation">.</span>json<span class="token punctuation">.</span></span><span class="token class-name">JSONUtil</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>yupi<span class="token punctuation">.</span>maker<span class="token punctuation">.</span>meta<span class="token punctuation">.</span></span><span class="token class-name">Meta</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>yupi<span class="token punctuation">.</span>maker<span class="token punctuation">.</span>meta<span class="token punctuation">.</span>enums<span class="token punctuation">.</span></span><span class="token class-name">FileGenerateTypeEnum</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>yupi<span class="token punctuation">.</span>maker<span class="token punctuation">.</span>meta<span class="token punctuation">.</span>enums<span class="token punctuation">.</span></span><span class="token class-name">FileTypeEnum</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">File</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>nio<span class="token punctuation">.</span>file<span class="token punctuation">.</span></span><span class="token class-name">Paths</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">ArrayList</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">List</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>stream<span class="token punctuation">.</span></span><span class="token class-name">Collectors</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TemplateMaker</span> <span class="token punctuation">{</span>

    <span class="token comment">/**
     * 制作模板
     *
     * @param newMeta
     * @param originProjectPath
     * @param inputFilePath
     * @param modelInfo
     * @param searchStr
     * @param id
     * @return
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">long</span> <span class="token function">makeTemplate</span><span class="token punctuation">(</span><span class="token class-name">Meta</span> newMeta<span class="token punctuation">,</span> <span class="token class-name">String</span> originProjectPath<span class="token punctuation">,</span> <span class="token class-name">String</span> inputFilePath<span class="token punctuation">,</span> <span class="token class-name">Meta<span class="token punctuation">.</span>ModelConfig<span class="token punctuation">.</span>ModelInfo</span> modelInfo<span class="token punctuation">,</span> <span class="token class-name">String</span> searchStr<span class="token punctuation">,</span> <span class="token class-name">Long</span> id<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 没有 id 则生成</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>id <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            id <span class="token operator">=</span> <span class="token class-name">IdUtil</span><span class="token punctuation">.</span><span class="token function">getSnowflakeNextId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token comment">// 复制目录</span>
        <span class="token class-name">String</span> projectPath <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">getProperty</span><span class="token punctuation">(</span><span class="token string">&quot;user.dir&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> tempDirPath <span class="token operator">=</span> projectPath <span class="token operator">+</span> <span class="token class-name">File</span><span class="token punctuation">.</span>separator <span class="token operator">+</span> <span class="token string">&quot;.temp&quot;</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> templatePath <span class="token operator">=</span> tempDirPath <span class="token operator">+</span> <span class="token class-name">File</span><span class="token punctuation">.</span>separator <span class="token operator">+</span> id<span class="token punctuation">;</span>

        <span class="token comment">// 是否为首次制作模板</span>
        <span class="token comment">// 目录不存在，则是首次制作</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token class-name">FileUtil</span><span class="token punctuation">.</span><span class="token function">exist</span><span class="token punctuation">(</span>templatePath<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">FileUtil</span><span class="token punctuation">.</span><span class="token function">mkdir</span><span class="token punctuation">(</span>templatePath<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">FileUtil</span><span class="token punctuation">.</span><span class="token function">copy</span><span class="token punctuation">(</span>originProjectPath<span class="token punctuation">,</span> templatePath<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token comment">// 一、输入信息</span>
        <span class="token comment">// 输入文件信息</span>
        <span class="token class-name">String</span> sourceRootPath <span class="token operator">=</span> templatePath <span class="token operator">+</span> <span class="token class-name">File</span><span class="token punctuation">.</span>separator <span class="token operator">+</span> <span class="token class-name">FileUtil</span><span class="token punctuation">.</span><span class="token function">getLastPathEle</span><span class="token punctuation">(</span><span class="token class-name">Paths</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>originProjectPath<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 注意 win 系统需要对路径进行转义</span>
		sourceRootPath <span class="token operator">=</span> sourceRootPath<span class="token punctuation">.</span><span class="token function">replaceAll</span><span class="token punctuation">(</span><span class="token string">&quot;\\\\&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;/&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> fileInputPath <span class="token operator">=</span> inputFilePath<span class="token punctuation">;</span>
        <span class="token class-name">String</span> fileOutputPath <span class="token operator">=</span> fileInputPath <span class="token operator">+</span> <span class="token string">&quot;.ftl&quot;</span><span class="token punctuation">;</span>

        <span class="token comment">// 二、使用字符串替换，生成模板文件</span>
        <span class="token class-name">String</span> fileInputAbsolutePath <span class="token operator">=</span> sourceRootPath <span class="token operator">+</span> <span class="token class-name">File</span><span class="token punctuation">.</span>separator <span class="token operator">+</span> fileInputPath<span class="token punctuation">;</span>
        <span class="token class-name">String</span> fileOutputAbsolutePath <span class="token operator">=</span> sourceRootPath <span class="token operator">+</span> <span class="token class-name">File</span><span class="token punctuation">.</span>separator <span class="token operator">+</span> fileOutputPath<span class="token punctuation">;</span>

        <span class="token class-name">String</span> fileContent <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token comment">// 如果已有模板文件，说明不是第一次制作，则在模板基础上再次挖坑</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">FileUtil</span><span class="token punctuation">.</span><span class="token function">exist</span><span class="token punctuation">(</span>fileOutputAbsolutePath<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            fileContent <span class="token operator">=</span> <span class="token class-name">FileUtil</span><span class="token punctuation">.</span><span class="token function">readUtf8String</span><span class="token punctuation">(</span>fileOutputAbsolutePath<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            fileContent <span class="token operator">=</span> <span class="token class-name">FileUtil</span><span class="token punctuation">.</span><span class="token function">readUtf8String</span><span class="token punctuation">(</span>fileInputAbsolutePath<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token class-name">String</span> replacement <span class="token operator">=</span> <span class="token class-name">String</span><span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token string">&quot;${%s}&quot;</span><span class="token punctuation">,</span> modelInfo<span class="token punctuation">.</span><span class="token function">getFieldName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> newFileContent <span class="token operator">=</span> <span class="token class-name">StrUtil</span><span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span>fileContent<span class="token punctuation">,</span> searchStr<span class="token punctuation">,</span> replacement<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 输出模板文件</span>
        <span class="token class-name">FileUtil</span><span class="token punctuation">.</span><span class="token function">writeUtf8String</span><span class="token punctuation">(</span>newFileContent<span class="token punctuation">,</span> fileOutputAbsolutePath<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 文件配置信息</span>
        <span class="token class-name">Meta<span class="token punctuation">.</span>FileConfig<span class="token punctuation">.</span>FileInfo</span> fileInfo <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Meta<span class="token punctuation">.</span>FileConfig<span class="token punctuation">.</span>FileInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        fileInfo<span class="token punctuation">.</span><span class="token function">setInputPath</span><span class="token punctuation">(</span>fileInputPath<span class="token punctuation">)</span><span class="token punctuation">;</span>
        fileInfo<span class="token punctuation">.</span><span class="token function">setOutputPath</span><span class="token punctuation">(</span>fileOutputPath<span class="token punctuation">)</span><span class="token punctuation">;</span>
        fileInfo<span class="token punctuation">.</span><span class="token function">setType</span><span class="token punctuation">(</span><span class="token class-name">FileTypeEnum</span><span class="token punctuation">.</span><span class="token constant">FILE</span><span class="token punctuation">.</span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        fileInfo<span class="token punctuation">.</span><span class="token function">setGenerateType</span><span class="token punctuation">(</span><span class="token class-name">FileGenerateTypeEnum</span><span class="token punctuation">.</span><span class="token constant">DYNAMIC</span><span class="token punctuation">.</span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 三、生成配置文件</span>
        <span class="token class-name">String</span> metaOutputPath <span class="token operator">=</span> sourceRootPath <span class="token operator">+</span> <span class="token class-name">File</span><span class="token punctuation">.</span>separator <span class="token operator">+</span> <span class="token string">&quot;meta.json&quot;</span><span class="token punctuation">;</span>

        <span class="token comment">// 如果已有 meta 文件，说明不是第一次制作，则在 meta 基础上进行修改</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">FileUtil</span><span class="token punctuation">.</span><span class="token function">exist</span><span class="token punctuation">(</span>metaOutputPath<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">Meta</span> oldMeta <span class="token operator">=</span> <span class="token class-name">JSONUtil</span><span class="token punctuation">.</span><span class="token function">toBean</span><span class="token punctuation">(</span><span class="token class-name">FileUtil</span><span class="token punctuation">.</span><span class="token function">readUtf8String</span><span class="token punctuation">(</span>metaOutputPath<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">Meta</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">BeanUtil</span><span class="token punctuation">.</span><span class="token function">copyProperties</span><span class="token punctuation">(</span>newMeta<span class="token punctuation">,</span> oldMeta<span class="token punctuation">,</span> <span class="token class-name">CopyOptions</span><span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ignoreNullValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            newMeta <span class="token operator">=</span> oldMeta<span class="token punctuation">;</span>

            <span class="token comment">// 1. 追加配置参数</span>
            <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Meta<span class="token punctuation">.</span>FileConfig<span class="token punctuation">.</span>FileInfo</span><span class="token punctuation">&gt;</span></span> fileInfoList <span class="token operator">=</span> newMeta<span class="token punctuation">.</span><span class="token function">getFileConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getFiles</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            fileInfoList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>fileInfo<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Meta<span class="token punctuation">.</span>ModelConfig<span class="token punctuation">.</span>ModelInfo</span><span class="token punctuation">&gt;</span></span> modelInfoList <span class="token operator">=</span> newMeta<span class="token punctuation">.</span><span class="token function">getModelConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getModels</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            modelInfoList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>modelInfo<span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment">// 配置去重</span>
            newMeta<span class="token punctuation">.</span><span class="token function">getFileConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setFiles</span><span class="token punctuation">(</span><span class="token function">distinctFiles</span><span class="token punctuation">(</span>fileInfoList<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            newMeta<span class="token punctuation">.</span><span class="token function">getModelConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setModels</span><span class="token punctuation">(</span><span class="token function">distinctModels</span><span class="token punctuation">(</span>modelInfoList<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token comment">// 1. 构造配置参数</span>
            <span class="token class-name">Meta<span class="token punctuation">.</span>FileConfig</span> fileConfig <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Meta<span class="token punctuation">.</span>FileConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            newMeta<span class="token punctuation">.</span><span class="token function">setFileConfig</span><span class="token punctuation">(</span>fileConfig<span class="token punctuation">)</span><span class="token punctuation">;</span>
            fileConfig<span class="token punctuation">.</span><span class="token function">setSourceRootPath</span><span class="token punctuation">(</span>sourceRootPath<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Meta<span class="token punctuation">.</span>FileConfig<span class="token punctuation">.</span>FileInfo</span><span class="token punctuation">&gt;</span></span> fileInfoList <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            fileConfig<span class="token punctuation">.</span><span class="token function">setFiles</span><span class="token punctuation">(</span>fileInfoList<span class="token punctuation">)</span><span class="token punctuation">;</span>
            fileInfoList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>fileInfo<span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token class-name">Meta<span class="token punctuation">.</span>ModelConfig</span> modelConfig <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Meta<span class="token punctuation">.</span>ModelConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            newMeta<span class="token punctuation">.</span><span class="token function">setModelConfig</span><span class="token punctuation">(</span>modelConfig<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Meta<span class="token punctuation">.</span>ModelConfig<span class="token punctuation">.</span>ModelInfo</span><span class="token punctuation">&gt;</span></span> modelInfoList <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            modelConfig<span class="token punctuation">.</span><span class="token function">setModels</span><span class="token punctuation">(</span>modelInfoList<span class="token punctuation">)</span><span class="token punctuation">;</span>
            modelInfoList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>modelInfo<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token comment">// 2. 输出元信息文件</span>
        <span class="token class-name">FileUtil</span><span class="token punctuation">.</span><span class="token function">writeUtf8String</span><span class="token punctuation">(</span><span class="token class-name">JSONUtil</span><span class="token punctuation">.</span><span class="token function">toJsonPrettyStr</span><span class="token punctuation">(</span>newMeta<span class="token punctuation">)</span><span class="token punctuation">,</span> metaOutputPath<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> id<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Meta</span> meta <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Meta</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        meta<span class="token punctuation">.</span><span class="token function">setName</span><span class="token punctuation">(</span><span class="token string">&quot;acm-template-generator&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        meta<span class="token punctuation">.</span><span class="token function">setDescription</span><span class="token punctuation">(</span><span class="token string">&quot;ACM 示例模板生成器&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">String</span> projectPath <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">getProperty</span><span class="token punctuation">(</span><span class="token string">&quot;user.dir&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> originProjectPath <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span>projectPath<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getParent</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token class-name">File</span><span class="token punctuation">.</span>separator <span class="token operator">+</span> <span class="token string">&quot;yuzi-generator-demo-projects/acm-template&quot;</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> inputFilePath <span class="token operator">=</span> <span class="token string">&quot;src/com/yupi/acm/MainTemplate.java&quot;</span><span class="token punctuation">;</span>


        <span class="token comment">// 模型参数信息（首次）</span>
<span class="token comment">//        Meta.ModelConfig.ModelInfo modelInfo = new Meta.ModelConfig.ModelInfo();</span>
<span class="token comment">//        modelInfo.setFieldName(&quot;outputText&quot;);</span>
<span class="token comment">//        modelInfo.setType(&quot;String&quot;);</span>
<span class="token comment">//        modelInfo.setDefaultValue(&quot;sum = &quot;);</span>

        <span class="token comment">// 模型参数信息（第二次）</span>
        <span class="token class-name">Meta<span class="token punctuation">.</span>ModelConfig<span class="token punctuation">.</span>ModelInfo</span> modelInfo <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Meta<span class="token punctuation">.</span>ModelConfig<span class="token punctuation">.</span>ModelInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        modelInfo<span class="token punctuation">.</span><span class="token function">setFieldName</span><span class="token punctuation">(</span><span class="token string">&quot;className&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        modelInfo<span class="token punctuation">.</span><span class="token function">setType</span><span class="token punctuation">(</span><span class="token string">&quot;String&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 替换变量（首次）</span>
<span class="token comment">//        String searchStr = &quot;Sum: &quot;;</span>
        <span class="token comment">// 替换变量（第二次）</span>
        <span class="token class-name">String</span> searchStr <span class="token operator">=</span> <span class="token string">&quot;MainTemplate&quot;</span><span class="token punctuation">;</span>

        <span class="token keyword">long</span> id <span class="token operator">=</span> <span class="token function">makeTemplate</span><span class="token punctuation">(</span>meta<span class="token punctuation">,</span> originProjectPath<span class="token punctuation">,</span> inputFilePath<span class="token punctuation">,</span> modelInfo<span class="token punctuation">,</span> searchStr<span class="token punctuation">,</span> <span class="token number">1735281524670181376L</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * 模型去重
     *
     * @param modelInfoList
     * @return
     */</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Meta<span class="token punctuation">.</span>ModelConfig<span class="token punctuation">.</span>ModelInfo</span><span class="token punctuation">&gt;</span></span> <span class="token function">distinctModels</span><span class="token punctuation">(</span><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Meta<span class="token punctuation">.</span>ModelConfig<span class="token punctuation">.</span>ModelInfo</span><span class="token punctuation">&gt;</span></span> modelInfoList<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Meta<span class="token punctuation">.</span>ModelConfig<span class="token punctuation">.</span>ModelInfo</span><span class="token punctuation">&gt;</span></span> newModelInfoList <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>modelInfoList<span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span><span class="token class-name">Collectors</span><span class="token punctuation">.</span><span class="token function">toMap</span><span class="token punctuation">(</span><span class="token class-name">Meta<span class="token punctuation">.</span>ModelConfig<span class="token punctuation">.</span>ModelInfo</span><span class="token operator">::</span><span class="token function">getFieldName</span><span class="token punctuation">,</span> o <span class="token operator">-&gt;</span> o<span class="token punctuation">,</span> <span class="token punctuation">(</span>e<span class="token punctuation">,</span> r<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> r<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">values</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> newModelInfoList<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * 文件去重
     *
     * @param fileInfoList
     * @return
     */</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Meta<span class="token punctuation">.</span>FileConfig<span class="token punctuation">.</span>FileInfo</span><span class="token punctuation">&gt;</span></span> <span class="token function">distinctFiles</span><span class="token punctuation">(</span><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Meta<span class="token punctuation">.</span>FileConfig<span class="token punctuation">.</span>FileInfo</span><span class="token punctuation">&gt;</span></span> fileInfoList<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Meta<span class="token punctuation">.</span>FileConfig<span class="token punctuation">.</span>FileInfo</span><span class="token punctuation">&gt;</span></span> newFileInfoList <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>fileInfoList<span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span><span class="token class-name">Collectors</span><span class="token punctuation">.</span><span class="token function">toMap</span><span class="token punctuation">(</span><span class="token class-name">Meta<span class="token punctuation">.</span>FileConfig<span class="token punctuation">.</span>FileInfo</span><span class="token operator">::</span><span class="token function">getInputPath</span><span class="token punctuation">,</span> o <span class="token operator">-&gt;</span> o<span class="token punctuation">,</span> <span class="token punctuation">(</span>e<span class="token punctuation">,</span> r<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> r<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">values</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> newFileInfoList<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br><span class="line-number">103</span><br><span class="line-number">104</span><br><span class="line-number">105</span><br><span class="line-number">106</span><br><span class="line-number">107</span><br><span class="line-number">108</span><br><span class="line-number">109</span><br><span class="line-number">110</span><br><span class="line-number">111</span><br><span class="line-number">112</span><br><span class="line-number">113</span><br><span class="line-number">114</span><br><span class="line-number">115</span><br><span class="line-number">116</span><br><span class="line-number">117</span><br><span class="line-number">118</span><br><span class="line-number">119</span><br><span class="line-number">120</span><br><span class="line-number">121</span><br><span class="line-number">122</span><br><span class="line-number">123</span><br><span class="line-number">124</span><br><span class="line-number">125</span><br><span class="line-number">126</span><br><span class="line-number">127</span><br><span class="line-number">128</span><br><span class="line-number">129</span><br><span class="line-number">130</span><br><span class="line-number">131</span><br><span class="line-number">132</span><br><span class="line-number">133</span><br><span class="line-number">134</span><br><span class="line-number">135</span><br><span class="line-number">136</span><br><span class="line-number">137</span><br><span class="line-number">138</span><br><span class="line-number">139</span><br><span class="line-number">140</span><br><span class="line-number">141</span><br><span class="line-number">142</span><br><span class="line-number">143</span><br><span class="line-number">144</span><br><span class="line-number">145</span><br><span class="line-number">146</span><br><span class="line-number">147</span><br><span class="line-number">148</span><br><span class="line-number">149</span><br><span class="line-number">150</span><br><span class="line-number">151</span><br><span class="line-number">152</span><br><span class="line-number">153</span><br><span class="line-number">154</span><br><span class="line-number">155</span><br><span class="line-number">156</span><br><span class="line-number">157</span><br><span class="line-number">158</span><br><span class="line-number">159</span><br><span class="line-number">160</span><br><span class="line-number">161</span><br><span class="line-number">162</span><br><span class="line-number">163</span><br><span class="line-number">164</span><br><span class="line-number">165</span><br><span class="line-number">166</span><br><span class="line-number">167</span><br><span class="line-number">168</span><br><span class="line-number">169</span><br><span class="line-number">170</span><br><span class="line-number">171</span><br><span class="line-number">172</span><br></div></div><hr> <p>至此，分步制作能力开发完成。你还可以试着多次修改 meta 的基本信息，也是可以正确更新的。</p> <p>实现了这个能力后，我们不仅可以依次使用多个模型参数对同一个文件 “挖坑”，也可以使用同一个模型参数依次对多个不同的文件挖坑。已经能够满足像 ACM 示例模板这种简单的项目了。</p> <p>接下来，我们要给模板制作工具增加更多的功能，进一步提高使用的效率、并尽力满足 Spring Boot 模板项目代码生成器所需的能力。</p> <h2 id="四、更多功能实现"><a href="#四、更多功能实现" class="header-anchor">#</a> 四、更多功能实现</h2> <h3 id="_1、单次制作多个模板文件"><a href="#_1、单次制作多个模板文件" class="header-anchor">#</a> 1、单次制作多个模板文件</h3> <p>虽然现在模板制作工具可以通过多次执行来制作多个模板文件，但还是比较麻烦。对于我们之前提到的 “批量替换项目下所有文件包名” 的需求，可能需要制作几十个模板文件，难道要执行几十次么？</p> <p>所以我们需要实现多模板文件同时制作的能力。</p> <p>有 2 种方法：</p> <ol><li>支持输入文件目录，同时处理该目录下的所有文件</li> <li>支持输入多个文件路径，同时处理这些文件</li></ol> <p>下面依次实现这两种方法。</p> <h4 id="支持输入文件目录"><a href="#支持输入文件目录" class="header-anchor">#</a> 支持输入文件目录</h4> <p>实现思路很简单，之前我们已经能针对单个文件制作模板了。那么对于文件目录下的多个文件，只要循环遍历 “单个文件制作模板” 的操作，不就能轻松实现了么？</p> <p>1）所以我们首先需要抽象出制作单个文件模板的方法 <code>makeFileTemplate</code>，接受单个文件、模型信息、替换文本、sourceRootPath 等参数，返回 FileInfo 文件信息。</p> <p>由于之前的输入文件路径是相对路径，而之后我们要遍历文件目录下的所有文件时，传来的文件是绝对路径。所以最好将方法接受的参数，由 String 类型的输入文件路径，修改为 File 类型的输入文件对象。但还要注意一点，在方法内部，要将绝对路径再转换为相对路径，以适配元信息文件的规则。</p> <p>完整代码如下：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">/**
 * 制作文件模板
 *
 * @param modelInfo
 * @param searchStr
 * @param sourceRootPath
 * @param inputFile
 * @return
 */</span>
<span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">Meta<span class="token punctuation">.</span>FileConfig<span class="token punctuation">.</span>FileInfo</span> <span class="token function">makeFileTemplate</span><span class="token punctuation">(</span><span class="token class-name">Meta<span class="token punctuation">.</span>ModelConfig<span class="token punctuation">.</span>ModelInfo</span> modelInfo<span class="token punctuation">,</span> <span class="token class-name">String</span> searchStr<span class="token punctuation">,</span> <span class="token class-name">String</span> sourceRootPath<span class="token punctuation">,</span> <span class="token class-name">File</span> inputFile<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 要挖坑的文件绝对路径（用于制作模板）</span>
    <span class="token comment">// 注意 win 系统需要对路径进行转义</span>
    <span class="token class-name">String</span> fileInputAbsolutePath <span class="token operator">=</span> inputFile<span class="token punctuation">.</span><span class="token function">getAbsolutePath</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">replaceAll</span><span class="token punctuation">(</span><span class="token string">&quot;\\\\&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;/&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">String</span> fileOutputAbsolutePath <span class="token operator">=</span> fileInputAbsolutePath <span class="token operator">+</span> <span class="token string">&quot;.ftl&quot;</span><span class="token punctuation">;</span>

    <span class="token comment">// 文件输入输出相对路径（用于生成配置）</span>
    <span class="token class-name">String</span> fileInputPath <span class="token operator">=</span> fileInputAbsolutePath<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span>sourceRootPath <span class="token operator">+</span> <span class="token string">&quot;/&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">String</span> fileOutputPath <span class="token operator">=</span> fileInputPath <span class="token operator">+</span> <span class="token string">&quot;.ftl&quot;</span><span class="token punctuation">;</span>

    <span class="token comment">// 使用字符串替换，生成模板文件</span>
    <span class="token class-name">String</span> fileContent<span class="token punctuation">;</span>
    <span class="token comment">// 如果已有模板文件，说明不是第一次制作，则在模板基础上再次挖坑</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">FileUtil</span><span class="token punctuation">.</span><span class="token function">exist</span><span class="token punctuation">(</span>fileOutputAbsolutePath<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        fileContent <span class="token operator">=</span> <span class="token class-name">FileUtil</span><span class="token punctuation">.</span><span class="token function">readUtf8String</span><span class="token punctuation">(</span>fileOutputAbsolutePath<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        fileContent <span class="token operator">=</span> <span class="token class-name">FileUtil</span><span class="token punctuation">.</span><span class="token function">readUtf8String</span><span class="token punctuation">(</span>fileInputAbsolutePath<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token class-name">String</span> replacement <span class="token operator">=</span> <span class="token class-name">String</span><span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token string">&quot;${%s}&quot;</span><span class="token punctuation">,</span> modelInfo<span class="token punctuation">.</span><span class="token function">getFieldName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">String</span> newFileContent <span class="token operator">=</span> <span class="token class-name">StrUtil</span><span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span>fileContent<span class="token punctuation">,</span> searchStr<span class="token punctuation">,</span> replacement<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 输出模板文件</span>
    <span class="token class-name">FileUtil</span><span class="token punctuation">.</span><span class="token function">writeUtf8String</span><span class="token punctuation">(</span>newFileContent<span class="token punctuation">,</span> fileOutputAbsolutePath<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 文件配置信息</span>
    <span class="token class-name">Meta<span class="token punctuation">.</span>FileConfig<span class="token punctuation">.</span>FileInfo</span> fileInfo <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Meta<span class="token punctuation">.</span>FileConfig<span class="token punctuation">.</span>FileInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    fileInfo<span class="token punctuation">.</span><span class="token function">setInputPath</span><span class="token punctuation">(</span>fileInputPath<span class="token punctuation">)</span><span class="token punctuation">;</span>
    fileInfo<span class="token punctuation">.</span><span class="token function">setOutputPath</span><span class="token punctuation">(</span>fileOutputPath<span class="token punctuation">)</span><span class="token punctuation">;</span>
    fileInfo<span class="token punctuation">.</span><span class="token function">setType</span><span class="token punctuation">(</span><span class="token class-name">FileTypeEnum</span><span class="token punctuation">.</span><span class="token constant">FILE</span><span class="token punctuation">.</span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    fileInfo<span class="token punctuation">.</span><span class="token function">setGenerateType</span><span class="token punctuation">(</span><span class="token class-name">FileGenerateTypeEnum</span><span class="token punctuation">.</span><span class="token constant">DYNAMIC</span><span class="token punctuation">.</span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> fileInfo<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br></div></div><p>2）如果输入的文件路径是目录，那么使用 Hutool 的 <code>loopFiles</code> 方法递归遍历并获取目录下的所有文件列表。</p> <p>修改 <code>makeTemplate</code> 方法中生成文件的相关代码，如下：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// 一、输入信息</span>
<span class="token comment">// 输入文件信息</span>
<span class="token class-name">String</span> sourceRootPath <span class="token operator">=</span> templatePath <span class="token operator">+</span> <span class="token class-name">File</span><span class="token punctuation">.</span>separator <span class="token operator">+</span> <span class="token class-name">FileUtil</span><span class="token punctuation">.</span><span class="token function">getLastPathEle</span><span class="token punctuation">(</span><span class="token class-name">Paths</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>originProjectPath<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 二、生成文件模板</span>
<span class="token comment">// 输入文件为目录</span>
<span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Meta<span class="token punctuation">.</span>FileConfig<span class="token punctuation">.</span>FileInfo</span><span class="token punctuation">&gt;</span></span> newFileInfoList <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">String</span> inputFileAbsolutePath <span class="token operator">=</span> sourceRootPath <span class="token operator">+</span> <span class="token class-name">File</span><span class="token punctuation">.</span>separator <span class="token operator">+</span> inputFilePath<span class="token punctuation">;</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">FileUtil</span><span class="token punctuation">.</span><span class="token function">isDirectory</span><span class="token punctuation">(</span>inputFileAbsolutePath<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">File</span><span class="token punctuation">&gt;</span></span> fileList <span class="token operator">=</span> <span class="token class-name">FileUtil</span><span class="token punctuation">.</span><span class="token function">loopFiles</span><span class="token punctuation">(</span>inputFileAbsolutePath<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">File</span> file <span class="token operator">:</span> fileList<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Meta<span class="token punctuation">.</span>FileConfig<span class="token punctuation">.</span>FileInfo</span> fileInfo <span class="token operator">=</span> <span class="token function">makeFileTemplate</span><span class="token punctuation">(</span>modelInfo<span class="token punctuation">,</span> searchStr<span class="token punctuation">,</span> sourceRootPath<span class="token punctuation">,</span> file<span class="token punctuation">)</span><span class="token punctuation">;</span>
        newFileInfoList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>fileInfo<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token comment">// 输入的是文件</span>
    <span class="token class-name">Meta<span class="token punctuation">.</span>FileConfig<span class="token punctuation">.</span>FileInfo</span> fileInfo <span class="token operator">=</span> <span class="token function">makeFileTemplate</span><span class="token punctuation">(</span>modelInfo<span class="token punctuation">,</span> searchStr<span class="token punctuation">,</span> sourceRootPath<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span>inputFileAbsolutePath<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    newFileInfoList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>fileInfo<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// 三、生成配置文件</span>
<span class="token class-name">String</span> metaOutputPath <span class="token operator">=</span> sourceRootPath <span class="token operator">+</span> <span class="token class-name">File</span><span class="token punctuation">.</span>separator <span class="token operator">+</span> <span class="token string">&quot;meta.json&quot;</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br></div></div><p>其中，使用 <code>newFileInfoList</code> 来存储所有文件的信息列表。</p> <p>在生成配置文件时，以前是使用 <code>fileInfoList.add</code> 添加一个文件信息对象，现在要改为 <code>fileInfoList.addAll</code> 添加 <code>newFileInfoList</code> 文件信息列表。</p> <p>修改后的代码如下：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// 三、生成配置文件</span>
<span class="token class-name">String</span> metaOutputPath <span class="token operator">=</span> sourceRootPath <span class="token operator">+</span> <span class="token class-name">File</span><span class="token punctuation">.</span>separator <span class="token operator">+</span> <span class="token string">&quot;meta.json&quot;</span><span class="token punctuation">;</span>

<span class="token comment">// 如果已有 meta 文件，说明不是第一次制作，则在 meta 基础上进行修改</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">FileUtil</span><span class="token punctuation">.</span><span class="token function">exist</span><span class="token punctuation">(</span>metaOutputPath<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">Meta</span> oldMeta <span class="token operator">=</span> <span class="token class-name">JSONUtil</span><span class="token punctuation">.</span><span class="token function">toBean</span><span class="token punctuation">(</span><span class="token class-name">FileUtil</span><span class="token punctuation">.</span><span class="token function">readUtf8String</span><span class="token punctuation">(</span>metaOutputPath<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">Meta</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">BeanUtil</span><span class="token punctuation">.</span><span class="token function">copyProperties</span><span class="token punctuation">(</span>newMeta<span class="token punctuation">,</span> oldMeta<span class="token punctuation">,</span> <span class="token class-name">CopyOptions</span><span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ignoreNullValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    newMeta <span class="token operator">=</span> oldMeta<span class="token punctuation">;</span>

    <span class="token comment">// 1. 追加配置参数</span>
    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Meta<span class="token punctuation">.</span>FileConfig<span class="token punctuation">.</span>FileInfo</span><span class="token punctuation">&gt;</span></span> fileInfoList <span class="token operator">=</span> newMeta<span class="token punctuation">.</span><span class="token function">getFileConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getFiles</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    fileInfoList<span class="token punctuation">.</span><span class="token function">addAll</span><span class="token punctuation">(</span>newFileInfoList<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Meta<span class="token punctuation">.</span>ModelConfig<span class="token punctuation">.</span>ModelInfo</span><span class="token punctuation">&gt;</span></span> modelInfoList <span class="token operator">=</span> newMeta<span class="token punctuation">.</span><span class="token function">getModelConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getModels</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    modelInfoList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>modelInfo<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 配置去重</span>
    newMeta<span class="token punctuation">.</span><span class="token function">getFileConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setFiles</span><span class="token punctuation">(</span><span class="token function">distinctFiles</span><span class="token punctuation">(</span>fileInfoList<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    newMeta<span class="token punctuation">.</span><span class="token function">getModelConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setModels</span><span class="token punctuation">(</span><span class="token function">distinctModels</span><span class="token punctuation">(</span>modelInfoList<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token comment">// 1. 构造配置参数</span>
    <span class="token class-name">Meta<span class="token punctuation">.</span>FileConfig</span> fileConfig <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Meta<span class="token punctuation">.</span>FileConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    newMeta<span class="token punctuation">.</span><span class="token function">setFileConfig</span><span class="token punctuation">(</span>fileConfig<span class="token punctuation">)</span><span class="token punctuation">;</span>
    fileConfig<span class="token punctuation">.</span><span class="token function">setSourceRootPath</span><span class="token punctuation">(</span>sourceRootPath<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Meta<span class="token punctuation">.</span>FileConfig<span class="token punctuation">.</span>FileInfo</span><span class="token punctuation">&gt;</span></span> fileInfoList <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    fileConfig<span class="token punctuation">.</span><span class="token function">setFiles</span><span class="token punctuation">(</span>fileInfoList<span class="token punctuation">)</span><span class="token punctuation">;</span>
    fileInfoList<span class="token punctuation">.</span><span class="token function">addAll</span><span class="token punctuation">(</span>newFileInfoList<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token class-name">Meta<span class="token punctuation">.</span>ModelConfig</span> modelConfig <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Meta<span class="token punctuation">.</span>ModelConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    newMeta<span class="token punctuation">.</span><span class="token function">setModelConfig</span><span class="token punctuation">(</span>modelConfig<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Meta<span class="token punctuation">.</span>ModelConfig<span class="token punctuation">.</span>ModelInfo</span><span class="token punctuation">&gt;</span></span> modelInfoList <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    modelConfig<span class="token punctuation">.</span><span class="token function">setModels</span><span class="token punctuation">(</span>modelInfoList<span class="token punctuation">)</span><span class="token punctuation">;</span>
    modelInfoList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>modelInfo<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br></div></div><p>3）修改 main 方法中传入的原始项目路径为 <code>springboot-init</code> 项目，输入文件路径改为 <code>springbootinit</code> 目录：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token class-name">String</span> originProjectPath <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span>projectPath<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getParent</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token class-name">File</span><span class="token punctuation">.</span>separator <span class="token operator">+</span> <span class="token string">&quot;yuzi-generator-demo-projects/springboot-init&quot;</span><span class="token punctuation">;</span>
<span class="token class-name">String</span> inputFilePath <span class="token operator">=</span> <span class="token string">&quot;src/main/java/com/yupi/springbootinit&quot;</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>然后执行测试，目录下的所有文件都生成了模板：</p> <p><img alt="image.png" data-src="https://img.xiaoying.org.cn/img/202502181320495.png" loading="lazy" class="lazy"></p> <p>但是貌似生成的模板有点太多了。。。明明这些文件内没有任何内容被模型参数替换了，但也生成了模板？</p> <p>4）所以这里我们需要优化下逻辑，如果某个文件内容没有被参数替换，那么就不生成模板，而是以静态生成的方式记录到元信息配置中。</p> <p>修改 <code>makeFileTemplate</code> 方法，通过对比替换前后的内容是否一致来更改生成方式。</p> <p>注意，如果是静态生成，文件输出路径（outputPath）要设置为和输入路径（inputPath）相同。</p> <p>修改后的方法代码如下（主要修改了后半段）：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">Meta<span class="token punctuation">.</span>FileConfig<span class="token punctuation">.</span>FileInfo</span> <span class="token function">makeFileTemplate</span><span class="token punctuation">(</span><span class="token class-name">Meta<span class="token punctuation">.</span>ModelConfig<span class="token punctuation">.</span>ModelInfo</span> modelInfo<span class="token punctuation">,</span> <span class="token class-name">String</span> searchStr<span class="token punctuation">,</span> <span class="token class-name">String</span> sourceRootPath<span class="token punctuation">,</span> <span class="token class-name">File</span> inputFile<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 要挖坑的文件绝对路径（用于制作模板）</span>
    <span class="token comment">// 注意 win 系统需要对路径进行转义</span>
    <span class="token class-name">String</span> fileInputAbsolutePath <span class="token operator">=</span> inputFile<span class="token punctuation">.</span><span class="token function">getAbsolutePath</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">replaceAll</span><span class="token punctuation">(</span><span class="token string">&quot;\\\\&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;/&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">String</span> fileOutputAbsolutePath <span class="token operator">=</span> fileInputAbsolutePath <span class="token operator">+</span> <span class="token string">&quot;.ftl&quot;</span><span class="token punctuation">;</span>

    <span class="token comment">// 文件输入输出相对路径（用于生成配置）</span>
    <span class="token class-name">String</span> fileInputPath <span class="token operator">=</span> fileInputAbsolutePath<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span>sourceRootPath <span class="token operator">+</span> <span class="token string">&quot;/&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">String</span> fileOutputPath <span class="token operator">=</span> fileInputPath <span class="token operator">+</span> <span class="token string">&quot;.ftl&quot;</span><span class="token punctuation">;</span>

    <span class="token comment">// 使用字符串替换，生成模板文件</span>
    <span class="token class-name">String</span> fileContent<span class="token punctuation">;</span>
    <span class="token comment">// 如果已有模板文件，说明不是第一次制作，则在模板基础上再次挖坑</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">FileUtil</span><span class="token punctuation">.</span><span class="token function">exist</span><span class="token punctuation">(</span>fileOutputAbsolutePath<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        fileContent <span class="token operator">=</span> <span class="token class-name">FileUtil</span><span class="token punctuation">.</span><span class="token function">readUtf8String</span><span class="token punctuation">(</span>fileOutputAbsolutePath<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        fileContent <span class="token operator">=</span> <span class="token class-name">FileUtil</span><span class="token punctuation">.</span><span class="token function">readUtf8String</span><span class="token punctuation">(</span>fileInputAbsolutePath<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token class-name">String</span> replacement <span class="token operator">=</span> <span class="token class-name">String</span><span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token string">&quot;${%s}&quot;</span><span class="token punctuation">,</span> modelInfo<span class="token punctuation">.</span><span class="token function">getFieldName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">String</span> newFileContent <span class="token operator">=</span> <span class="token class-name">StrUtil</span><span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span>fileContent<span class="token punctuation">,</span> searchStr<span class="token punctuation">,</span> replacement<span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token comment">// 文件配置信息</span>
    <span class="token class-name">Meta<span class="token punctuation">.</span>FileConfig<span class="token punctuation">.</span>FileInfo</span> fileInfo <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Meta<span class="token punctuation">.</span>FileConfig<span class="token punctuation">.</span>FileInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    fileInfo<span class="token punctuation">.</span><span class="token function">setInputPath</span><span class="token punctuation">(</span>fileInputPath<span class="token punctuation">)</span><span class="token punctuation">;</span>
    fileInfo<span class="token punctuation">.</span><span class="token function">setOutputPath</span><span class="token punctuation">(</span>fileOutputPath<span class="token punctuation">)</span><span class="token punctuation">;</span>
    fileInfo<span class="token punctuation">.</span><span class="token function">setType</span><span class="token punctuation">(</span><span class="token class-name">FileTypeEnum</span><span class="token punctuation">.</span><span class="token constant">FILE</span><span class="token punctuation">.</span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 和原文件一致，没有挖坑，则为静态生成</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>newFileContent<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>fileContent<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 输出路径 = 输入路径</span>
        fileInfo<span class="token punctuation">.</span><span class="token function">setOutputPath</span><span class="token punctuation">(</span>fileInputPath<span class="token punctuation">)</span><span class="token punctuation">;</span>
        fileInfo<span class="token punctuation">.</span><span class="token function">setGenerateType</span><span class="token punctuation">(</span><span class="token class-name">FileGenerateTypeEnum</span><span class="token punctuation">.</span><span class="token constant">STATIC</span><span class="token punctuation">.</span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token comment">// 生成模板文件</span>
        fileInfo<span class="token punctuation">.</span><span class="token function">setGenerateType</span><span class="token punctuation">(</span><span class="token class-name">FileGenerateTypeEnum</span><span class="token punctuation">.</span><span class="token constant">DYNAMIC</span><span class="token punctuation">.</span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">FileUtil</span><span class="token punctuation">.</span><span class="token function">writeUtf8String</span><span class="token punctuation">(</span>newFileContent<span class="token punctuation">,</span> fileOutputAbsolutePath<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> fileInfo<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br></div></div><p>5）更改 main 方法中的 <code>searchStr</code> 为 <code>BaseResponse</code>，然后再次执行测试。</p> <p>效果符合预期，springbootinit 包中，包含该字符串的文件才生成了模板：</p> <p><img alt="image.png" data-src="https://img.xiaoying.org.cn/img/202502181320669.png" loading="lazy" class="lazy"></p> <p>查看生成的元信息配置文件，生成了符合要求的静态和动态文件配置：</p> <p><img alt="image.png" data-src="https://img.xiaoying.org.cn/img/202502181321501.png" loading="lazy" class="lazy"></p> <h4 id="支持输入多个文件"><a href="#支持输入多个文件" class="header-anchor">#</a> 支持输入多个文件</h4> <p>如果想在单次制作时支持输入多个文件，其实只要把 <code>makeTemplate</code> 方法的输入参数 <code>inputFilePath</code>（单数）改为 <code>inputFilePathList</code>（复数），再多加一层循环处理即可。</p> <p>修改 <code>makeTemplate</code> 方法中生成文件模板的代码如下：vZvvLYw3j8nTpc1i6/0xN5tNL9Aw+ZOh8FzCTZZoWmo=</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// 二、生成文件模板</span>
<span class="token comment">// 遍历输入文件</span>
<span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Meta<span class="token punctuation">.</span>FileConfig<span class="token punctuation">.</span>FileInfo</span><span class="token punctuation">&gt;</span></span> newFileInfoList <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">String</span> inputFilePath <span class="token operator">:</span> inputFilePathList<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">String</span> inputFileAbsolutePath <span class="token operator">=</span> sourceRootPath <span class="token operator">+</span> <span class="token class-name">File</span><span class="token punctuation">.</span>separator <span class="token operator">+</span> inputFilePath<span class="token punctuation">;</span>
    <span class="token comment">// 输入的是目录</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">FileUtil</span><span class="token punctuation">.</span><span class="token function">isDirectory</span><span class="token punctuation">(</span>inputFileAbsolutePath<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">File</span><span class="token punctuation">&gt;</span></span> fileList <span class="token operator">=</span> <span class="token class-name">FileUtil</span><span class="token punctuation">.</span><span class="token function">loopFiles</span><span class="token punctuation">(</span>inputFileAbsolutePath<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">File</span> file <span class="token operator">:</span> fileList<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">Meta<span class="token punctuation">.</span>FileConfig<span class="token punctuation">.</span>FileInfo</span> fileInfo <span class="token operator">=</span> <span class="token function">makeFileTemplate</span><span class="token punctuation">(</span>modelInfo<span class="token punctuation">,</span> searchStr<span class="token punctuation">,</span> sourceRootPath<span class="token punctuation">,</span> file<span class="token punctuation">)</span><span class="token punctuation">;</span>
            newFileInfoList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>fileInfo<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token comment">// 输入的是文件</span>
        <span class="token class-name">Meta<span class="token punctuation">.</span>FileConfig<span class="token punctuation">.</span>FileInfo</span> fileInfo <span class="token operator">=</span> <span class="token function">makeFileTemplate</span><span class="token punctuation">(</span>modelInfo<span class="token punctuation">,</span> searchStr<span class="token punctuation">,</span> sourceRootPath<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span>inputFileAbsolutePath<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        newFileInfoList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>fileInfo<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><p>然后修改 main 方法中的测试条件为文件列表，验证效果：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token class-name">String</span> inputFilePath1 <span class="token operator">=</span> <span class="token string">&quot;src/main/java/com/yupi/springbootinit/common&quot;</span><span class="token punctuation">;</span>
<span class="token class-name">String</span> inputFilePath2 <span class="token operator">=</span> <span class="token string">&quot;src/main/java/com/yupi/springbootinit/controller&quot;</span><span class="token punctuation">;</span>
<span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> inputFilePathList <span class="token operator">=</span> <span class="token class-name">Arrays</span><span class="token punctuation">.</span><span class="token function">asList</span><span class="token punctuation">(</span>inputFilePath1<span class="token punctuation">,</span> inputFilePath2<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>结果符合预期，同时将多个指定目录下的文件制作成了模板：</p> <p><img alt="image.png" data-src="https://img.xiaoying.org.cn/img/202502181321126.png" loading="lazy" class="lazy"></p> <h4 id="完整代码-2"><a href="#完整代码-2" class="header-anchor">#</a> 完整代码</h4> <p>至此，已经实现了单次制作多个模板文件的功能。</p> <p><code>TemplateMaker</code> 的完整代码如下：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>yupi<span class="token punctuation">.</span>maker<span class="token punctuation">.</span>template</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">cn<span class="token punctuation">.</span>hutool<span class="token punctuation">.</span>core<span class="token punctuation">.</span>bean<span class="token punctuation">.</span></span><span class="token class-name">BeanUtil</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">cn<span class="token punctuation">.</span>hutool<span class="token punctuation">.</span>core<span class="token punctuation">.</span>bean<span class="token punctuation">.</span>copier<span class="token punctuation">.</span></span><span class="token class-name">CopyOptions</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">cn<span class="token punctuation">.</span>hutool<span class="token punctuation">.</span>core<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">FileUtil</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">cn<span class="token punctuation">.</span>hutool<span class="token punctuation">.</span>core<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">IdUtil</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">cn<span class="token punctuation">.</span>hutool<span class="token punctuation">.</span>core<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">StrUtil</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">cn<span class="token punctuation">.</span>hutool<span class="token punctuation">.</span>json<span class="token punctuation">.</span></span><span class="token class-name">JSONUtil</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>yupi<span class="token punctuation">.</span>maker<span class="token punctuation">.</span>meta<span class="token punctuation">.</span></span><span class="token class-name">Meta</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>yupi<span class="token punctuation">.</span>maker<span class="token punctuation">.</span>meta<span class="token punctuation">.</span>enums<span class="token punctuation">.</span></span><span class="token class-name">FileGenerateTypeEnum</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>yupi<span class="token punctuation">.</span>maker<span class="token punctuation">.</span>meta<span class="token punctuation">.</span>enums<span class="token punctuation">.</span></span><span class="token class-name">FileTypeEnum</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">File</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>nio<span class="token punctuation">.</span>file<span class="token punctuation">.</span></span><span class="token class-name">Paths</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">ArrayList</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Arrays</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">List</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>stream<span class="token punctuation">.</span></span><span class="token class-name">Collectors</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TemplateMaker</span> <span class="token punctuation">{</span>

    <span class="token comment">/**
     * 制作模板
     *
     * @param newMeta
     * @param originProjectPath
     * @param inputFilePathList
     * @param modelInfo
     * @param searchStr
     * @param id
     * @return
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">long</span> <span class="token function">makeTemplate</span><span class="token punctuation">(</span><span class="token class-name">Meta</span> newMeta<span class="token punctuation">,</span> <span class="token class-name">String</span> originProjectPath<span class="token punctuation">,</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> inputFilePathList<span class="token punctuation">,</span> <span class="token class-name">Meta<span class="token punctuation">.</span>ModelConfig<span class="token punctuation">.</span>ModelInfo</span> modelInfo<span class="token punctuation">,</span> <span class="token class-name">String</span> searchStr<span class="token punctuation">,</span> <span class="token class-name">Long</span> id<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 没有 id 则生成</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>id <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            id <span class="token operator">=</span> <span class="token class-name">IdUtil</span><span class="token punctuation">.</span><span class="token function">getSnowflakeNextId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token comment">// 复制目录</span>
        <span class="token class-name">String</span> projectPath <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">getProperty</span><span class="token punctuation">(</span><span class="token string">&quot;user.dir&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> tempDirPath <span class="token operator">=</span> projectPath <span class="token operator">+</span> <span class="token class-name">File</span><span class="token punctuation">.</span>separator <span class="token operator">+</span> <span class="token string">&quot;.temp&quot;</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> templatePath <span class="token operator">=</span> tempDirPath <span class="token operator">+</span> <span class="token class-name">File</span><span class="token punctuation">.</span>separator <span class="token operator">+</span> id<span class="token punctuation">;</span>

        <span class="token comment">// 是否为首次制作模板</span>
        <span class="token comment">// 目录不存在，则是首次制作</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token class-name">FileUtil</span><span class="token punctuation">.</span><span class="token function">exist</span><span class="token punctuation">(</span>templatePath<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">FileUtil</span><span class="token punctuation">.</span><span class="token function">mkdir</span><span class="token punctuation">(</span>templatePath<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">FileUtil</span><span class="token punctuation">.</span><span class="token function">copy</span><span class="token punctuation">(</span>originProjectPath<span class="token punctuation">,</span> templatePath<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token comment">// 一、输入信息</span>
        <span class="token comment">// 输入文件信息</span>
        <span class="token class-name">String</span> sourceRootPath <span class="token operator">=</span> templatePath <span class="token operator">+</span> <span class="token class-name">File</span><span class="token punctuation">.</span>separator <span class="token operator">+</span> <span class="token class-name">FileUtil</span><span class="token punctuation">.</span><span class="token function">getLastPathEle</span><span class="token punctuation">(</span><span class="token class-name">Paths</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>originProjectPath<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 注意 win 系统需要对路径进行转义</span>
    	sourceRootPath <span class="token operator">=</span> sourceRootPath<span class="token punctuation">.</span><span class="token function">replaceAll</span><span class="token punctuation">(</span><span class="token string">&quot;\\\\&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;/&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        
        <span class="token comment">// 二、生成文件模板</span>
        <span class="token comment">// 遍历输入文件</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Meta<span class="token punctuation">.</span>FileConfig<span class="token punctuation">.</span>FileInfo</span><span class="token punctuation">&gt;</span></span> newFileInfoList <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">String</span> inputFilePath <span class="token operator">:</span> inputFilePathList<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">String</span> inputFileAbsolutePath <span class="token operator">=</span> sourceRootPath <span class="token operator">+</span> <span class="token class-name">File</span><span class="token punctuation">.</span>separator <span class="token operator">+</span> inputFilePath<span class="token punctuation">;</span>
            <span class="token comment">// 输入的是目录</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">FileUtil</span><span class="token punctuation">.</span><span class="token function">isDirectory</span><span class="token punctuation">(</span>inputFileAbsolutePath<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">File</span><span class="token punctuation">&gt;</span></span> fileList <span class="token operator">=</span> <span class="token class-name">FileUtil</span><span class="token punctuation">.</span><span class="token function">loopFiles</span><span class="token punctuation">(</span>inputFileAbsolutePath<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">File</span> file <span class="token operator">:</span> fileList<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token class-name">Meta<span class="token punctuation">.</span>FileConfig<span class="token punctuation">.</span>FileInfo</span> fileInfo <span class="token operator">=</span> <span class="token function">makeFileTemplate</span><span class="token punctuation">(</span>modelInfo<span class="token punctuation">,</span> searchStr<span class="token punctuation">,</span> sourceRootPath<span class="token punctuation">,</span> file<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    newFileInfoList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>fileInfo<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                <span class="token comment">// 输入的是文件</span>
                <span class="token class-name">Meta<span class="token punctuation">.</span>FileConfig<span class="token punctuation">.</span>FileInfo</span> fileInfo <span class="token operator">=</span> <span class="token function">makeFileTemplate</span><span class="token punctuation">(</span>modelInfo<span class="token punctuation">,</span> searchStr<span class="token punctuation">,</span> sourceRootPath<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span>inputFileAbsolutePath<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                newFileInfoList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>fileInfo<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>

        <span class="token comment">// 三、生成配置文件</span>
        <span class="token class-name">String</span> metaOutputPath <span class="token operator">=</span> sourceRootPath <span class="token operator">+</span> <span class="token class-name">File</span><span class="token punctuation">.</span>separator <span class="token operator">+</span> <span class="token string">&quot;meta.json&quot;</span><span class="token punctuation">;</span>

        <span class="token comment">// 如果已有 meta 文件，说明不是第一次制作，则在 meta 基础上进行修改</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">FileUtil</span><span class="token punctuation">.</span><span class="token function">exist</span><span class="token punctuation">(</span>metaOutputPath<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">Meta</span> oldMeta <span class="token operator">=</span> <span class="token class-name">JSONUtil</span><span class="token punctuation">.</span><span class="token function">toBean</span><span class="token punctuation">(</span><span class="token class-name">FileUtil</span><span class="token punctuation">.</span><span class="token function">readUtf8String</span><span class="token punctuation">(</span>metaOutputPath<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">Meta</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">BeanUtil</span><span class="token punctuation">.</span><span class="token function">copyProperties</span><span class="token punctuation">(</span>newMeta<span class="token punctuation">,</span> oldMeta<span class="token punctuation">,</span> <span class="token class-name">CopyOptions</span><span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ignoreNullValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            newMeta <span class="token operator">=</span> oldMeta<span class="token punctuation">;</span>

            <span class="token comment">// 1. 追加配置参数</span>
            <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Meta<span class="token punctuation">.</span>FileConfig<span class="token punctuation">.</span>FileInfo</span><span class="token punctuation">&gt;</span></span> fileInfoList <span class="token operator">=</span> newMeta<span class="token punctuation">.</span><span class="token function">getFileConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getFiles</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            fileInfoList<span class="token punctuation">.</span><span class="token function">addAll</span><span class="token punctuation">(</span>newFileInfoList<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Meta<span class="token punctuation">.</span>ModelConfig<span class="token punctuation">.</span>ModelInfo</span><span class="token punctuation">&gt;</span></span> modelInfoList <span class="token operator">=</span> newMeta<span class="token punctuation">.</span><span class="token function">getModelConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getModels</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            modelInfoList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>modelInfo<span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment">// 配置去重</span>
            newMeta<span class="token punctuation">.</span><span class="token function">getFileConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setFiles</span><span class="token punctuation">(</span><span class="token function">distinctFiles</span><span class="token punctuation">(</span>fileInfoList<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            newMeta<span class="token punctuation">.</span><span class="token function">getModelConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setModels</span><span class="token punctuation">(</span><span class="token function">distinctModels</span><span class="token punctuation">(</span>modelInfoList<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token comment">// 1. 构造配置参数</span>
            <span class="token class-name">Meta<span class="token punctuation">.</span>FileConfig</span> fileConfig <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Meta<span class="token punctuation">.</span>FileConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            newMeta<span class="token punctuation">.</span><span class="token function">setFileConfig</span><span class="token punctuation">(</span>fileConfig<span class="token punctuation">)</span><span class="token punctuation">;</span>
            fileConfig<span class="token punctuation">.</span><span class="token function">setSourceRootPath</span><span class="token punctuation">(</span>sourceRootPath<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Meta<span class="token punctuation">.</span>FileConfig<span class="token punctuation">.</span>FileInfo</span><span class="token punctuation">&gt;</span></span> fileInfoList <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            fileConfig<span class="token punctuation">.</span><span class="token function">setFiles</span><span class="token punctuation">(</span>fileInfoList<span class="token punctuation">)</span><span class="token punctuation">;</span>
            fileInfoList<span class="token punctuation">.</span><span class="token function">addAll</span><span class="token punctuation">(</span>newFileInfoList<span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token class-name">Meta<span class="token punctuation">.</span>ModelConfig</span> modelConfig <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Meta<span class="token punctuation">.</span>ModelConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            newMeta<span class="token punctuation">.</span><span class="token function">setModelConfig</span><span class="token punctuation">(</span>modelConfig<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Meta<span class="token punctuation">.</span>ModelConfig<span class="token punctuation">.</span>ModelInfo</span><span class="token punctuation">&gt;</span></span> modelInfoList <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            modelConfig<span class="token punctuation">.</span><span class="token function">setModels</span><span class="token punctuation">(</span>modelInfoList<span class="token punctuation">)</span><span class="token punctuation">;</span>
            modelInfoList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>modelInfo<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token comment">// 2. 输出元信息文件</span>
        <span class="token class-name">FileUtil</span><span class="token punctuation">.</span><span class="token function">writeUtf8String</span><span class="token punctuation">(</span><span class="token class-name">JSONUtil</span><span class="token punctuation">.</span><span class="token function">toJsonPrettyStr</span><span class="token punctuation">(</span>newMeta<span class="token punctuation">)</span><span class="token punctuation">,</span> metaOutputPath<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> id<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * 制作文件模板
     *
     * @param modelInfo
     * @param searchStr
     * @param sourceRootPath
     * @param inputFile
     * @return
     */</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">Meta<span class="token punctuation">.</span>FileConfig<span class="token punctuation">.</span>FileInfo</span> <span class="token function">makeFileTemplate</span><span class="token punctuation">(</span><span class="token class-name">Meta<span class="token punctuation">.</span>ModelConfig<span class="token punctuation">.</span>ModelInfo</span> modelInfo<span class="token punctuation">,</span> <span class="token class-name">String</span> searchStr<span class="token punctuation">,</span> <span class="token class-name">String</span> sourceRootPath<span class="token punctuation">,</span> <span class="token class-name">File</span> inputFile<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 要挖坑的文件绝对路径（用于制作模板）</span>
        <span class="token comment">// 注意 win 系统需要对路径进行转义</span>
        <span class="token class-name">String</span> fileInputAbsolutePath <span class="token operator">=</span> inputFile<span class="token punctuation">.</span><span class="token function">getAbsolutePath</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">replaceAll</span><span class="token punctuation">(</span><span class="token string">&quot;\\\\&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;/&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> fileOutputAbsolutePath <span class="token operator">=</span> fileInputAbsolutePath <span class="token operator">+</span> <span class="token string">&quot;.ftl&quot;</span><span class="token punctuation">;</span>
    
        <span class="token comment">// 文件输入输出相对路径（用于生成配置）</span>
        <span class="token class-name">String</span> fileInputPath <span class="token operator">=</span> fileInputAbsolutePath<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span>sourceRootPath <span class="token operator">+</span> <span class="token string">&quot;/&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> fileOutputPath <span class="token operator">=</span> fileInputPath <span class="token operator">+</span> <span class="token string">&quot;.ftl&quot;</span><span class="token punctuation">;</span>
        
        <span class="token comment">// 使用字符串替换，生成模板文件</span>
        <span class="token class-name">String</span> fileContent<span class="token punctuation">;</span>
        <span class="token comment">// 如果已有模板文件，说明不是第一次制作，则在模板基础上再次挖坑</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">FileUtil</span><span class="token punctuation">.</span><span class="token function">exist</span><span class="token punctuation">(</span>fileOutputAbsolutePath<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            fileContent <span class="token operator">=</span> <span class="token class-name">FileUtil</span><span class="token punctuation">.</span><span class="token function">readUtf8String</span><span class="token punctuation">(</span>fileOutputAbsolutePath<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            fileContent <span class="token operator">=</span> <span class="token class-name">FileUtil</span><span class="token punctuation">.</span><span class="token function">readUtf8String</span><span class="token punctuation">(</span>fileInputAbsolutePath<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token class-name">String</span> replacement <span class="token operator">=</span> <span class="token class-name">String</span><span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token string">&quot;${%s}&quot;</span><span class="token punctuation">,</span> modelInfo<span class="token punctuation">.</span><span class="token function">getFieldName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> newFileContent <span class="token operator">=</span> <span class="token class-name">StrUtil</span><span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span>fileContent<span class="token punctuation">,</span> searchStr<span class="token punctuation">,</span> replacement<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 文件配置信息</span>
        <span class="token class-name">Meta<span class="token punctuation">.</span>FileConfig<span class="token punctuation">.</span>FileInfo</span> fileInfo <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Meta<span class="token punctuation">.</span>FileConfig<span class="token punctuation">.</span>FileInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        fileInfo<span class="token punctuation">.</span><span class="token function">setInputPath</span><span class="token punctuation">(</span>fileInputPath<span class="token punctuation">)</span><span class="token punctuation">;</span>
        fileInfo<span class="token punctuation">.</span><span class="token function">setOutputPath</span><span class="token punctuation">(</span>fileOutputPath<span class="token punctuation">)</span><span class="token punctuation">;</span>
        fileInfo<span class="token punctuation">.</span><span class="token function">setType</span><span class="token punctuation">(</span><span class="token class-name">FileTypeEnum</span><span class="token punctuation">.</span><span class="token constant">FILE</span><span class="token punctuation">.</span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 和原文件一致，没有挖坑，则为静态生成</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>newFileContent<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>fileContent<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// 输出路径 = 输入路径</span>
            fileInfo<span class="token punctuation">.</span><span class="token function">setOutputPath</span><span class="token punctuation">(</span>fileInputPath<span class="token punctuation">)</span><span class="token punctuation">;</span>
            fileInfo<span class="token punctuation">.</span><span class="token function">setGenerateType</span><span class="token punctuation">(</span><span class="token class-name">FileGenerateTypeEnum</span><span class="token punctuation">.</span><span class="token constant">STATIC</span><span class="token punctuation">.</span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token comment">// 生成模板文件</span>
            fileInfo<span class="token punctuation">.</span><span class="token function">setGenerateType</span><span class="token punctuation">(</span><span class="token class-name">FileGenerateTypeEnum</span><span class="token punctuation">.</span><span class="token constant">DYNAMIC</span><span class="token punctuation">.</span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">FileUtil</span><span class="token punctuation">.</span><span class="token function">writeUtf8String</span><span class="token punctuation">(</span>newFileContent<span class="token punctuation">,</span> fileOutputAbsolutePath<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> fileInfo<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Meta</span> meta <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Meta</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        meta<span class="token punctuation">.</span><span class="token function">setName</span><span class="token punctuation">(</span><span class="token string">&quot;acm-template-generator&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        meta<span class="token punctuation">.</span><span class="token function">setDescription</span><span class="token punctuation">(</span><span class="token string">&quot;ACM 示例模板生成器&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">String</span> projectPath <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">getProperty</span><span class="token punctuation">(</span><span class="token string">&quot;user.dir&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> originProjectPath <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span>projectPath<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getParent</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token class-name">File</span><span class="token punctuation">.</span>separator <span class="token operator">+</span> <span class="token string">&quot;yuzi-generator-demo-projects/springboot-init&quot;</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> inputFilePath1 <span class="token operator">=</span> <span class="token string">&quot;src/main/java/com/yupi/springbootinit/common&quot;</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> inputFilePath2 <span class="token operator">=</span> <span class="token string">&quot;src/main/java/com/yupi/springbootinit/controller&quot;</span><span class="token punctuation">;</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> inputFilePathList <span class="token operator">=</span> <span class="token class-name">Arrays</span><span class="token punctuation">.</span><span class="token function">asList</span><span class="token punctuation">(</span>inputFilePath1<span class="token punctuation">,</span> inputFilePath2<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 模型参数信息（首次）</span>
<span class="token comment">//        Meta.ModelConfig.ModelInfo modelInfo = new Meta.ModelConfig.ModelInfo();</span>
<span class="token comment">//        modelInfo.setFieldName(&quot;outputText&quot;);</span>
<span class="token comment">//        modelInfo.setType(&quot;String&quot;);</span>
<span class="token comment">//        modelInfo.setDefaultValue(&quot;sum = &quot;);</span>

        <span class="token comment">// 模型参数信息（第二次）</span>
        <span class="token class-name">Meta<span class="token punctuation">.</span>ModelConfig<span class="token punctuation">.</span>ModelInfo</span> modelInfo <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Meta<span class="token punctuation">.</span>ModelConfig<span class="token punctuation">.</span>ModelInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        modelInfo<span class="token punctuation">.</span><span class="token function">setFieldName</span><span class="token punctuation">(</span><span class="token string">&quot;className&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        modelInfo<span class="token punctuation">.</span><span class="token function">setType</span><span class="token punctuation">(</span><span class="token string">&quot;String&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 替换变量（首次）</span>
<span class="token comment">//        String searchStr = &quot;Sum: &quot;;</span>
        <span class="token comment">// 替换变量（第二次）</span>
        <span class="token class-name">String</span> searchStr <span class="token operator">=</span> <span class="token string">&quot;BaseResponse&quot;</span><span class="token punctuation">;</span>

        <span class="token keyword">long</span> id <span class="token operator">=</span> <span class="token function">makeTemplate</span><span class="token punctuation">(</span>meta<span class="token punctuation">,</span> originProjectPath<span class="token punctuation">,</span> inputFilePathList<span class="token punctuation">,</span> modelInfo<span class="token punctuation">,</span> searchStr<span class="token punctuation">,</span> <span class="token number">1735281524670181376L</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * 模型去重
     *
     * @param modelInfoList
     * @return
     */</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Meta<span class="token punctuation">.</span>ModelConfig<span class="token punctuation">.</span>ModelInfo</span><span class="token punctuation">&gt;</span></span> <span class="token function">distinctModels</span><span class="token punctuation">(</span><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Meta<span class="token punctuation">.</span>ModelConfig<span class="token punctuation">.</span>ModelInfo</span><span class="token punctuation">&gt;</span></span> modelInfoList<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Meta<span class="token punctuation">.</span>ModelConfig<span class="token punctuation">.</span>ModelInfo</span><span class="token punctuation">&gt;</span></span> newModelInfoList <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>modelInfoList<span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span><span class="token class-name">Collectors</span><span class="token punctuation">.</span><span class="token function">toMap</span><span class="token punctuation">(</span><span class="token class-name">Meta<span class="token punctuation">.</span>ModelConfig<span class="token punctuation">.</span>ModelInfo</span><span class="token operator">::</span><span class="token function">getFieldName</span><span class="token punctuation">,</span> o <span class="token operator">-&gt;</span> o<span class="token punctuation">,</span> <span class="token punctuation">(</span>e<span class="token punctuation">,</span> r<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> r<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">values</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> newModelInfoList<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * 文件去重
     *
     * @param fileInfoList
     * @return
     */</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Meta<span class="token punctuation">.</span>FileConfig<span class="token punctuation">.</span>FileInfo</span><span class="token punctuation">&gt;</span></span> <span class="token function">distinctFiles</span><span class="token punctuation">(</span><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Meta<span class="token punctuation">.</span>FileConfig<span class="token punctuation">.</span>FileInfo</span><span class="token punctuation">&gt;</span></span> fileInfoList<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Meta<span class="token punctuation">.</span>FileConfig<span class="token punctuation">.</span>FileInfo</span><span class="token punctuation">&gt;</span></span> newFileInfoList <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>fileInfoList<span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span><span class="token class-name">Collectors</span><span class="token punctuation">.</span><span class="token function">toMap</span><span class="token punctuation">(</span><span class="token class-name">Meta<span class="token punctuation">.</span>FileConfig<span class="token punctuation">.</span>FileInfo</span><span class="token operator">::</span><span class="token function">getInputPath</span><span class="token punctuation">,</span> o <span class="token operator">-&gt;</span> o<span class="token punctuation">,</span> <span class="token punctuation">(</span>e<span class="token punctuation">,</span> r<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> r<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">values</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> newFileInfoList<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br><span class="line-number">103</span><br><span class="line-number">104</span><br><span class="line-number">105</span><br><span class="line-number">106</span><br><span class="line-number">107</span><br><span class="line-number">108</span><br><span class="line-number">109</span><br><span class="line-number">110</span><br><span class="line-number">111</span><br><span class="line-number">112</span><br><span class="line-number">113</span><br><span class="line-number">114</span><br><span class="line-number">115</span><br><span class="line-number">116</span><br><span class="line-number">117</span><br><span class="line-number">118</span><br><span class="line-number">119</span><br><span class="line-number">120</span><br><span class="line-number">121</span><br><span class="line-number">122</span><br><span class="line-number">123</span><br><span class="line-number">124</span><br><span class="line-number">125</span><br><span class="line-number">126</span><br><span class="line-number">127</span><br><span class="line-number">128</span><br><span class="line-number">129</span><br><span class="line-number">130</span><br><span class="line-number">131</span><br><span class="line-number">132</span><br><span class="line-number">133</span><br><span class="line-number">134</span><br><span class="line-number">135</span><br><span class="line-number">136</span><br><span class="line-number">137</span><br><span class="line-number">138</span><br><span class="line-number">139</span><br><span class="line-number">140</span><br><span class="line-number">141</span><br><span class="line-number">142</span><br><span class="line-number">143</span><br><span class="line-number">144</span><br><span class="line-number">145</span><br><span class="line-number">146</span><br><span class="line-number">147</span><br><span class="line-number">148</span><br><span class="line-number">149</span><br><span class="line-number">150</span><br><span class="line-number">151</span><br><span class="line-number">152</span><br><span class="line-number">153</span><br><span class="line-number">154</span><br><span class="line-number">155</span><br><span class="line-number">156</span><br><span class="line-number">157</span><br><span class="line-number">158</span><br><span class="line-number">159</span><br><span class="line-number">160</span><br><span class="line-number">161</span><br><span class="line-number">162</span><br><span class="line-number">163</span><br><span class="line-number">164</span><br><span class="line-number">165</span><br><span class="line-number">166</span><br><span class="line-number">167</span><br><span class="line-number">168</span><br><span class="line-number">169</span><br><span class="line-number">170</span><br><span class="line-number">171</span><br><span class="line-number">172</span><br><span class="line-number">173</span><br><span class="line-number">174</span><br><span class="line-number">175</span><br><span class="line-number">176</span><br><span class="line-number">177</span><br><span class="line-number">178</span><br><span class="line-number">179</span><br><span class="line-number">180</span><br><span class="line-number">181</span><br><span class="line-number">182</span><br><span class="line-number">183</span><br><span class="line-number">184</span><br><span class="line-number">185</span><br><span class="line-number">186</span><br><span class="line-number">187</span><br><span class="line-number">188</span><br><span class="line-number">189</span><br><span class="line-number">190</span><br><span class="line-number">191</span><br><span class="line-number">192</span><br><span class="line-number">193</span><br><span class="line-number">194</span><br><span class="line-number">195</span><br><span class="line-number">196</span><br><span class="line-number">197</span><br><span class="line-number">198</span><br><span class="line-number">199</span><br><span class="line-number">200</span><br><span class="line-number">201</span><br><span class="line-number">202</span><br><span class="line-number">203</span><br><span class="line-number">204</span><br><span class="line-number">205</span><br><span class="line-number">206</span><br><span class="line-number">207</span><br><span class="line-number">208</span><br><span class="line-number">209</span><br><span class="line-number">210</span><br><span class="line-number">211</span><br><span class="line-number">212</span><br><span class="line-number">213</span><br><span class="line-number">214</span><br><span class="line-number">215</span><br><span class="line-number">216</span><br></div></div><h3 id="_2、文件过滤"><a href="#_2、文件过滤" class="header-anchor">#</a> 2、文件过滤</h3> <p>回忆下我们之前梳理的 Spring Boot 模板生成器需要的一个功能：</p> <blockquote><p>需求：控制是否生成帖子相关功能 实现思路：允许用户输入一个开关参数来控制帖子功能相关的文件是否生成，比如 PostController、PostService、PostMapper、PostMapper.xml、Post 实体类等。 通用能力：某个范围下的多个指定文件挖坑 =&gt; 绑定同个参数</p></blockquote> <p>为了实现这个需求，我们要同时对多个名称包含 <code>Post</code> 的文件进行处理。由于这些文件分散在不同的目录中，我们没有办法通过直接指定一个目录完成制作。单次制作时输入多个文件是可行的提效方式，但如果文件数量再多一些，依次去写文件的路径也会成为一种麻烦。</p> <p>有没有更优雅的方式呢？</p> <p>答案是肯定的，想想我们平时查找文件时会怎么办？肯定是输入一些关键词来过滤文件对吧。</p> <p>没错，我们可以给模板制作工具增加 <strong>文件过滤</strong> 功能，通过多种不同的过滤方式帮助用户选择文件，更灵活地完成批量模板制作。</p> <h4 id="文件过滤机制设计"><a href="#文件过滤机制设计" class="header-anchor">#</a> 文件过滤机制设计</h4> <p>文件过滤可以有很多种不同的配置方式，梳理归纳了 2 类配置：</p> <ul><li>过滤范围：根据文件名称、或者文件内容过滤。</li> <li>过滤规则：包含 contains、前缀匹配 startsWith、后缀匹配 endsWith、正则 regex、相等 equals。</li></ul> <p>由于制作工具已经支持输入多个文件 / 目录，所以其实每个文件 / 目录都可以指定自己的过滤规则，而且能同时指定多条过滤规则（必须同时满足才保留），进一步提高灵活性。</p> <p>参考文件过滤机制的 JSON 结构如下：</p> <div class="language-json line-numbers-mode"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;files&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
      <span class="token property">&quot;path&quot;</span><span class="token operator">:</span> <span class="token string">&quot;文件（目录）路径&quot;</span><span class="token punctuation">,</span>
      <span class="token property">&quot;filters&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">{</span>
          <span class="token property">&quot;range&quot;</span><span class="token operator">:</span> <span class="token string">&quot;fileName&quot;</span><span class="token punctuation">,</span>
          <span class="token property">&quot;rule&quot;</span><span class="token operator">:</span> <span class="token string">&quot;regex&quot;</span><span class="token punctuation">,</span>
          <span class="token property">&quot;value&quot;</span><span class="token operator">:</span> <span class="token string">&quot;.*lala.*&quot;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span>
          <span class="token property">&quot;range&quot;</span><span class="token operator">:</span> <span class="token string">&quot;fileContent&quot;</span><span class="token punctuation">,</span>
          <span class="token property">&quot;rule&quot;</span><span class="token operator">:</span> <span class="token string">&quot;contains&quot;</span><span class="token punctuation">,</span>
          <span class="token property">&quot;value&quot;</span><span class="token operator">:</span> <span class="token string">&quot;haha&quot;</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">]</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><p>上面的 JSON 表示：该文件的名称必须符合正则并且内容必须包含 <code>haha</code>。</p> <p>通过这种设计，可以非常灵活地筛选文件。如果想使用 or 逻辑（有一个过滤条件符合要求就保留），可以定义多个重复的 file，并且每个 file 指定一个过滤条件来实现。哪怕同时满足了多个过滤器，我们的去重逻辑也能搞定。</p> <h4 id="开发实现"><a href="#开发实现" class="header-anchor">#</a> 开发实现</h4> <p>1）设计好了机制后，我们可以编写对应的配置类。</p> <p>在 <code>template.model</code> 包下新建 <code>FileFilterConfig</code> 类，对应上面设计好的 JSON 结构。</p> <p>代码如下：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>yupi<span class="token punctuation">.</span>maker<span class="token punctuation">.</span>template<span class="token punctuation">.</span>model</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">lombok<span class="token punctuation">.</span></span><span class="token class-name">Builder</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">lombok<span class="token punctuation">.</span></span><span class="token class-name">Data</span></span><span class="token punctuation">;</span>

<span class="token comment">/**
 * 文件过滤配置
 */</span>
<span class="token annotation punctuation">@Data</span>
<span class="token annotation punctuation">@Builder</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">FileFilterConfig</span> <span class="token punctuation">{</span>

    <span class="token comment">/**
     * 过滤范围
     */</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> range<span class="token punctuation">;</span>

    <span class="token comment">/**
     * 过滤规则
     */</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> rule<span class="token punctuation">;</span>

    <span class="token comment">/**
     * 过滤值
     */</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> value<span class="token punctuation">;</span>

<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br></div></div><p>在 <code>template.model</code> 包下新建 <code>TemplateMakerFileConfig</code> 类，用来封装所有和文件相关的配置。</p> <p>代码如下：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>yupi<span class="token punctuation">.</span>maker<span class="token punctuation">.</span>template<span class="token punctuation">.</span>model</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">lombok<span class="token punctuation">.</span></span><span class="token class-name">Data</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">lombok<span class="token punctuation">.</span></span><span class="token class-name">NoArgsConstructor</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">List</span></span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@Data</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TemplateMakerFileConfig</span> <span class="token punctuation">{</span>

    <span class="token keyword">private</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">FileInfoConfig</span><span class="token punctuation">&gt;</span></span> files<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@NoArgsConstructor</span>
    <span class="token annotation punctuation">@Data</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">FileInfoConfig</span> <span class="token punctuation">{</span>

        <span class="token keyword">private</span> <span class="token class-name">String</span> path<span class="token punctuation">;</span>

        <span class="token keyword">private</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">FileFilterConfig</span><span class="token punctuation">&gt;</span></span> filterConfigList<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div><p>2）针对过滤配置中的枚举值，编写对应的枚举类</p> <p>在 <code>template.enums</code> 包下新建 <code>FileFilterRangeEnum</code> 枚举类，表示文件过滤范围枚举。需要提供根据 value 获取枚举的方法，便于根据字符串获取对应的枚举。</p> <p>代码如下：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>yupi<span class="token punctuation">.</span>maker<span class="token punctuation">.</span>template<span class="token punctuation">.</span>enums</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">cn<span class="token punctuation">.</span>hutool<span class="token punctuation">.</span>core<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">ObjectUtil</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">lombok<span class="token punctuation">.</span></span><span class="token class-name">Getter</span></span><span class="token punctuation">;</span>

<span class="token comment">/**
 * 文件过滤范围枚举
 */</span>
<span class="token annotation punctuation">@Getter</span>
<span class="token keyword">public</span> <span class="token keyword">enum</span> <span class="token class-name">FileFilterRangeEnum</span> <span class="token punctuation">{</span>

    <span class="token function">FILE_NAME</span><span class="token punctuation">(</span><span class="token string">&quot;文件名称&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;fileName&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function">FILE_CONTENT</span><span class="token punctuation">(</span><span class="token string">&quot;文件内容&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;fileContent&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">String</span> text<span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">String</span> value<span class="token punctuation">;</span>

    <span class="token class-name">FileFilterRangeEnum</span><span class="token punctuation">(</span><span class="token class-name">String</span> text<span class="token punctuation">,</span> <span class="token class-name">String</span> value<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>text <span class="token operator">=</span> text<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>value <span class="token operator">=</span> value<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * 根据 value 获取枚举
     *
     * @param value
     * @return
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">FileFilterRangeEnum</span> <span class="token function">getEnumByValue</span><span class="token punctuation">(</span><span class="token class-name">String</span> value<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">ObjectUtil</span><span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">FileFilterRangeEnum</span> anEnum <span class="token operator">:</span> <span class="token class-name">FileFilterRangeEnum</span><span class="token punctuation">.</span><span class="token function">values</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>anEnum<span class="token punctuation">.</span>value<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">return</span> anEnum<span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br></div></div><p>在 <code>template.enums</code> 包下再新建 <code>FileFilterRuleEnum</code> 枚举类，表示文件过滤规则枚举。</p> <p>代码如下：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>yupi<span class="token punctuation">.</span>maker<span class="token punctuation">.</span>template<span class="token punctuation">.</span>enums</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">cn<span class="token punctuation">.</span>hutool<span class="token punctuation">.</span>core<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">ObjectUtil</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">lombok<span class="token punctuation">.</span></span><span class="token class-name">Getter</span></span><span class="token punctuation">;</span>

<span class="token comment">/**
 * 文件过滤规则枚举
 */</span>
<span class="token annotation punctuation">@Getter</span>
<span class="token keyword">public</span> <span class="token keyword">enum</span> <span class="token class-name">FileFilterRuleEnum</span> <span class="token punctuation">{</span>

    <span class="token function">CONTAINS</span><span class="token punctuation">(</span><span class="token string">&quot;包含&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;contains&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function">STARTS_WITH</span><span class="token punctuation">(</span><span class="token string">&quot;前缀匹配&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;startsWith&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function">ENDS_WITH</span><span class="token punctuation">(</span><span class="token string">&quot;后缀匹配&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;endsWith&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function">REGEX</span><span class="token punctuation">(</span><span class="token string">&quot;正则&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;regex&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function">EQUALS</span><span class="token punctuation">(</span><span class="token string">&quot;相等&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;equals&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">String</span> text<span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">String</span> value<span class="token punctuation">;</span>

    <span class="token class-name">FileFilterRuleEnum</span><span class="token punctuation">(</span><span class="token class-name">String</span> text<span class="token punctuation">,</span> <span class="token class-name">String</span> value<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>text <span class="token operator">=</span> text<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>value <span class="token operator">=</span> value<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * 根据 value 获取枚举
     *
     * @param value
     * @return
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">FileFilterRuleEnum</span> <span class="token function">getEnumByValue</span><span class="token punctuation">(</span><span class="token class-name">String</span> value<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">ObjectUtil</span><span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">FileFilterRuleEnum</span> anEnum <span class="token operator">:</span> <span class="token class-name">FileFilterRuleEnum</span><span class="token punctuation">.</span><span class="token function">values</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>anEnum<span class="token punctuation">.</span>value<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">return</span> anEnum<span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br></div></div><p>3）有了配置类后，我们来开发文件过滤功能</p> <p>在 <code>template</code> 包下新建 <code>FileFilter</code> 类，首先开发针对单个文件过滤的方法 <code>doSingleFileFilter</code>。实现思路是遍历传入的文件过滤配置列表，并按照规则进行校验，如果有一个过滤配置不满足，就返回 false 表示不保留该文件，反之为 true 表示通过所有校验。</p> <p>代码如下：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">/**
 * 单个文件过滤
 *
 * @param fileFilterConfigList 过滤规则
 * @param file 单个文件
 * @return 是否保留
 */</span>
<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">boolean</span> <span class="token function">doSingleFileFilter</span><span class="token punctuation">(</span><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">FileFilterConfig</span><span class="token punctuation">&gt;</span></span> fileFilterConfigList<span class="token punctuation">,</span> <span class="token class-name">File</span> file<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">String</span> fileName <span class="token operator">=</span> file<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">String</span> fileContent <span class="token operator">=</span> <span class="token class-name">FileUtil</span><span class="token punctuation">.</span><span class="token function">readUtf8String</span><span class="token punctuation">(</span>file<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 所有过滤器校验结束的结果</span>
    <span class="token keyword">boolean</span> result <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">CollUtil</span><span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span>fileFilterConfigList<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">FileFilterConfig</span> fileFilterConfig <span class="token operator">:</span> fileFilterConfigList<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">String</span> range <span class="token operator">=</span> fileFilterConfig<span class="token punctuation">.</span><span class="token function">getRange</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> rule <span class="token operator">=</span> fileFilterConfig<span class="token punctuation">.</span><span class="token function">getRule</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> value <span class="token operator">=</span> fileFilterConfig<span class="token punctuation">.</span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">FileFilterRangeEnum</span> fileFilterRangeEnum <span class="token operator">=</span> <span class="token class-name">FileFilterRangeEnum</span><span class="token punctuation">.</span><span class="token function">getEnumByValue</span><span class="token punctuation">(</span>range<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>fileFilterRangeEnum <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">continue</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token comment">// 要过滤的原内容</span>
        <span class="token class-name">String</span> content <span class="token operator">=</span> fileName<span class="token punctuation">;</span>
        <span class="token keyword">switch</span> <span class="token punctuation">(</span>fileFilterRangeEnum<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">case</span> <span class="token constant">FILE_NAME</span><span class="token operator">:</span>
                content <span class="token operator">=</span> fileName<span class="token punctuation">;</span>
                <span class="token keyword">break</span><span class="token punctuation">;</span>
            <span class="token keyword">case</span> <span class="token constant">FILE_CONTENT</span><span class="token operator">:</span>
                content <span class="token operator">=</span> fileContent<span class="token punctuation">;</span>
                <span class="token keyword">break</span><span class="token punctuation">;</span>
            <span class="token keyword">default</span><span class="token operator">:</span>
        <span class="token punctuation">}</span>

        <span class="token class-name">FileFilterRuleEnum</span> filterRuleEnum <span class="token operator">=</span> <span class="token class-name">FileFilterRuleEnum</span><span class="token punctuation">.</span><span class="token function">getEnumByValue</span><span class="token punctuation">(</span>rule<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>filterRuleEnum <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">continue</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">switch</span> <span class="token punctuation">(</span>filterRuleEnum<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">case</span> <span class="token constant">CONTAINS</span><span class="token operator">:</span>
                result <span class="token operator">=</span> content<span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">break</span><span class="token punctuation">;</span>
            <span class="token keyword">case</span> <span class="token constant">STARTS_WITH</span><span class="token operator">:</span>
                result <span class="token operator">=</span> content<span class="token punctuation">.</span><span class="token function">startsWith</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">break</span><span class="token punctuation">;</span>
            <span class="token keyword">case</span> <span class="token constant">ENDS_WITH</span><span class="token operator">:</span>
                result <span class="token operator">=</span> content<span class="token punctuation">.</span><span class="token function">endsWith</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">break</span><span class="token punctuation">;</span>
            <span class="token keyword">case</span> <span class="token constant">REGEX</span><span class="token operator">:</span>
                result <span class="token operator">=</span> content<span class="token punctuation">.</span><span class="token function">matches</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">break</span><span class="token punctuation">;</span>
            <span class="token keyword">case</span> <span class="token constant">EQUALS</span><span class="token operator">:</span>
                result <span class="token operator">=</span> content<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">break</span><span class="token punctuation">;</span>
            <span class="token keyword">default</span><span class="token operator">:</span>
        <span class="token punctuation">}</span>

        <span class="token comment">// 有一个不满足，就直接返回</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>result<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 都满足</span>
    <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br></div></div><p>然后编写过滤器的主方法 <code>doFilter</code>，方法接受 <code>filePath</code> 文件路径参数，支持传入文件或目录，能够同时对多个文件进行过滤。</p> <p>实现思路很简单，通过 Hutool 的 <code>FileUtil.loopFiles</code> 获取到所有文件列表，再依次调用过滤单个文件的方法即可。</p> <blockquote><p>即使传入的是单个文件，也能通过该方法获取到列表，保持一致</p></blockquote> <p>代码如下：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">/**
 * 对某个文件或目录进行过滤，返回文件列表
 *
 * @param filePath
 * @param fileFilterConfigList
 * @return
 */</span>
<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">File</span><span class="token punctuation">&gt;</span></span> <span class="token function">doFilter</span><span class="token punctuation">(</span><span class="token class-name">String</span> filePath<span class="token punctuation">,</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">FileFilterConfig</span><span class="token punctuation">&gt;</span></span> fileFilterConfigList<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 根据路径获取所有文件</span>
    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">File</span><span class="token punctuation">&gt;</span></span> fileList <span class="token operator">=</span> <span class="token class-name">FileUtil</span><span class="token punctuation">.</span><span class="token function">loopFiles</span><span class="token punctuation">(</span>filePath<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> fileList<span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>file <span class="token operator">-&gt;</span> <span class="token function">doSingleFileFilter</span><span class="token punctuation">(</span>fileFilterConfigList<span class="token punctuation">,</span> file<span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span><span class="token class-name">Collectors</span><span class="token punctuation">.</span><span class="token function">toList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><p><code>FileFilter</code> 的完整代码如下：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>yupi<span class="token punctuation">.</span>maker<span class="token punctuation">.</span>template</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">cn<span class="token punctuation">.</span>hutool<span class="token punctuation">.</span>core<span class="token punctuation">.</span>collection<span class="token punctuation">.</span></span><span class="token class-name">CollUtil</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">cn<span class="token punctuation">.</span>hutool<span class="token punctuation">.</span>core<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">FileUtil</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>yupi<span class="token punctuation">.</span>maker<span class="token punctuation">.</span>template<span class="token punctuation">.</span>enums<span class="token punctuation">.</span></span><span class="token class-name">FileFilterRangeEnum</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>yupi<span class="token punctuation">.</span>maker<span class="token punctuation">.</span>template<span class="token punctuation">.</span>enums<span class="token punctuation">.</span></span><span class="token class-name">FileFilterRuleEnum</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>yupi<span class="token punctuation">.</span>maker<span class="token punctuation">.</span>template<span class="token punctuation">.</span>model<span class="token punctuation">.</span></span><span class="token class-name">FileFilterConfig</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">File</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">List</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>stream<span class="token punctuation">.</span></span><span class="token class-name">Collectors</span></span><span class="token punctuation">;</span>

<span class="token comment">/**
 * 文件过滤器
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">FileFilter</span> <span class="token punctuation">{</span>

    <span class="token comment">/**
     * 对某个文件或目录进行过滤，返回文件列表
     *
     * @param filePath
     * @param fileFilterConfigList
     * @return
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">File</span><span class="token punctuation">&gt;</span></span> <span class="token function">doFilter</span><span class="token punctuation">(</span><span class="token class-name">String</span> filePath<span class="token punctuation">,</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">FileFilterConfig</span><span class="token punctuation">&gt;</span></span> fileFilterConfigList<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 根据路径获取所有文件</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">File</span><span class="token punctuation">&gt;</span></span> fileList <span class="token operator">=</span> <span class="token class-name">FileUtil</span><span class="token punctuation">.</span><span class="token function">loopFiles</span><span class="token punctuation">(</span>filePath<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> fileList<span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>file <span class="token operator">-&gt;</span> <span class="token function">doSingleFileFilter</span><span class="token punctuation">(</span>fileFilterConfigList<span class="token punctuation">,</span> file<span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span><span class="token class-name">Collectors</span><span class="token punctuation">.</span><span class="token function">toList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * 单个文件过滤
     *
     * @param fileFilterConfigList 过滤规则
     * @param file 单个文件
     * @return 是否保留
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">boolean</span> <span class="token function">doSingleFileFilter</span><span class="token punctuation">(</span><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">FileFilterConfig</span><span class="token punctuation">&gt;</span></span> fileFilterConfigList<span class="token punctuation">,</span> <span class="token class-name">File</span> file<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">String</span> fileName <span class="token operator">=</span> file<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> fileContent <span class="token operator">=</span> <span class="token class-name">FileUtil</span><span class="token punctuation">.</span><span class="token function">readUtf8String</span><span class="token punctuation">(</span>file<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 所有过滤器校验结束的结果</span>
        <span class="token keyword">boolean</span> result <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">CollUtil</span><span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span>fileFilterConfigList<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">FileFilterConfig</span> fileFilterConfig <span class="token operator">:</span> fileFilterConfigList<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">String</span> range <span class="token operator">=</span> fileFilterConfig<span class="token punctuation">.</span><span class="token function">getRange</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">String</span> rule <span class="token operator">=</span> fileFilterConfig<span class="token punctuation">.</span><span class="token function">getRule</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">String</span> value <span class="token operator">=</span> fileFilterConfig<span class="token punctuation">.</span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token class-name">FileFilterRangeEnum</span> fileFilterRangeEnum <span class="token operator">=</span> <span class="token class-name">FileFilterRangeEnum</span><span class="token punctuation">.</span><span class="token function">getEnumByValue</span><span class="token punctuation">(</span>range<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>fileFilterRangeEnum <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">continue</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            <span class="token comment">// 要过滤的原内容</span>
            <span class="token class-name">String</span> content <span class="token operator">=</span> fileName<span class="token punctuation">;</span>
            <span class="token keyword">switch</span> <span class="token punctuation">(</span>fileFilterRangeEnum<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">case</span> <span class="token constant">FILE_NAME</span><span class="token operator">:</span>
                    content <span class="token operator">=</span> fileName<span class="token punctuation">;</span>
                    <span class="token keyword">break</span><span class="token punctuation">;</span>
                <span class="token keyword">case</span> <span class="token constant">FILE_CONTENT</span><span class="token operator">:</span>
                    content <span class="token operator">=</span> fileContent<span class="token punctuation">;</span>
                    <span class="token keyword">break</span><span class="token punctuation">;</span>
                <span class="token keyword">default</span><span class="token operator">:</span>
            <span class="token punctuation">}</span>

            <span class="token class-name">FileFilterRuleEnum</span> filterRuleEnum <span class="token operator">=</span> <span class="token class-name">FileFilterRuleEnum</span><span class="token punctuation">.</span><span class="token function">getEnumByValue</span><span class="token punctuation">(</span>rule<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>filterRuleEnum <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">continue</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">switch</span> <span class="token punctuation">(</span>filterRuleEnum<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">case</span> <span class="token constant">CONTAINS</span><span class="token operator">:</span>
                    result <span class="token operator">=</span> content<span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token keyword">break</span><span class="token punctuation">;</span>
                <span class="token keyword">case</span> <span class="token constant">STARTS_WITH</span><span class="token operator">:</span>
                    result <span class="token operator">=</span> content<span class="token punctuation">.</span><span class="token function">startsWith</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token keyword">break</span><span class="token punctuation">;</span>
                <span class="token keyword">case</span> <span class="token constant">ENDS_WITH</span><span class="token operator">:</span>
                    result <span class="token operator">=</span> content<span class="token punctuation">.</span><span class="token function">endsWith</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token keyword">break</span><span class="token punctuation">;</span>
                <span class="token keyword">case</span> <span class="token constant">REGEX</span><span class="token operator">:</span>
                    result <span class="token operator">=</span> content<span class="token punctuation">.</span><span class="token function">matches</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token keyword">break</span><span class="token punctuation">;</span>
                <span class="token keyword">case</span> <span class="token constant">EQUALS</span><span class="token operator">:</span>
                    result <span class="token operator">=</span> content<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token keyword">break</span><span class="token punctuation">;</span>
                <span class="token keyword">default</span><span class="token operator">:</span>
            <span class="token punctuation">}</span>

            <span class="token comment">// 有一个不满足，就直接返回</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>result<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>

        <span class="token comment">// 都满足</span>
        <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br><span class="line-number">103</span><br><span class="line-number">104</span><br><span class="line-number">105</span><br></div></div><p>4）模板制作工具类使用过滤器</p> <p>将 <code>makeTemplate</code> 方法接受的 <code>inputFilePathList</code> 参数改为我们新封装的 <code>TemplateMakerFileConfig</code> 类，相当于同时传入了文件列表和过滤规则。</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">long</span> <span class="token function">makeTemplate</span><span class="token punctuation">(</span><span class="token class-name">Meta</span> newMeta<span class="token punctuation">,</span> 
                                <span class="token class-name">String</span> originProjectPath<span class="token punctuation">,</span>
                                <span class="token class-name">TemplateMakerFileConfig</span> templateMakerFileConfig<span class="token punctuation">,</span>
                                <span class="token class-name">Meta<span class="token punctuation">.</span>ModelConfig<span class="token punctuation">.</span>ModelInfo</span> modelInfo<span class="token punctuation">,</span>
                                <span class="token class-name">String</span> searchStr<span class="token punctuation">,</span>
                                <span class="token class-name">Long</span> id<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>然后修改遍历输入文件的代码，改为遍历 <code>fileConfigInfoList</code> 获取文件信息：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// 输入文件信息</span>
<span class="token class-name">String</span> sourceRootPath <span class="token operator">=</span> templatePath <span class="token operator">+</span> <span class="token class-name">File</span><span class="token punctuation">.</span>separator <span class="token operator">+</span> <span class="token class-name">FileUtil</span><span class="token punctuation">.</span><span class="token function">getLastPathEle</span><span class="token punctuation">(</span><span class="token class-name">Paths</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>originProjectPath<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 注意 win 系统需要对路径进行转义</span>
sourceRootPath <span class="token operator">=</span> sourceRootPath<span class="token punctuation">.</span><span class="token function">replaceAll</span><span class="token punctuation">(</span><span class="token string">&quot;\\\\&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;/&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">TemplateMakerFileConfig<span class="token punctuation">.</span>FileInfoConfig</span><span class="token punctuation">&gt;</span></span> fileConfigInfoList <span class="token operator">=</span> templateMakerFileConfig<span class="token punctuation">.</span><span class="token function">getFiles</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 二、生成文件模板</span>
<span class="token comment">// 遍历输入文件</span>
<span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Meta<span class="token punctuation">.</span>FileConfig<span class="token punctuation">.</span>FileInfo</span><span class="token punctuation">&gt;</span></span> newFileInfoList <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">TemplateMakerFileConfig<span class="token punctuation">.</span>FileInfoConfig</span> fileInfoConfig <span class="token operator">:</span> fileConfigInfoList<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">String</span> inputFilePath <span class="token operator">=</span> fileInfoConfig<span class="token punctuation">.</span><span class="token function">getPath</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">String</span> inputFileAbsolutePath <span class="token operator">=</span> sourceRootPath <span class="token operator">+</span> <span class="token class-name">File</span><span class="token punctuation">.</span>separator <span class="token operator">+</span> inputFilePath<span class="token punctuation">;</span>
    <span class="token comment">// 输入的是目录</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">FileUtil</span><span class="token punctuation">.</span><span class="token function">isDirectory</span><span class="token punctuation">(</span>inputFileAbsolutePath<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">File</span><span class="token punctuation">&gt;</span></span> fileList <span class="token operator">=</span> <span class="token class-name">FileUtil</span><span class="token punctuation">.</span><span class="token function">loopFiles</span><span class="token punctuation">(</span>inputFileAbsolutePath<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">File</span> file <span class="token operator">:</span> fileList<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">Meta<span class="token punctuation">.</span>FileConfig<span class="token punctuation">.</span>FileInfo</span> fileInfo <span class="token operator">=</span> <span class="token function">makeFileTemplate</span><span class="token punctuation">(</span>modelInfo<span class="token punctuation">,</span> searchStr<span class="token punctuation">,</span> sourceRootPath<span class="token punctuation">,</span> file<span class="token punctuation">)</span><span class="token punctuation">;</span>
            newFileInfoList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>fileInfo<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token comment">// 输入的是文件</span>
        <span class="token class-name">Meta<span class="token punctuation">.</span>FileConfig<span class="token punctuation">.</span>FileInfo</span> fileInfo <span class="token operator">=</span> <span class="token function">makeFileTemplate</span><span class="token punctuation">(</span>modelInfo<span class="token punctuation">,</span> searchStr<span class="token punctuation">,</span> sourceRootPath<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span>inputFileAbsolutePath<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        newFileInfoList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>fileInfo<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br></div></div><p>应用过滤器。将文件信息配置中的 <strong>相对路径转化为绝对路径</strong> 作为调用过滤器的参数，并通过过滤器获取到所有文件列表（注意，这里不可能是目录），再遍历文件列表来制作模板。</p> <p>修改生成文件模板的部分代码，如下：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// 二、生成文件模板</span>
<span class="token comment">// 遍历输入文件</span>
<span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Meta<span class="token punctuation">.</span>FileConfig<span class="token punctuation">.</span>FileInfo</span><span class="token punctuation">&gt;</span></span> newFileInfoList <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">TemplateMakerFileConfig<span class="token punctuation">.</span>FileInfoConfig</span> fileInfoConfig <span class="token operator">:</span> fileConfigInfoList<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">String</span> inputFilePath <span class="token operator">=</span> fileInfoConfig<span class="token punctuation">.</span><span class="token function">getPath</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 如果填的是相对路径，要改为绝对路径</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>inputFilePath<span class="token punctuation">.</span><span class="token function">startsWith</span><span class="token punctuation">(</span>sourceRootPath<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        inputFilePath <span class="token operator">=</span> sourceRootPath <span class="token operator">+</span> <span class="token class-name">File</span><span class="token punctuation">.</span>separator <span class="token operator">+</span> inputFilePath<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 获取过滤后的文件列表（不会存在目录）</span>
    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">File</span><span class="token punctuation">&gt;</span></span> fileList <span class="token operator">=</span> <span class="token class-name">FileFilter</span><span class="token punctuation">.</span><span class="token function">doFilter</span><span class="token punctuation">(</span>inputFilePath<span class="token punctuation">,</span> fileInfoConfig<span class="token punctuation">.</span><span class="token function">getFilterConfigList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">File</span> file <span class="token operator">:</span> fileList<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Meta<span class="token punctuation">.</span>FileConfig<span class="token punctuation">.</span>FileInfo</span> fileInfo <span class="token operator">=</span> <span class="token function">makeFileTemplate</span><span class="token punctuation">(</span>modelInfo<span class="token punctuation">,</span> searchStr<span class="token punctuation">,</span> sourceRootPath<span class="token punctuation">,</span> file<span class="token punctuation">)</span><span class="token punctuation">;</span>
        newFileInfoList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>fileInfo<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><p>5）在 main 方法中编写文件过滤测试代码，只处理 common 包下文件名称包含 <code>Base</code> 的文件和 controller 包下的文件。</p> <p>在 main 方法的最后追加代码，如下：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// 文件过滤</span>
<span class="token class-name">TemplateMakerFileConfig</span> templateMakerFileConfig <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">TemplateMakerFileConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">TemplateMakerFileConfig<span class="token punctuation">.</span>FileInfoConfig</span> fileInfoConfig1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">TemplateMakerFileConfig<span class="token punctuation">.</span>FileInfoConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
fileInfoConfig1<span class="token punctuation">.</span><span class="token function">setPath</span><span class="token punctuation">(</span>inputFilePath1<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">FileFilterConfig</span><span class="token punctuation">&gt;</span></span> fileFilterConfigList <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">FileFilterConfig</span> fileFilterConfig <span class="token operator">=</span> <span class="token class-name">FileFilterConfig</span><span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">range</span><span class="token punctuation">(</span><span class="token class-name">FileFilterRangeEnum</span><span class="token punctuation">.</span><span class="token constant">FILE_NAME</span><span class="token punctuation">.</span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">rule</span><span class="token punctuation">(</span><span class="token class-name">FileFilterRuleEnum</span><span class="token punctuation">.</span><span class="token constant">CONTAINS</span><span class="token punctuation">.</span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">value</span><span class="token punctuation">(</span><span class="token string">&quot;Base&quot;</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
fileFilterConfigList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>fileFilterConfig<span class="token punctuation">)</span><span class="token punctuation">;</span>
fileInfoConfig1<span class="token punctuation">.</span><span class="token function">setFilterConfigList</span><span class="token punctuation">(</span>fileFilterConfigList<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token class-name">TemplateMakerFileConfig<span class="token punctuation">.</span>FileInfoConfig</span> fileInfoConfig2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">TemplateMakerFileConfig<span class="token punctuation">.</span>FileInfoConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
fileInfoConfig2<span class="token punctuation">.</span><span class="token function">setPath</span><span class="token punctuation">(</span>inputFilePath2<span class="token punctuation">)</span><span class="token punctuation">;</span>
templateMakerFileConfig<span class="token punctuation">.</span><span class="token function">setFiles</span><span class="token punctuation">(</span><span class="token class-name">Arrays</span><span class="token punctuation">.</span><span class="token function">asList</span><span class="token punctuation">(</span>fileInfoConfig1<span class="token punctuation">,</span> fileInfoConfig2<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">long</span> id <span class="token operator">=</span> <span class="token function">makeTemplate</span><span class="token punctuation">(</span>meta<span class="token punctuation">,</span> originProjectPath<span class="token punctuation">,</span> templateMakerFileConfig<span class="token punctuation">,</span> modelInfo<span class="token punctuation">,</span> searchStr<span class="token punctuation">,</span> <span class="token number">1735281524670181376L</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><p>执行测试，只有 <code>BaseResponse.java</code> 生成了模板文件，符合预期：</p> <p><img alt="image.png" data-src="https://img.xiaoying.org.cn/img/202502181310590.png" loading="lazy" class="lazy"></p> <p>生成的元信息配置也没有多余的文件：</p> <p><img alt="image.png" data-src="https://img.xiaoying.org.cn/img/202502181311709.png" loading="lazy" class="lazy"></p> <h4 id="完整代码-3"><a href="#完整代码-3" class="header-anchor">#</a> 完整代码</h4> <p><code>TemplateMaker</code> 的完整代码如下：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>yupi<span class="token punctuation">.</span>maker<span class="token punctuation">.</span>template</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">cn<span class="token punctuation">.</span>hutool<span class="token punctuation">.</span>core<span class="token punctuation">.</span>bean<span class="token punctuation">.</span></span><span class="token class-name">BeanUtil</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">cn<span class="token punctuation">.</span>hutool<span class="token punctuation">.</span>core<span class="token punctuation">.</span>bean<span class="token punctuation">.</span>copier<span class="token punctuation">.</span></span><span class="token class-name">CopyOptions</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">cn<span class="token punctuation">.</span>hutool<span class="token punctuation">.</span>core<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">FileUtil</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">cn<span class="token punctuation">.</span>hutool<span class="token punctuation">.</span>core<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">IdUtil</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">cn<span class="token punctuation">.</span>hutool<span class="token punctuation">.</span>core<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">StrUtil</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">cn<span class="token punctuation">.</span>hutool<span class="token punctuation">.</span>json<span class="token punctuation">.</span></span><span class="token class-name">JSONUtil</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>yupi<span class="token punctuation">.</span>maker<span class="token punctuation">.</span>meta<span class="token punctuation">.</span></span><span class="token class-name">Meta</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>yupi<span class="token punctuation">.</span>maker<span class="token punctuation">.</span>meta<span class="token punctuation">.</span>enums<span class="token punctuation">.</span></span><span class="token class-name">FileGenerateTypeEnum</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>yupi<span class="token punctuation">.</span>maker<span class="token punctuation">.</span>meta<span class="token punctuation">.</span>enums<span class="token punctuation">.</span></span><span class="token class-name">FileTypeEnum</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>yupi<span class="token punctuation">.</span>maker<span class="token punctuation">.</span>template<span class="token punctuation">.</span>enums<span class="token punctuation">.</span></span><span class="token class-name">FileFilterRangeEnum</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>yupi<span class="token punctuation">.</span>maker<span class="token punctuation">.</span>template<span class="token punctuation">.</span>enums<span class="token punctuation">.</span></span><span class="token class-name">FileFilterRuleEnum</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>yupi<span class="token punctuation">.</span>maker<span class="token punctuation">.</span>template<span class="token punctuation">.</span>model<span class="token punctuation">.</span></span><span class="token class-name">FileFilterConfig</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>yupi<span class="token punctuation">.</span>maker<span class="token punctuation">.</span>template<span class="token punctuation">.</span>model<span class="token punctuation">.</span></span><span class="token class-name">TemplateMakerFileConfig</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">File</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>nio<span class="token punctuation">.</span>file<span class="token punctuation">.</span></span><span class="token class-name">Paths</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">ArrayList</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Arrays</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">List</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>stream<span class="token punctuation">.</span></span><span class="token class-name">Collectors</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TemplateMaker</span> <span class="token punctuation">{</span>

    <span class="token comment">/**
     * 制作模板
     *
     * @param newMeta
     * @param originProjectPath
     * @param templateMakerFileConfig
     * @param modelInfo
     * @param searchStr
     * @param id
     * @return
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">long</span> <span class="token function">makeTemplate</span><span class="token punctuation">(</span><span class="token class-name">Meta</span> newMeta<span class="token punctuation">,</span> <span class="token class-name">String</span> originProjectPath<span class="token punctuation">,</span> <span class="token class-name">TemplateMakerFileConfig</span> templateMakerFileConfig<span class="token punctuation">,</span> <span class="token class-name">Meta<span class="token punctuation">.</span>ModelConfig<span class="token punctuation">.</span>ModelInfo</span> modelInfo<span class="token punctuation">,</span> <span class="token class-name">String</span> searchStr<span class="token punctuation">,</span> <span class="token class-name">Long</span> id<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 没有 id 则生成</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>id <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            id <span class="token operator">=</span> <span class="token class-name">IdUtil</span><span class="token punctuation">.</span><span class="token function">getSnowflakeNextId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token comment">// 复制目录</span>
        <span class="token class-name">String</span> projectPath <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">getProperty</span><span class="token punctuation">(</span><span class="token string">&quot;user.dir&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> tempDirPath <span class="token operator">=</span> projectPath <span class="token operator">+</span> <span class="token class-name">File</span><span class="token punctuation">.</span>separator <span class="token operator">+</span> <span class="token string">&quot;.temp&quot;</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> templatePath <span class="token operator">=</span> tempDirPath <span class="token operator">+</span> <span class="token class-name">File</span><span class="token punctuation">.</span>separator <span class="token operator">+</span> id<span class="token punctuation">;</span>

        <span class="token comment">// 是否为首次制作模板</span>
        <span class="token comment">// 目录不存在，则是首次制作</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token class-name">FileUtil</span><span class="token punctuation">.</span><span class="token function">exist</span><span class="token punctuation">(</span>templatePath<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">FileUtil</span><span class="token punctuation">.</span><span class="token function">mkdir</span><span class="token punctuation">(</span>templatePath<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">FileUtil</span><span class="token punctuation">.</span><span class="token function">copy</span><span class="token punctuation">(</span>originProjectPath<span class="token punctuation">,</span> templatePath<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token comment">// 一、输入信息</span>
        <span class="token comment">// 输入文件信息</span>
        <span class="token class-name">String</span> sourceRootPath <span class="token operator">=</span> templatePath <span class="token operator">+</span> <span class="token class-name">File</span><span class="token punctuation">.</span>separator <span class="token operator">+</span> <span class="token class-name">FileUtil</span><span class="token punctuation">.</span><span class="token function">getLastPathEle</span><span class="token punctuation">(</span><span class="token class-name">Paths</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>originProjectPath<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 注意 win 系统需要对路径进行转义</span>
		sourceRootPath <span class="token operator">=</span> sourceRootPath<span class="token punctuation">.</span><span class="token function">replaceAll</span><span class="token punctuation">(</span><span class="token string">&quot;\\\\&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;/&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">TemplateMakerFileConfig<span class="token punctuation">.</span>FileInfoConfig</span><span class="token punctuation">&gt;</span></span> fileConfigInfoList <span class="token operator">=</span> templateMakerFileConfig<span class="token punctuation">.</span><span class="token function">getFiles</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 二、生成文件模板</span>
        <span class="token comment">// 遍历输入文件</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Meta<span class="token punctuation">.</span>FileConfig<span class="token punctuation">.</span>FileInfo</span><span class="token punctuation">&gt;</span></span> newFileInfoList <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">TemplateMakerFileConfig<span class="token punctuation">.</span>FileInfoConfig</span> fileInfoConfig <span class="token operator">:</span> fileConfigInfoList<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">String</span> inputFilePath <span class="token operator">=</span> fileInfoConfig<span class="token punctuation">.</span><span class="token function">getPath</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment">// 如果填的是相对路径，要改为绝对路径</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>inputFilePath<span class="token punctuation">.</span><span class="token function">startsWith</span><span class="token punctuation">(</span>sourceRootPath<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                inputFilePath <span class="token operator">=</span> sourceRootPath <span class="token operator">+</span> <span class="token class-name">File</span><span class="token punctuation">.</span>separator <span class="token operator">+</span> inputFilePath<span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            <span class="token comment">// 获取过滤后的文件列表（不会存在目录）</span>
            <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">File</span><span class="token punctuation">&gt;</span></span> fileList <span class="token operator">=</span> <span class="token class-name">FileFilter</span><span class="token punctuation">.</span><span class="token function">doFilter</span><span class="token punctuation">(</span>inputFilePath<span class="token punctuation">,</span> fileInfoConfig<span class="token punctuation">.</span><span class="token function">getFilterConfigList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">File</span> file <span class="token operator">:</span> fileList<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token class-name">Meta<span class="token punctuation">.</span>FileConfig<span class="token punctuation">.</span>FileInfo</span> fileInfo <span class="token operator">=</span> <span class="token function">makeFileTemplate</span><span class="token punctuation">(</span>modelInfo<span class="token punctuation">,</span> searchStr<span class="token punctuation">,</span> sourceRootPath<span class="token punctuation">,</span> file<span class="token punctuation">)</span><span class="token punctuation">;</span>
                newFileInfoList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>fileInfo<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>

        <span class="token comment">// 三、生成配置文件</span>
        <span class="token class-name">String</span> metaOutputPath <span class="token operator">=</span> sourceRootPath <span class="token operator">+</span> <span class="token class-name">File</span><span class="token punctuation">.</span>separator <span class="token operator">+</span> <span class="token string">&quot;meta.json&quot;</span><span class="token punctuation">;</span>

        <span class="token comment">// 如果已有 meta 文件，说明不是第一次制作，则在 meta 基础上进行修改</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">FileUtil</span><span class="token punctuation">.</span><span class="token function">exist</span><span class="token punctuation">(</span>metaOutputPath<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">Meta</span> oldMeta <span class="token operator">=</span> <span class="token class-name">JSONUtil</span><span class="token punctuation">.</span><span class="token function">toBean</span><span class="token punctuation">(</span><span class="token class-name">FileUtil</span><span class="token punctuation">.</span><span class="token function">readUtf8String</span><span class="token punctuation">(</span>metaOutputPath<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">Meta</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">BeanUtil</span><span class="token punctuation">.</span><span class="token function">copyProperties</span><span class="token punctuation">(</span>newMeta<span class="token punctuation">,</span> oldMeta<span class="token punctuation">,</span> <span class="token class-name">CopyOptions</span><span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ignoreNullValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            newMeta <span class="token operator">=</span> oldMeta<span class="token punctuation">;</span>

            <span class="token comment">// 1. 追加配置参数</span>
            <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Meta<span class="token punctuation">.</span>FileConfig<span class="token punctuation">.</span>FileInfo</span><span class="token punctuation">&gt;</span></span> fileInfoList <span class="token operator">=</span> newMeta<span class="token punctuation">.</span><span class="token function">getFileConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getFiles</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            fileInfoList<span class="token punctuation">.</span><span class="token function">addAll</span><span class="token punctuation">(</span>newFileInfoList<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Meta<span class="token punctuation">.</span>ModelConfig<span class="token punctuation">.</span>ModelInfo</span><span class="token punctuation">&gt;</span></span> modelInfoList <span class="token operator">=</span> newMeta<span class="token punctuation">.</span><span class="token function">getModelConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getModels</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            modelInfoList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>modelInfo<span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment">// 配置去重</span>
            newMeta<span class="token punctuation">.</span><span class="token function">getFileConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setFiles</span><span class="token punctuation">(</span><span class="token function">distinctFiles</span><span class="token punctuation">(</span>fileInfoList<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            newMeta<span class="token punctuation">.</span><span class="token function">getModelConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setModels</span><span class="token punctuation">(</span><span class="token function">distinctModels</span><span class="token punctuation">(</span>modelInfoList<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token comment">// 1. 构造配置参数</span>
            <span class="token class-name">Meta<span class="token punctuation">.</span>FileConfig</span> fileConfig <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Meta<span class="token punctuation">.</span>FileConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            newMeta<span class="token punctuation">.</span><span class="token function">setFileConfig</span><span class="token punctuation">(</span>fileConfig<span class="token punctuation">)</span><span class="token punctuation">;</span>
            fileConfig<span class="token punctuation">.</span><span class="token function">setSourceRootPath</span><span class="token punctuation">(</span>sourceRootPath<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Meta<span class="token punctuation">.</span>FileConfig<span class="token punctuation">.</span>FileInfo</span><span class="token punctuation">&gt;</span></span> fileInfoList <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            fileConfig<span class="token punctuation">.</span><span class="token function">setFiles</span><span class="token punctuation">(</span>fileInfoList<span class="token punctuation">)</span><span class="token punctuation">;</span>
            fileInfoList<span class="token punctuation">.</span><span class="token function">addAll</span><span class="token punctuation">(</span>newFileInfoList<span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token class-name">Meta<span class="token punctuation">.</span>ModelConfig</span> modelConfig <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Meta<span class="token punctuation">.</span>ModelConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            newMeta<span class="token punctuation">.</span><span class="token function">setModelConfig</span><span class="token punctuation">(</span>modelConfig<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Meta<span class="token punctuation">.</span>ModelConfig<span class="token punctuation">.</span>ModelInfo</span><span class="token punctuation">&gt;</span></span> modelInfoList <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            modelConfig<span class="token punctuation">.</span><span class="token function">setModels</span><span class="token punctuation">(</span>modelInfoList<span class="token punctuation">)</span><span class="token punctuation">;</span>
            modelInfoList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>modelInfo<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token comment">// 2. 输出元信息文件</span>
        <span class="token class-name">FileUtil</span><span class="token punctuation">.</span><span class="token function">writeUtf8String</span><span class="token punctuation">(</span><span class="token class-name">JSONUtil</span><span class="token punctuation">.</span><span class="token function">toJsonPrettyStr</span><span class="token punctuation">(</span>newMeta<span class="token punctuation">)</span><span class="token punctuation">,</span> metaOutputPath<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> id<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * 制作文件模板
     *
     * @param modelInfo
     * @param searchStr
     * @param sourceRootPath
     * @param inputFile
     * @return
     */</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">Meta<span class="token punctuation">.</span>FileConfig<span class="token punctuation">.</span>FileInfo</span> <span class="token function">makeFileTemplate</span><span class="token punctuation">(</span><span class="token class-name">Meta<span class="token punctuation">.</span>ModelConfig<span class="token punctuation">.</span>ModelInfo</span> modelInfo<span class="token punctuation">,</span> <span class="token class-name">String</span> searchStr<span class="token punctuation">,</span> <span class="token class-name">String</span> sourceRootPath<span class="token punctuation">,</span> <span class="token class-name">File</span> inputFile<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 要挖坑的文件绝对路径（用于制作模板）</span>
        <span class="token comment">// 注意 win 系统需要对路径进行转义</span>
        <span class="token class-name">String</span> fileInputAbsolutePath <span class="token operator">=</span> inputFile<span class="token punctuation">.</span><span class="token function">getAbsolutePath</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">replaceAll</span><span class="token punctuation">(</span><span class="token string">&quot;\\\\&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;/&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> fileOutputAbsolutePath <span class="token operator">=</span> fileInputAbsolutePath <span class="token operator">+</span> <span class="token string">&quot;.ftl&quot;</span><span class="token punctuation">;</span>
    
        <span class="token comment">// 文件输入输出相对路径（用于生成配置）</span>
        <span class="token class-name">String</span> fileInputPath <span class="token operator">=</span> fileInputAbsolutePath<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span>sourceRootPath <span class="token operator">+</span> <span class="token string">&quot;/&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> fileOutputPath <span class="token operator">=</span> fileInputPath <span class="token operator">+</span> <span class="token string">&quot;.ftl&quot;</span><span class="token punctuation">;</span>

        <span class="token comment">// 使用字符串替换，生成模板文件</span>
        <span class="token class-name">String</span> fileContent<span class="token punctuation">;</span>
        <span class="token comment">// 如果已有模板文件，说明不是第一次制作，则在模板基础上再次挖坑</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">FileUtil</span><span class="token punctuation">.</span><span class="token function">exist</span><span class="token punctuation">(</span>fileOutputAbsolutePath<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            fileContent <span class="token operator">=</span> <span class="token class-name">FileUtil</span><span class="token punctuation">.</span><span class="token function">readUtf8String</span><span class="token punctuation">(</span>fileOutputAbsolutePath<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            fileContent <span class="token operator">=</span> <span class="token class-name">FileUtil</span><span class="token punctuation">.</span><span class="token function">readUtf8String</span><span class="token punctuation">(</span>fileInputAbsolutePath<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token class-name">String</span> replacement <span class="token operator">=</span> <span class="token class-name">String</span><span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token string">&quot;${%s}&quot;</span><span class="token punctuation">,</span> modelInfo<span class="token punctuation">.</span><span class="token function">getFieldName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> newFileContent <span class="token operator">=</span> <span class="token class-name">StrUtil</span><span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span>fileContent<span class="token punctuation">,</span> searchStr<span class="token punctuation">,</span> replacement<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 文件配置信息</span>
        <span class="token class-name">Meta<span class="token punctuation">.</span>FileConfig<span class="token punctuation">.</span>FileInfo</span> fileInfo <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Meta<span class="token punctuation">.</span>FileConfig<span class="token punctuation">.</span>FileInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        fileInfo<span class="token punctuation">.</span><span class="token function">setInputPath</span><span class="token punctuation">(</span>fileInputPath<span class="token punctuation">)</span><span class="token punctuation">;</span>
        fileInfo<span class="token punctuation">.</span><span class="token function">setOutputPath</span><span class="token punctuation">(</span>fileOutputPath<span class="token punctuation">)</span><span class="token punctuation">;</span>
        fileInfo<span class="token punctuation">.</span><span class="token function">setType</span><span class="token punctuation">(</span><span class="token class-name">FileTypeEnum</span><span class="token punctuation">.</span><span class="token constant">FILE</span><span class="token punctuation">.</span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 和原文件一致，没有挖坑，则为静态生成</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>newFileContent<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>fileContent<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// 输出路径 = 输入路径</span>
            fileInfo<span class="token punctuation">.</span><span class="token function">setOutputPath</span><span class="token punctuation">(</span>fileInputPath<span class="token punctuation">)</span><span class="token punctuation">;</span>
            fileInfo<span class="token punctuation">.</span><span class="token function">setGenerateType</span><span class="token punctuation">(</span><span class="token class-name">FileGenerateTypeEnum</span><span class="token punctuation">.</span><span class="token constant">STATIC</span><span class="token punctuation">.</span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token comment">// 生成模板文件</span>
            fileInfo<span class="token punctuation">.</span><span class="token function">setGenerateType</span><span class="token punctuation">(</span><span class="token class-name">FileGenerateTypeEnum</span><span class="token punctuation">.</span><span class="token constant">DYNAMIC</span><span class="token punctuation">.</span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">FileUtil</span><span class="token punctuation">.</span><span class="token function">writeUtf8String</span><span class="token punctuation">(</span>newFileContent<span class="token punctuation">,</span> fileOutputAbsolutePath<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> fileInfo<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Meta</span> meta <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Meta</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        meta<span class="token punctuation">.</span><span class="token function">setName</span><span class="token punctuation">(</span><span class="token string">&quot;acm-template-generator&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        meta<span class="token punctuation">.</span><span class="token function">setDescription</span><span class="token punctuation">(</span><span class="token string">&quot;ACM 示例模板生成器&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">String</span> projectPath <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">getProperty</span><span class="token punctuation">(</span><span class="token string">&quot;user.dir&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> originProjectPath <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span>projectPath<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getParent</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token class-name">File</span><span class="token punctuation">.</span>separator <span class="token operator">+</span> <span class="token string">&quot;yuzi-generator-demo-projects/springboot-init&quot;</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> inputFilePath1 <span class="token operator">=</span> <span class="token string">&quot;src/main/java/com/yupi/springbootinit/common&quot;</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> inputFilePath2 <span class="token operator">=</span> <span class="token string">&quot;src/main/java/com/yupi/springbootinit/controller&quot;</span><span class="token punctuation">;</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> inputFilePathList <span class="token operator">=</span> <span class="token class-name">Arrays</span><span class="token punctuation">.</span><span class="token function">asList</span><span class="token punctuation">(</span>inputFilePath1<span class="token punctuation">,</span> inputFilePath2<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 模型参数信息（首次）</span>
<span class="token comment">//        Meta.ModelConfig.ModelInfo modelInfo = new Meta.ModelConfig.ModelInfo();</span>
<span class="token comment">//        modelInfo.setFieldName(&quot;outputText&quot;);</span>
<span class="token comment">//        modelInfo.setType(&quot;String&quot;);</span>
<span class="token comment">//        modelInfo.setDefaultValue(&quot;sum = &quot;);</span>

        <span class="token comment">// 模型参数信息（第二次）</span>
        <span class="token class-name">Meta<span class="token punctuation">.</span>ModelConfig<span class="token punctuation">.</span>ModelInfo</span> modelInfo <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Meta<span class="token punctuation">.</span>ModelConfig<span class="token punctuation">.</span>ModelInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        modelInfo<span class="token punctuation">.</span><span class="token function">setFieldName</span><span class="token punctuation">(</span><span class="token string">&quot;className&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        modelInfo<span class="token punctuation">.</span><span class="token function">setType</span><span class="token punctuation">(</span><span class="token string">&quot;String&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 替换变量（首次）</span>
<span class="token comment">//        String searchStr = &quot;Sum: &quot;;</span>
        <span class="token comment">// 替换变量（第二次）</span>
        <span class="token class-name">String</span> searchStr <span class="token operator">=</span> <span class="token string">&quot;BaseResponse&quot;</span><span class="token punctuation">;</span>

        <span class="token comment">// 文件过滤</span>
        <span class="token class-name">TemplateMakerFileConfig</span> templateMakerFileConfig <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">TemplateMakerFileConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">TemplateMakerFileConfig<span class="token punctuation">.</span>FileInfoConfig</span> fileInfoConfig1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">TemplateMakerFileConfig<span class="token punctuation">.</span>FileInfoConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        fileInfoConfig1<span class="token punctuation">.</span><span class="token function">setPath</span><span class="token punctuation">(</span>inputFilePath1<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">FileFilterConfig</span><span class="token punctuation">&gt;</span></span> fileFilterConfigList <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">FileFilterConfig</span> fileFilterConfig <span class="token operator">=</span> <span class="token class-name">FileFilterConfig</span><span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">range</span><span class="token punctuation">(</span><span class="token class-name">FileFilterRangeEnum</span><span class="token punctuation">.</span><span class="token constant">FILE_NAME</span><span class="token punctuation">.</span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">rule</span><span class="token punctuation">(</span><span class="token class-name">FileFilterRuleEnum</span><span class="token punctuation">.</span><span class="token constant">CONTAINS</span><span class="token punctuation">.</span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">value</span><span class="token punctuation">(</span><span class="token string">&quot;Base&quot;</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        fileFilterConfigList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>fileFilterConfig<span class="token punctuation">)</span><span class="token punctuation">;</span>
        fileInfoConfig1<span class="token punctuation">.</span><span class="token function">setFilterConfigList</span><span class="token punctuation">(</span>fileFilterConfigList<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">TemplateMakerFileConfig<span class="token punctuation">.</span>FileInfoConfig</span> fileInfoConfig2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">TemplateMakerFileConfig<span class="token punctuation">.</span>FileInfoConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        fileInfoConfig2<span class="token punctuation">.</span><span class="token function">setPath</span><span class="token punctuation">(</span>inputFilePath2<span class="token punctuation">)</span><span class="token punctuation">;</span>
        templateMakerFileConfig<span class="token punctuation">.</span><span class="token function">setFiles</span><span class="token punctuation">(</span><span class="token class-name">Arrays</span><span class="token punctuation">.</span><span class="token function">asList</span><span class="token punctuation">(</span>fileInfoConfig1<span class="token punctuation">,</span> fileInfoConfig2<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">long</span> id <span class="token operator">=</span> <span class="token function">makeTemplate</span><span class="token punctuation">(</span>meta<span class="token punctuation">,</span> originProjectPath<span class="token punctuation">,</span> templateMakerFileConfig<span class="token punctuation">,</span> modelInfo<span class="token punctuation">,</span> searchStr<span class="token punctuation">,</span> <span class="token number">1735281524670181376L</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * 模型去重
     *
     * @param modelInfoList
     * @return
     */</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Meta<span class="token punctuation">.</span>ModelConfig<span class="token punctuation">.</span>ModelInfo</span><span class="token punctuation">&gt;</span></span> <span class="token function">distinctModels</span><span class="token punctuation">(</span><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Meta<span class="token punctuation">.</span>ModelConfig<span class="token punctuation">.</span>ModelInfo</span><span class="token punctuation">&gt;</span></span> modelInfoList<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Meta<span class="token punctuation">.</span>ModelConfig<span class="token punctuation">.</span>ModelInfo</span><span class="token punctuation">&gt;</span></span> newModelInfoList <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>modelInfoList<span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span><span class="token class-name">Collectors</span><span class="token punctuation">.</span><span class="token function">toMap</span><span class="token punctuation">(</span><span class="token class-name">Meta<span class="token punctuation">.</span>ModelConfig<span class="token punctuation">.</span>ModelInfo</span><span class="token operator">::</span><span class="token function">getFieldName</span><span class="token punctuation">,</span> o <span class="token operator">-&gt;</span> o<span class="token punctuation">,</span> <span class="token punctuation">(</span>e<span class="token punctuation">,</span> r<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> r<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">values</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> newModelInfoList<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * 文件去重
     *
     * @param fileInfoList
     * @return
     */</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Meta<span class="token punctuation">.</span>FileConfig<span class="token punctuation">.</span>FileInfo</span><span class="token punctuation">&gt;</span></span> <span class="token function">distinctFiles</span><span class="token punctuation">(</span><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Meta<span class="token punctuation">.</span>FileConfig<span class="token punctuation">.</span>FileInfo</span><span class="token punctuation">&gt;</span></span> fileInfoList<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Meta<span class="token punctuation">.</span>FileConfig<span class="token punctuation">.</span>FileInfo</span><span class="token punctuation">&gt;</span></span> newFileInfoList <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>fileInfoList<span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span><span class="token class-name">Collectors</span><span class="token punctuation">.</span><span class="token function">toMap</span><span class="token punctuation">(</span><span class="token class-name">Meta<span class="token punctuation">.</span>FileConfig<span class="token punctuation">.</span>FileInfo</span><span class="token operator">::</span><span class="token function">getInputPath</span><span class="token punctuation">,</span> o <span class="token operator">-&gt;</span> o<span class="token punctuation">,</span> <span class="token punctuation">(</span>e<span class="token punctuation">,</span> r<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> r<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">values</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> newFileInfoList<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br><span class="line-number">103</span><br><span class="line-number">104</span><br><span class="line-number">105</span><br><span class="line-number">106</span><br><span class="line-number">107</span><br><span class="line-number">108</span><br><span class="line-number">109</span><br><span class="line-number">110</span><br><span class="line-number">111</span><br><span class="line-number">112</span><br><span class="line-number">113</span><br><span class="line-number">114</span><br><span class="line-number">115</span><br><span class="line-number">116</span><br><span class="line-number">117</span><br><span class="line-number">118</span><br><span class="line-number">119</span><br><span class="line-number">120</span><br><span class="line-number">121</span><br><span class="line-number">122</span><br><span class="line-number">123</span><br><span class="line-number">124</span><br><span class="line-number">125</span><br><span class="line-number">126</span><br><span class="line-number">127</span><br><span class="line-number">128</span><br><span class="line-number">129</span><br><span class="line-number">130</span><br><span class="line-number">131</span><br><span class="line-number">132</span><br><span class="line-number">133</span><br><span class="line-number">134</span><br><span class="line-number">135</span><br><span class="line-number">136</span><br><span class="line-number">137</span><br><span class="line-number">138</span><br><span class="line-number">139</span><br><span class="line-number">140</span><br><span class="line-number">141</span><br><span class="line-number">142</span><br><span class="line-number">143</span><br><span class="line-number">144</span><br><span class="line-number">145</span><br><span class="line-number">146</span><br><span class="line-number">147</span><br><span class="line-number">148</span><br><span class="line-number">149</span><br><span class="line-number">150</span><br><span class="line-number">151</span><br><span class="line-number">152</span><br><span class="line-number">153</span><br><span class="line-number">154</span><br><span class="line-number">155</span><br><span class="line-number">156</span><br><span class="line-number">157</span><br><span class="line-number">158</span><br><span class="line-number">159</span><br><span class="line-number">160</span><br><span class="line-number">161</span><br><span class="line-number">162</span><br><span class="line-number">163</span><br><span class="line-number">164</span><br><span class="line-number">165</span><br><span class="line-number">166</span><br><span class="line-number">167</span><br><span class="line-number">168</span><br><span class="line-number">169</span><br><span class="line-number">170</span><br><span class="line-number">171</span><br><span class="line-number">172</span><br><span class="line-number">173</span><br><span class="line-number">174</span><br><span class="line-number">175</span><br><span class="line-number">176</span><br><span class="line-number">177</span><br><span class="line-number">178</span><br><span class="line-number">179</span><br><span class="line-number">180</span><br><span class="line-number">181</span><br><span class="line-number">182</span><br><span class="line-number">183</span><br><span class="line-number">184</span><br><span class="line-number">185</span><br><span class="line-number">186</span><br><span class="line-number">187</span><br><span class="line-number">188</span><br><span class="line-number">189</span><br><span class="line-number">190</span><br><span class="line-number">191</span><br><span class="line-number">192</span><br><span class="line-number">193</span><br><span class="line-number">194</span><br><span class="line-number">195</span><br><span class="line-number">196</span><br><span class="line-number">197</span><br><span class="line-number">198</span><br><span class="line-number">199</span><br><span class="line-number">200</span><br><span class="line-number">201</span><br><span class="line-number">202</span><br><span class="line-number">203</span><br><span class="line-number">204</span><br><span class="line-number">205</span><br><span class="line-number">206</span><br><span class="line-number">207</span><br><span class="line-number">208</span><br><span class="line-number">209</span><br><span class="line-number">210</span><br><span class="line-number">211</span><br><span class="line-number">212</span><br><span class="line-number">213</span><br><span class="line-number">214</span><br><span class="line-number">215</span><br><span class="line-number">216</span><br><span class="line-number">217</span><br><span class="line-number">218</span><br><span class="line-number">219</span><br><span class="line-number">220</span><br><span class="line-number">221</span><br><span class="line-number">222</span><br><span class="line-number">223</span><br><span class="line-number">224</span><br><span class="line-number">225</span><br><span class="line-number">226</span><br><span class="line-number">227</span><br><span class="line-number">228</span><br><span class="line-number">229</span><br><span class="line-number">230</span><br><span class="line-number">231</span><br><span class="line-number">232</span><br><span class="line-number">233</span><br><span class="line-number">234</span><br><span class="line-number">235</span><br><span class="line-number">236</span><br><span class="line-number">237</span><br><span class="line-number">238</span><br></div></div><h3 id="_3、文件分组"><a href="#_3、文件分组" class="header-anchor">#</a> 3、文件分组</h3> <p>目前，我们的制作工具已经支持对文件进行分组，并且通过给组设置 condition 的方式，支持用单个模型参数同时控制一组文件。</p> <p>同样的，我们的模板制作工具也需要拥有快速生成文件组配置的能力。</p> <h4 id="实现思路"><a href="#实现思路" class="header-anchor">#</a> 实现思路</h4> <p>怎么实现呢？</p> <p>我们现在已经能够单次制作多个文件了，而且根据用户习惯，同一次制作的多个文件更有可能属于同一组。那么其实我们不用让用户再手动配置如何分组了，可以自动分组。</p> <p>有 2 种分组策略</p> <ol><li>一个文件信息配置（FileInfoConfig）对应一次分组。如果传入的 path 是目录，则目录下的所有文件为同组。</li> <li>一个完整的文件配置（TemplateMakerFileConfig）对应一次分组。即配置 files 列表中的所有文件都属于同组。</li></ol> <p>这里选择第 2 种方案。原因是从需求出发，对于 “要用一个参数控制帖子相关的文件是否生成” 的需求，有可能要把跨目录下的文件设置为一个组。第 2 种方案会更灵活。</p> <h4 id="开发实现-2"><a href="#开发实现-2" class="header-anchor">#</a> 开发实现</h4> <p>下面我们来实现文件分组功能。</p> <p>1）首先给 <code>TemplateMakerFileConfig</code> 增加分组配置，和之前 <code>Meta</code> 元信息实体类的分组字段一一对应。</p> <p>代码如下：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>yupi<span class="token punctuation">.</span>maker<span class="token punctuation">.</span>template<span class="token punctuation">.</span>model</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">lombok<span class="token punctuation">.</span></span><span class="token class-name">Data</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">lombok<span class="token punctuation">.</span></span><span class="token class-name">NoArgsConstructor</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">List</span></span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@Data</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TemplateMakerFileConfig</span> <span class="token punctuation">{</span>

    <span class="token keyword">private</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">FileInfoConfig</span><span class="token punctuation">&gt;</span></span> files<span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token class-name">FileGroupConfig</span> fileGroupConfig<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@NoArgsConstructor</span>
    <span class="token annotation punctuation">@Data</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">FileInfoConfig</span> <span class="token punctuation">{</span>

        <span class="token keyword">private</span> <span class="token class-name">String</span> path<span class="token punctuation">;</span>

        <span class="token keyword">private</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">FileFilterConfig</span><span class="token punctuation">&gt;</span></span> filterConfigList<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Data</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">FileGroupConfig</span> <span class="token punctuation">{</span>

        <span class="token keyword">private</span> <span class="token class-name">String</span> condition<span class="token punctuation">;</span>

        <span class="token keyword">private</span> <span class="token class-name">String</span> groupKey<span class="token punctuation">;</span>

        <span class="token keyword">private</span> <span class="token class-name">String</span> groupName<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br></div></div><p>2）在 <code>TemplateMaker</code> 的 <code>makeTemplate</code> 方法中增加文件组相关代码，思路是将本次得到的所有文件信息都放到同一个分组下。</p> <p>在 “生成配置文件” 前增加如下代码：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// 如果是文件组</span>
<span class="token class-name">TemplateMakerFileConfig<span class="token punctuation">.</span>FileGroupConfig</span> fileGroupConfig <span class="token operator">=</span> templateMakerFileConfig<span class="token punctuation">.</span><span class="token function">getFileGroupConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>fileGroupConfig <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">String</span> condition <span class="token operator">=</span> fileGroupConfig<span class="token punctuation">.</span><span class="token function">getCondition</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">String</span> groupKey <span class="token operator">=</span> fileGroupConfig<span class="token punctuation">.</span><span class="token function">getGroupKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">String</span> groupName <span class="token operator">=</span> fileGroupConfig<span class="token punctuation">.</span><span class="token function">getGroupName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 新增分组配置</span>
    <span class="token class-name">Meta<span class="token punctuation">.</span>FileConfig<span class="token punctuation">.</span>FileInfo</span> groupFileInfo <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Meta<span class="token punctuation">.</span>FileConfig<span class="token punctuation">.</span>FileInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    groupFileInfo<span class="token punctuation">.</span><span class="token function">setType</span><span class="token punctuation">(</span><span class="token class-name">FileTypeEnum</span><span class="token punctuation">.</span><span class="token constant">GROUP</span><span class="token punctuation">.</span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    groupFileInfo<span class="token punctuation">.</span><span class="token function">setCondition</span><span class="token punctuation">(</span>condition<span class="token punctuation">)</span><span class="token punctuation">;</span>
    groupFileInfo<span class="token punctuation">.</span><span class="token function">setGroupKey</span><span class="token punctuation">(</span>groupKey<span class="token punctuation">)</span><span class="token punctuation">;</span>
    groupFileInfo<span class="token punctuation">.</span><span class="token function">setGroupName</span><span class="token punctuation">(</span>groupName<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 文件全放到一个分组内</span>
    groupFileInfo<span class="token punctuation">.</span><span class="token function">setFiles</span><span class="token punctuation">(</span>newFileInfoList<span class="token punctuation">)</span><span class="token punctuation">;</span>
    newFileInfoList <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    newFileInfoList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>groupFileInfo<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><p>3）在 main 方法中增加分组测试数据，代码如下：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// 分组配置</span>
<span class="token class-name">TemplateMakerFileConfig<span class="token punctuation">.</span>FileGroupConfig</span> fileGroupConfig <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">TemplateMakerFileConfig<span class="token punctuation">.</span>FileGroupConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
fileGroupConfig<span class="token punctuation">.</span><span class="token function">setCondition</span><span class="token punctuation">(</span><span class="token string">&quot;outputText&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
fileGroupConfig<span class="token punctuation">.</span><span class="token function">setGroupKey</span><span class="token punctuation">(</span><span class="token string">&quot;test&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
fileGroupConfig<span class="token punctuation">.</span><span class="token function">setGroupName</span><span class="token punctuation">(</span><span class="token string">&quot;测试分组&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
templateMakerFileConfig<span class="token punctuation">.</span><span class="token function">setFileGroupConfig</span><span class="token punctuation">(</span>fileGroupConfig<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>执行，成功生成分组配置：</p> <p><img alt="image.png" data-src="https://img.xiaoying.org.cn/img/202502181313092.png" loading="lazy" class="lazy"></p> <h4 id="追加配置能力"><a href="#追加配置能力" class="header-anchor">#</a> 追加配置能力</h4> <p>虽然已经实现了文件分组配置的生成，但是实际制作模板的过程中，我们可能没办法一步到位，而是希望能多次制作模板，并将文件追加到之前已有的分组下。</p> <p>也就是说，文件分组要能支持多次制作时追加配置的能力，可以增加新的分组、也可以在同分组下新增文件。</p> <p>1）让我们先来明确下需求。</p> <p>举个例子，假设第 1 次制作得到的分组配置如下：</p> <div class="language-json line-numbers-mode"><pre class="language-json"><code><span class="token punctuation">{</span>
    <span class="token property">&quot;files&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span>
          <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;group&quot;</span><span class="token punctuation">,</span>
          <span class="token property">&quot;condition&quot;</span><span class="token operator">:</span> <span class="token string">&quot;outputText&quot;</span><span class="token punctuation">,</span>
          <span class="token property">&quot;groupKey&quot;</span><span class="token operator">:</span> <span class="token string">&quot;test&quot;</span><span class="token punctuation">,</span>
          <span class="token property">&quot;groupName&quot;</span><span class="token operator">:</span> <span class="token string">&quot;测试分组&quot;</span><span class="token punctuation">,</span>
          <span class="token property">&quot;files&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
              <span class="token punctuation">{</span>
                  <span class="token property">&quot;inputPath&quot;</span><span class="token operator">:</span> <span class="token string">&quot;src/main/java/com/yupi/springbootinit/common/BaseResponse.java&quot;</span><span class="token punctuation">,</span>
                  <span class="token property">&quot;outputPath&quot;</span><span class="token operator">:</span> <span class="token string">&quot;src/main/java/com/yupi/springbootinit/common/BaseResponse.java.ftl&quot;</span><span class="token punctuation">,</span>
                  <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;file&quot;</span><span class="token punctuation">,</span>
                  <span class="token property">&quot;generateType&quot;</span><span class="token operator">:</span> <span class="token string">&quot;dynamic&quot;</span>
              <span class="token punctuation">}</span><span class="token punctuation">,</span>
              <span class="token punctuation">{</span>
                  <span class="token property">&quot;inputPath&quot;</span><span class="token operator">:</span> <span class="token string">&quot;src/main/java/com/yupi/springbootinit/controller/PostController.java&quot;</span><span class="token punctuation">,</span>
                  <span class="token property">&quot;outputPath&quot;</span><span class="token operator">:</span> <span class="token string">&quot;src/main/java/com/yupi/springbootinit/controller/PostController.java.ftl&quot;</span><span class="token punctuation">,</span>
                  <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;file&quot;</span><span class="token punctuation">,</span>
                  <span class="token property">&quot;generateType&quot;</span><span class="token operator">:</span> <span class="token string">&quot;dynamic&quot;</span>
              <span class="token punctuation">}</span><span class="token punctuation">,</span>
              <span class="token punctuation">{</span>
                  <span class="token property">&quot;inputPath&quot;</span><span class="token operator">:</span> <span class="token string">&quot;src/main/java/com/yupi/springbootinit/controller/UserController.java&quot;</span><span class="token punctuation">,</span>
                  <span class="token property">&quot;outputPath&quot;</span><span class="token operator">:</span> <span class="token string">&quot;src/main/java/com/yupi/springbootinit/controller/UserController.java.ftl&quot;</span><span class="token punctuation">,</span>
                  <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;file&quot;</span><span class="token punctuation">,</span>
                  <span class="token property">&quot;generateType&quot;</span><span class="token operator">:</span> <span class="token string">&quot;dynamic&quot;</span>
              <span class="token punctuation">}</span>
          <span class="token punctuation">]</span>
      <span class="token punctuation">}</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br></div></div><p>第 2 次制作得到的分组配置如下，新增了 <code>ResultUtils.java</code> 文件：</p> <div class="language-json line-numbers-mode"><pre class="language-json"><code><span class="token punctuation">{</span>
    <span class="token property">&quot;files&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span>
          <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;group&quot;</span><span class="token punctuation">,</span>
          <span class="token property">&quot;condition&quot;</span><span class="token operator">:</span> <span class="token string">&quot;outputText&quot;</span><span class="token punctuation">,</span>
          <span class="token property">&quot;groupKey&quot;</span><span class="token operator">:</span> <span class="token string">&quot;test&quot;</span><span class="token punctuation">,</span>
          <span class="token property">&quot;groupName&quot;</span><span class="token operator">:</span> <span class="token string">&quot;测试分组&quot;</span><span class="token punctuation">,</span>
          <span class="token property">&quot;files&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
              <span class="token punctuation">{</span>
                  <span class="token property">&quot;inputPath&quot;</span><span class="token operator">:</span> <span class="token string">&quot;src/main/java/com/yupi/springbootinit/common/ResultUtils.java&quot;</span><span class="token punctuation">,</span>
                  <span class="token property">&quot;outputPath&quot;</span><span class="token operator">:</span> <span class="token string">&quot;src/main/java/com/yupi/springbootinit/common/ResultUtils.java.ftl&quot;</span><span class="token punctuation">,</span>
                  <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;file&quot;</span><span class="token punctuation">,</span>
                  <span class="token property">&quot;generateType&quot;</span><span class="token operator">:</span> <span class="token string">&quot;dynamic&quot;</span>
              <span class="token punctuation">}</span><span class="token punctuation">,</span>
              <span class="token punctuation">{</span>
                  <span class="token property">&quot;inputPath&quot;</span><span class="token operator">:</span> <span class="token string">&quot;src/main/java/com/yupi/springbootinit/controller/PostController.java&quot;</span><span class="token punctuation">,</span>
                  <span class="token property">&quot;outputPath&quot;</span><span class="token operator">:</span> <span class="token string">&quot;src/main/java/com/yupi/springbootinit/controller/PostController.java.ftl&quot;</span><span class="token punctuation">,</span>
                  <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;file&quot;</span><span class="token punctuation">,</span>
                  <span class="token property">&quot;generateType&quot;</span><span class="token operator">:</span> <span class="token string">&quot;dynamic&quot;</span>
              <span class="token punctuation">}</span>
          <span class="token punctuation">]</span>
      <span class="token punctuation">}</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br></div></div><p>由于两个分组的 <code>groupKey</code> 相同，视为同一个组，需要将第 2 次得到的分组内的所有文件和之前分组内的文件进行合并去重。得到如下配置：</p> <div class="language-json line-numbers-mode"><pre class="language-json"><code><span class="token punctuation">{</span>
    <span class="token property">&quot;files&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span>
          <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;group&quot;</span><span class="token punctuation">,</span>
          <span class="token property">&quot;condition&quot;</span><span class="token operator">:</span> <span class="token string">&quot;outputText&quot;</span><span class="token punctuation">,</span>
          <span class="token property">&quot;groupKey&quot;</span><span class="token operator">:</span> <span class="token string">&quot;test&quot;</span><span class="token punctuation">,</span>
          <span class="token property">&quot;groupName&quot;</span><span class="token operator">:</span> <span class="token string">&quot;测试分组&quot;</span><span class="token punctuation">,</span>
          <span class="token property">&quot;files&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
              <span class="token punctuation">{</span>
                  <span class="token property">&quot;inputPath&quot;</span><span class="token operator">:</span> <span class="token string">&quot;src/main/java/com/yupi/springbootinit/common/BaseResponse.java&quot;</span><span class="token punctuation">,</span>
                  <span class="token property">&quot;outputPath&quot;</span><span class="token operator">:</span> <span class="token string">&quot;src/main/java/com/yupi/springbootinit/common/BaseResponse.java.ftl&quot;</span><span class="token punctuation">,</span>
                  <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;file&quot;</span><span class="token punctuation">,</span>
                  <span class="token property">&quot;generateType&quot;</span><span class="token operator">:</span> <span class="token string">&quot;dynamic&quot;</span>
              <span class="token punctuation">}</span><span class="token punctuation">,</span>
              <span class="token punctuation">{</span>
                  <span class="token property">&quot;inputPath&quot;</span><span class="token operator">:</span> <span class="token string">&quot;src/main/java/com/yupi/springbootinit/controller/PostController.java&quot;</span><span class="token punctuation">,</span>
                  <span class="token property">&quot;outputPath&quot;</span><span class="token operator">:</span> <span class="token string">&quot;src/main/java/com/yupi/springbootinit/controller/PostController.java.ftl&quot;</span><span class="token punctuation">,</span>
                  <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;file&quot;</span><span class="token punctuation">,</span>
                  <span class="token property">&quot;generateType&quot;</span><span class="token operator">:</span> <span class="token string">&quot;dynamic&quot;</span>
              <span class="token punctuation">}</span><span class="token punctuation">,</span>
              <span class="token punctuation">{</span>
                  <span class="token property">&quot;inputPath&quot;</span><span class="token operator">:</span> <span class="token string">&quot;src/main/java/com/yupi/springbootinit/controller/UserController.java&quot;</span><span class="token punctuation">,</span>
                  <span class="token property">&quot;outputPath&quot;</span><span class="token operator">:</span> <span class="token string">&quot;src/main/java/com/yupi/springbootinit/controller/UserController.java.ftl&quot;</span><span class="token punctuation">,</span>
                  <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;file&quot;</span><span class="token punctuation">,</span>
                  <span class="token property">&quot;generateType&quot;</span><span class="token operator">:</span> <span class="token string">&quot;dynamic&quot;</span>
              <span class="token punctuation">}</span><span class="token punctuation">,</span>
            	<span class="token punctuation">{</span>
                  <span class="token property">&quot;inputPath&quot;</span><span class="token operator">:</span> <span class="token string">&quot;src/main/java/com/yupi/springbootinit/common/ResultUtils.java&quot;</span><span class="token punctuation">,</span>
                  <span class="token property">&quot;outputPath&quot;</span><span class="token operator">:</span> <span class="token string">&quot;src/main/java/com/yupi/springbootinit/common/ResultUtils.java.ftl&quot;</span><span class="token punctuation">,</span>
                  <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;file&quot;</span><span class="token punctuation">,</span>
                  <span class="token property">&quot;generateType&quot;</span><span class="token operator">:</span> <span class="token string">&quot;dynamic&quot;</span>
              <span class="token punctuation">}</span>
          <span class="token punctuation">]</span>
      <span class="token punctuation">}</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br></div></div><p>2）明确需求后，让我们来梳理下文件分组去重的实现流程，分为以下步骤：</p> <ol><li>将所有文件配置（fileInfo）分为有分组的和无分组的</li> <li>对于有分组的文件配置，如果有相同的分组，同分组内的文件进行合并（merge），不同分组可同时保留</li> <li>创建新的文件配置列表（结果列表），先将合并后的分组添加到结果列表</li> <li>再将无分组的文件配置列表添加到结果列表</li></ol> <p>3）根据上述步骤，编写代码实现。</p> <p>修改后的 <code>distinctFiles</code> 方法代码如下：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">/**
 * 文件去重
 *
 * @param fileInfoList
 * @return
 */</span>
<span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Meta<span class="token punctuation">.</span>FileConfig<span class="token punctuation">.</span>FileInfo</span><span class="token punctuation">&gt;</span></span> <span class="token function">distinctFiles</span><span class="token punctuation">(</span><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Meta<span class="token punctuation">.</span>FileConfig<span class="token punctuation">.</span>FileInfo</span><span class="token punctuation">&gt;</span></span> fileInfoList<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 策略：同分组内文件 merge，不同分组保留</span>

    <span class="token comment">// 1. 有分组的，以组为单位划分</span>
    <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">List</span><span class="token punctuation">&lt;</span><span class="token class-name">Meta<span class="token punctuation">.</span>FileConfig<span class="token punctuation">.</span>FileInfo</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> groupKeyFileInfoListMap <span class="token operator">=</span> fileInfoList
            <span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>fileInfo <span class="token operator">-&gt;</span> <span class="token class-name">StrUtil</span><span class="token punctuation">.</span><span class="token function">isNotBlank</span><span class="token punctuation">(</span>fileInfo<span class="token punctuation">.</span><span class="token function">getGroupKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span>
                    <span class="token class-name">Collectors</span><span class="token punctuation">.</span><span class="token function">groupingBy</span><span class="token punctuation">(</span><span class="token class-name">Meta<span class="token punctuation">.</span>FileConfig<span class="token punctuation">.</span>FileInfo</span><span class="token operator">::</span><span class="token function">getGroupKey</span><span class="token punctuation">)</span>
            <span class="token punctuation">)</span><span class="token punctuation">;</span>


    <span class="token comment">// 2. 同组内的文件配置合并</span>
    <span class="token comment">// 保存每个组对应的合并后的对象 map</span>
    <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Meta<span class="token punctuation">.</span>FileConfig<span class="token punctuation">.</span>FileInfo</span><span class="token punctuation">&gt;</span></span> groupKeyMergedFileInfoMap <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Map<span class="token punctuation">.</span>Entry</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">List</span><span class="token punctuation">&lt;</span><span class="token class-name">Meta<span class="token punctuation">.</span>FileConfig<span class="token punctuation">.</span>FileInfo</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> entry <span class="token operator">:</span> groupKeyFileInfoListMap<span class="token punctuation">.</span><span class="token function">entrySet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Meta<span class="token punctuation">.</span>FileConfig<span class="token punctuation">.</span>FileInfo</span><span class="token punctuation">&gt;</span></span> tempFileInfoList <span class="token operator">=</span> entry<span class="token punctuation">.</span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Meta<span class="token punctuation">.</span>FileConfig<span class="token punctuation">.</span>FileInfo</span><span class="token punctuation">&gt;</span></span> newFileInfoList <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>tempFileInfoList<span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">flatMap</span><span class="token punctuation">(</span>fileInfo <span class="token operator">-&gt;</span> fileInfo<span class="token punctuation">.</span><span class="token function">getFiles</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span>
                        <span class="token class-name">Collectors</span><span class="token punctuation">.</span><span class="token function">toMap</span><span class="token punctuation">(</span><span class="token class-name">Meta<span class="token punctuation">.</span>FileConfig<span class="token punctuation">.</span>FileInfo</span><span class="token operator">::</span><span class="token function">getInputPath</span><span class="token punctuation">,</span> o <span class="token operator">-&gt;</span> o<span class="token punctuation">,</span> <span class="token punctuation">(</span>e<span class="token punctuation">,</span> r<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> r<span class="token punctuation">)</span>
                <span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">values</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 使用新的 group 配置</span>
        <span class="token class-name">Meta<span class="token punctuation">.</span>FileConfig<span class="token punctuation">.</span>FileInfo</span> newFileInfo <span class="token operator">=</span> <span class="token class-name">CollUtil</span><span class="token punctuation">.</span><span class="token function">getLast</span><span class="token punctuation">(</span>tempFileInfoList<span class="token punctuation">)</span><span class="token punctuation">;</span>
        newFileInfo<span class="token punctuation">.</span><span class="token function">setFiles</span><span class="token punctuation">(</span>newFileInfoList<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> groupKey <span class="token operator">=</span> entry<span class="token punctuation">.</span><span class="token function">getKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        groupKeyMergedFileInfoMap<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>groupKey<span class="token punctuation">,</span> newFileInfo<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 3. 将文件分组添加到结果列表</span>
    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Meta<span class="token punctuation">.</span>FileConfig<span class="token punctuation">.</span>FileInfo</span><span class="token punctuation">&gt;</span></span> resultList <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>groupKeyMergedFileInfoMap<span class="token punctuation">.</span><span class="token function">values</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 4. 将未分组的文件添加到结果列表</span>
    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Meta<span class="token punctuation">.</span>FileConfig<span class="token punctuation">.</span>FileInfo</span><span class="token punctuation">&gt;</span></span> noGroupFileInfoList <span class="token operator">=</span> fileInfoList<span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>fileInfo <span class="token operator">-&gt;</span> <span class="token class-name">StrUtil</span><span class="token punctuation">.</span><span class="token function">isBlank</span><span class="token punctuation">(</span>fileInfo<span class="token punctuation">.</span><span class="token function">getGroupKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span><span class="token class-name">Collectors</span><span class="token punctuation">.</span><span class="token function">toList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    resultList<span class="token punctuation">.</span><span class="token function">addAll</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>noGroupFileInfoList<span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span>
                    <span class="token class-name">Collectors</span><span class="token punctuation">.</span><span class="token function">toMap</span><span class="token punctuation">(</span><span class="token class-name">Meta<span class="token punctuation">.</span>FileConfig<span class="token punctuation">.</span>FileInfo</span><span class="token operator">::</span><span class="token function">getInputPath</span><span class="token punctuation">,</span> o <span class="token operator">-&gt;</span> o<span class="token punctuation">,</span> <span class="token punctuation">(</span>e<span class="token punctuation">,</span> r<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> r<span class="token punctuation">)</span>
            <span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">values</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> resultList<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br></div></div><p>4）测试验证</p> <p>修改 main 方法中的 <code>inputFilePath2</code>，指定一个新的目录：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token class-name">String</span> inputFilePath2 <span class="token operator">=</span> <span class="token string">&quot;src/main/java/com/yupi/springbootinit/constant&quot;</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>基于之前制作好的模板再次执行，发现第 2 次新增的文件合并到了之前的分组配置中，符合预期：8J8aZQ9pRnWasqusHGea5EeJjD5lqENi9OUTo+mr6wM=</p> <p><img alt="image.png" data-src="https://img.xiaoying.org.cn/img/202502181315173.png" loading="lazy" class="lazy"></p> <p>你还可以试着修改分组的名称、条件等配置，新的配置会覆盖之前的配置。</p> <h4 id="完整代码-4"><a href="#完整代码-4" class="header-anchor">#</a> 完整代码</h4> <p><code>TemplateMaker</code> 的完整代码如下：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>yupi<span class="token punctuation">.</span>maker<span class="token punctuation">.</span>template</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">cn<span class="token punctuation">.</span>hutool<span class="token punctuation">.</span>core<span class="token punctuation">.</span>bean<span class="token punctuation">.</span></span><span class="token class-name">BeanUtil</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">cn<span class="token punctuation">.</span>hutool<span class="token punctuation">.</span>core<span class="token punctuation">.</span>bean<span class="token punctuation">.</span>copier<span class="token punctuation">.</span></span><span class="token class-name">CopyOptions</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">cn<span class="token punctuation">.</span>hutool<span class="token punctuation">.</span>core<span class="token punctuation">.</span>collection<span class="token punctuation">.</span></span><span class="token class-name">CollUtil</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">cn<span class="token punctuation">.</span>hutool<span class="token punctuation">.</span>core<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">FileUtil</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">cn<span class="token punctuation">.</span>hutool<span class="token punctuation">.</span>core<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">IdUtil</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">cn<span class="token punctuation">.</span>hutool<span class="token punctuation">.</span>core<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">StrUtil</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">cn<span class="token punctuation">.</span>hutool<span class="token punctuation">.</span>json<span class="token punctuation">.</span></span><span class="token class-name">JSONUtil</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>yupi<span class="token punctuation">.</span>maker<span class="token punctuation">.</span>meta<span class="token punctuation">.</span></span><span class="token class-name">Meta</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>yupi<span class="token punctuation">.</span>maker<span class="token punctuation">.</span>meta<span class="token punctuation">.</span>enums<span class="token punctuation">.</span></span><span class="token class-name">FileGenerateTypeEnum</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>yupi<span class="token punctuation">.</span>maker<span class="token punctuation">.</span>meta<span class="token punctuation">.</span>enums<span class="token punctuation">.</span></span><span class="token class-name">FileTypeEnum</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>yupi<span class="token punctuation">.</span>maker<span class="token punctuation">.</span>template<span class="token punctuation">.</span>enums<span class="token punctuation">.</span></span><span class="token class-name">FileFilterRangeEnum</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>yupi<span class="token punctuation">.</span>maker<span class="token punctuation">.</span>template<span class="token punctuation">.</span>enums<span class="token punctuation">.</span></span><span class="token class-name">FileFilterRuleEnum</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>yupi<span class="token punctuation">.</span>maker<span class="token punctuation">.</span>template<span class="token punctuation">.</span>model<span class="token punctuation">.</span></span><span class="token class-name">FileFilterConfig</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>yupi<span class="token punctuation">.</span>maker<span class="token punctuation">.</span>template<span class="token punctuation">.</span>model<span class="token punctuation">.</span></span><span class="token class-name">TemplateMakerFileConfig</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">File</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>nio<span class="token punctuation">.</span>file<span class="token punctuation">.</span></span><span class="token class-name">Paths</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token operator">*</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>stream<span class="token punctuation">.</span></span><span class="token class-name">Collectors</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TemplateMaker</span> <span class="token punctuation">{</span>

    <span class="token comment">/**
     * 制作模板
     *
     * @param newMeta
     * @param originProjectPath
     * @param templateMakerFileConfig
     * @param modelInfo
     * @param searchStr
     * @param id
     * @return
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">long</span> <span class="token function">makeTemplate</span><span class="token punctuation">(</span><span class="token class-name">Meta</span> newMeta<span class="token punctuation">,</span> <span class="token class-name">String</span> originProjectPath<span class="token punctuation">,</span> <span class="token class-name">TemplateMakerFileConfig</span> templateMakerFileConfig<span class="token punctuation">,</span> <span class="token class-name">Meta<span class="token punctuation">.</span>ModelConfig<span class="token punctuation">.</span>ModelInfo</span> modelInfo<span class="token punctuation">,</span> <span class="token class-name">String</span> searchStr<span class="token punctuation">,</span> <span class="token class-name">Long</span> id<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 没有 id 则生成</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>id <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            id <span class="token operator">=</span> <span class="token class-name">IdUtil</span><span class="token punctuation">.</span><span class="token function">getSnowflakeNextId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token comment">// 复制目录</span>
        <span class="token class-name">String</span> projectPath <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">getProperty</span><span class="token punctuation">(</span><span class="token string">&quot;user.dir&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> tempDirPath <span class="token operator">=</span> projectPath <span class="token operator">+</span> <span class="token class-name">File</span><span class="token punctuation">.</span>separator <span class="token operator">+</span> <span class="token string">&quot;.temp&quot;</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> templatePath <span class="token operator">=</span> tempDirPath <span class="token operator">+</span> <span class="token class-name">File</span><span class="token punctuation">.</span>separator <span class="token operator">+</span> id<span class="token punctuation">;</span>

        <span class="token comment">// 是否为首次制作模板</span>
        <span class="token comment">// 目录不存在，则是首次制作</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token class-name">FileUtil</span><span class="token punctuation">.</span><span class="token function">exist</span><span class="token punctuation">(</span>templatePath<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">FileUtil</span><span class="token punctuation">.</span><span class="token function">mkdir</span><span class="token punctuation">(</span>templatePath<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">FileUtil</span><span class="token punctuation">.</span><span class="token function">copy</span><span class="token punctuation">(</span>originProjectPath<span class="token punctuation">,</span> templatePath<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token comment">// 一、输入信息</span>
        <span class="token comment">// 输入文件信息</span>
        <span class="token class-name">String</span> sourceRootPath <span class="token operator">=</span> templatePath <span class="token operator">+</span> <span class="token class-name">File</span><span class="token punctuation">.</span>separator <span class="token operator">+</span> <span class="token class-name">FileUtil</span><span class="token punctuation">.</span><span class="token function">getLastPathEle</span><span class="token punctuation">(</span><span class="token class-name">Paths</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>originProjectPath<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 注意 win 系统需要对路径进行转义</span>
    	sourceRootPath <span class="token operator">=</span> sourceRootPath<span class="token punctuation">.</span><span class="token function">replaceAll</span><span class="token punctuation">(</span><span class="token string">&quot;\\\\&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;/&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">TemplateMakerFileConfig<span class="token punctuation">.</span>FileInfoConfig</span><span class="token punctuation">&gt;</span></span> fileConfigInfoList <span class="token operator">=</span> templateMakerFileConfig<span class="token punctuation">.</span><span class="token function">getFiles</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 二、生成文件模板</span>
        <span class="token comment">// 遍历输入文件</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Meta<span class="token punctuation">.</span>FileConfig<span class="token punctuation">.</span>FileInfo</span><span class="token punctuation">&gt;</span></span> newFileInfoList <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">TemplateMakerFileConfig<span class="token punctuation">.</span>FileInfoConfig</span> fileInfoConfig <span class="token operator">:</span> fileConfigInfoList<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">String</span> inputFilePath <span class="token operator">=</span> fileInfoConfig<span class="token punctuation">.</span><span class="token function">getPath</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment">// 如果填的是相对路径，要改为绝对路径</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>inputFilePath<span class="token punctuation">.</span><span class="token function">startsWith</span><span class="token punctuation">(</span>sourceRootPath<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                inputFilePath <span class="token operator">=</span> sourceRootPath <span class="token operator">+</span> <span class="token class-name">File</span><span class="token punctuation">.</span>separator <span class="token operator">+</span> inputFilePath<span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            <span class="token comment">// 获取过滤后的文件列表（不会存在目录）</span>
            <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">File</span><span class="token punctuation">&gt;</span></span> fileList <span class="token operator">=</span> <span class="token class-name">FileFilter</span><span class="token punctuation">.</span><span class="token function">doFilter</span><span class="token punctuation">(</span>inputFilePath<span class="token punctuation">,</span> fileInfoConfig<span class="token punctuation">.</span><span class="token function">getFilterConfigList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">File</span> file <span class="token operator">:</span> fileList<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token class-name">Meta<span class="token punctuation">.</span>FileConfig<span class="token punctuation">.</span>FileInfo</span> fileInfo <span class="token operator">=</span> <span class="token function">makeFileTemplate</span><span class="token punctuation">(</span>modelInfo<span class="token punctuation">,</span> searchStr<span class="token punctuation">,</span> sourceRootPath<span class="token punctuation">,</span> file<span class="token punctuation">)</span><span class="token punctuation">;</span>
                newFileInfoList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>fileInfo<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>

        <span class="token comment">// 如果是文件组</span>
        <span class="token class-name">TemplateMakerFileConfig<span class="token punctuation">.</span>FileGroupConfig</span> fileGroupConfig <span class="token operator">=</span> templateMakerFileConfig<span class="token punctuation">.</span><span class="token function">getFileGroupConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>fileGroupConfig <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">String</span> condition <span class="token operator">=</span> fileGroupConfig<span class="token punctuation">.</span><span class="token function">getCondition</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">String</span> groupKey <span class="token operator">=</span> fileGroupConfig<span class="token punctuation">.</span><span class="token function">getGroupKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">String</span> groupName <span class="token operator">=</span> fileGroupConfig<span class="token punctuation">.</span><span class="token function">getGroupName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment">// 新增分组配置</span>
            <span class="token class-name">Meta<span class="token punctuation">.</span>FileConfig<span class="token punctuation">.</span>FileInfo</span> groupFileInfo <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Meta<span class="token punctuation">.</span>FileConfig<span class="token punctuation">.</span>FileInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            groupFileInfo<span class="token punctuation">.</span><span class="token function">setType</span><span class="token punctuation">(</span><span class="token class-name">FileTypeEnum</span><span class="token punctuation">.</span><span class="token constant">GROUP</span><span class="token punctuation">.</span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            groupFileInfo<span class="token punctuation">.</span><span class="token function">setCondition</span><span class="token punctuation">(</span>condition<span class="token punctuation">)</span><span class="token punctuation">;</span>
            groupFileInfo<span class="token punctuation">.</span><span class="token function">setGroupKey</span><span class="token punctuation">(</span>groupKey<span class="token punctuation">)</span><span class="token punctuation">;</span>
            groupFileInfo<span class="token punctuation">.</span><span class="token function">setGroupName</span><span class="token punctuation">(</span>groupName<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// 文件全放到一个分组内</span>
            groupFileInfo<span class="token punctuation">.</span><span class="token function">setFiles</span><span class="token punctuation">(</span>newFileInfoList<span class="token punctuation">)</span><span class="token punctuation">;</span>
            newFileInfoList <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            newFileInfoList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>groupFileInfo<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token comment">// 三、生成配置文件</span>
        <span class="token class-name">String</span> metaOutputPath <span class="token operator">=</span> sourceRootPath <span class="token operator">+</span> <span class="token class-name">File</span><span class="token punctuation">.</span>separator <span class="token operator">+</span> <span class="token string">&quot;meta.json&quot;</span><span class="token punctuation">;</span>

        <span class="token comment">// 如果已有 meta 文件，说明不是第一次制作，则在 meta 基础上进行修改</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">FileUtil</span><span class="token punctuation">.</span><span class="token function">exist</span><span class="token punctuation">(</span>metaOutputPath<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">Meta</span> oldMeta <span class="token operator">=</span> <span class="token class-name">JSONUtil</span><span class="token punctuation">.</span><span class="token function">toBean</span><span class="token punctuation">(</span><span class="token class-name">FileUtil</span><span class="token punctuation">.</span><span class="token function">readUtf8String</span><span class="token punctuation">(</span>metaOutputPath<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">Meta</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">BeanUtil</span><span class="token punctuation">.</span><span class="token function">copyProperties</span><span class="token punctuation">(</span>newMeta<span class="token punctuation">,</span> oldMeta<span class="token punctuation">,</span> <span class="token class-name">CopyOptions</span><span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ignoreNullValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            newMeta <span class="token operator">=</span> oldMeta<span class="token punctuation">;</span>

            <span class="token comment">// 1. 追加配置参数</span>
            <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Meta<span class="token punctuation">.</span>FileConfig<span class="token punctuation">.</span>FileInfo</span><span class="token punctuation">&gt;</span></span> fileInfoList <span class="token operator">=</span> newMeta<span class="token punctuation">.</span><span class="token function">getFileConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getFiles</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            fileInfoList<span class="token punctuation">.</span><span class="token function">addAll</span><span class="token punctuation">(</span>newFileInfoList<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Meta<span class="token punctuation">.</span>ModelConfig<span class="token punctuation">.</span>ModelInfo</span><span class="token punctuation">&gt;</span></span> modelInfoList <span class="token operator">=</span> newMeta<span class="token punctuation">.</span><span class="token function">getModelConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getModels</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            modelInfoList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>modelInfo<span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment">// 配置去重</span>
            newMeta<span class="token punctuation">.</span><span class="token function">getFileConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setFiles</span><span class="token punctuation">(</span><span class="token function">distinctFiles</span><span class="token punctuation">(</span>fileInfoList<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            newMeta<span class="token punctuation">.</span><span class="token function">getModelConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setModels</span><span class="token punctuation">(</span><span class="token function">distinctModels</span><span class="token punctuation">(</span>modelInfoList<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token comment">// 1. 构造配置参数</span>
            <span class="token class-name">Meta<span class="token punctuation">.</span>FileConfig</span> fileConfig <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Meta<span class="token punctuation">.</span>FileConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            newMeta<span class="token punctuation">.</span><span class="token function">setFileConfig</span><span class="token punctuation">(</span>fileConfig<span class="token punctuation">)</span><span class="token punctuation">;</span>
            fileConfig<span class="token punctuation">.</span><span class="token function">setSourceRootPath</span><span class="token punctuation">(</span>sourceRootPath<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Meta<span class="token punctuation">.</span>FileConfig<span class="token punctuation">.</span>FileInfo</span><span class="token punctuation">&gt;</span></span> fileInfoList <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            fileConfig<span class="token punctuation">.</span><span class="token function">setFiles</span><span class="token punctuation">(</span>fileInfoList<span class="token punctuation">)</span><span class="token punctuation">;</span>
            fileInfoList<span class="token punctuation">.</span><span class="token function">addAll</span><span class="token punctuation">(</span>newFileInfoList<span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token class-name">Meta<span class="token punctuation">.</span>ModelConfig</span> modelConfig <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Meta<span class="token punctuation">.</span>ModelConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            newMeta<span class="token punctuation">.</span><span class="token function">setModelConfig</span><span class="token punctuation">(</span>modelConfig<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Meta<span class="token punctuation">.</span>ModelConfig<span class="token punctuation">.</span>ModelInfo</span><span class="token punctuation">&gt;</span></span> modelInfoList <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            modelConfig<span class="token punctuation">.</span><span class="token function">setModels</span><span class="token punctuation">(</span>modelInfoList<span class="token punctuation">)</span><span class="token punctuation">;</span>
            modelInfoList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>modelInfo<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token comment">// 2. 输出元信息文件</span>
        <span class="token class-name">FileUtil</span><span class="token punctuation">.</span><span class="token function">writeUtf8String</span><span class="token punctuation">(</span><span class="token class-name">JSONUtil</span><span class="token punctuation">.</span><span class="token function">toJsonPrettyStr</span><span class="token punctuation">(</span>newMeta<span class="token punctuation">)</span><span class="token punctuation">,</span> metaOutputPath<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> id<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * 制作文件模板
     *
     * @param modelInfo
     * @param searchStr
     * @param sourceRootPath
     * @param inputFile
     * @return
     */</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">Meta<span class="token punctuation">.</span>FileConfig<span class="token punctuation">.</span>FileInfo</span> <span class="token function">makeFileTemplate</span><span class="token punctuation">(</span><span class="token class-name">Meta<span class="token punctuation">.</span>ModelConfig<span class="token punctuation">.</span>ModelInfo</span> modelInfo<span class="token punctuation">,</span> <span class="token class-name">String</span> searchStr<span class="token punctuation">,</span> <span class="token class-name">String</span> sourceRootPath<span class="token punctuation">,</span> <span class="token class-name">File</span> inputFile<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 要挖坑的文件绝对路径（用于制作模板）</span>
        <span class="token comment">// 注意 win 系统需要对路径进行转义</span>
        <span class="token class-name">String</span> fileInputAbsolutePath <span class="token operator">=</span> inputFile<span class="token punctuation">.</span><span class="token function">getAbsolutePath</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">replaceAll</span><span class="token punctuation">(</span><span class="token string">&quot;\\\\&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;/&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> fileOutputAbsolutePath <span class="token operator">=</span> fileInputAbsolutePath <span class="token operator">+</span> <span class="token string">&quot;.ftl&quot;</span><span class="token punctuation">;</span>
    
        <span class="token comment">// 文件输入输出相对路径（用于生成配置）</span>
        <span class="token class-name">String</span> fileInputPath <span class="token operator">=</span> fileInputAbsolutePath<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span>sourceRootPath <span class="token operator">+</span> <span class="token string">&quot;/&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> fileOutputPath <span class="token operator">=</span> fileInputPath <span class="token operator">+</span> <span class="token string">&quot;.ftl&quot;</span><span class="token punctuation">;</span>

        <span class="token comment">// 使用字符串替换，生成模板文件</span>
        <span class="token class-name">String</span> fileContent<span class="token punctuation">;</span>
        <span class="token comment">// 如果已有模板文件，说明不是第一次制作，则在模板基础上再次挖坑</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">FileUtil</span><span class="token punctuation">.</span><span class="token function">exist</span><span class="token punctuation">(</span>fileOutputAbsolutePath<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            fileContent <span class="token operator">=</span> <span class="token class-name">FileUtil</span><span class="token punctuation">.</span><span class="token function">readUtf8String</span><span class="token punctuation">(</span>fileOutputAbsolutePath<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            fileContent <span class="token operator">=</span> <span class="token class-name">FileUtil</span><span class="token punctuation">.</span><span class="token function">readUtf8String</span><span class="token punctuation">(</span>fileInputAbsolutePath<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token class-name">String</span> replacement <span class="token operator">=</span> <span class="token class-name">String</span><span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token string">&quot;${%s}&quot;</span><span class="token punctuation">,</span> modelInfo<span class="token punctuation">.</span><span class="token function">getFieldName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> newFileContent <span class="token operator">=</span> <span class="token class-name">StrUtil</span><span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span>fileContent<span class="token punctuation">,</span> searchStr<span class="token punctuation">,</span> replacement<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 文件配置信息</span>
        <span class="token class-name">Meta<span class="token punctuation">.</span>FileConfig<span class="token punctuation">.</span>FileInfo</span> fileInfo <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Meta<span class="token punctuation">.</span>FileConfig<span class="token punctuation">.</span>FileInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        fileInfo<span class="token punctuation">.</span><span class="token function">setInputPath</span><span class="token punctuation">(</span>fileInputPath<span class="token punctuation">)</span><span class="token punctuation">;</span>
        fileInfo<span class="token punctuation">.</span><span class="token function">setOutputPath</span><span class="token punctuation">(</span>fileOutputPath<span class="token punctuation">)</span><span class="token punctuation">;</span>
        fileInfo<span class="token punctuation">.</span><span class="token function">setType</span><span class="token punctuation">(</span><span class="token class-name">FileTypeEnum</span><span class="token punctuation">.</span><span class="token constant">FILE</span><span class="token punctuation">.</span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 和原文件一致，没有挖坑，则为静态生成</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>newFileContent<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>fileContent<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// 输出路径 = 输入路径</span>
            fileInfo<span class="token punctuation">.</span><span class="token function">setOutputPath</span><span class="token punctuation">(</span>fileInputPath<span class="token punctuation">)</span><span class="token punctuation">;</span>
            fileInfo<span class="token punctuation">.</span><span class="token function">setGenerateType</span><span class="token punctuation">(</span><span class="token class-name">FileGenerateTypeEnum</span><span class="token punctuation">.</span><span class="token constant">STATIC</span><span class="token punctuation">.</span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token comment">// 生成模板文件</span>
            fileInfo<span class="token punctuation">.</span><span class="token function">setGenerateType</span><span class="token punctuation">(</span><span class="token class-name">FileGenerateTypeEnum</span><span class="token punctuation">.</span><span class="token constant">DYNAMIC</span><span class="token punctuation">.</span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">FileUtil</span><span class="token punctuation">.</span><span class="token function">writeUtf8String</span><span class="token punctuation">(</span>newFileContent<span class="token punctuation">,</span> fileOutputAbsolutePath<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> fileInfo<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Meta</span> meta <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Meta</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        meta<span class="token punctuation">.</span><span class="token function">setName</span><span class="token punctuation">(</span><span class="token string">&quot;acm-template-generator&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        meta<span class="token punctuation">.</span><span class="token function">setDescription</span><span class="token punctuation">(</span><span class="token string">&quot;ACM 示例模板生成器&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">String</span> projectPath <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">getProperty</span><span class="token punctuation">(</span><span class="token string">&quot;user.dir&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> originProjectPath <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span>projectPath<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getParent</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token class-name">File</span><span class="token punctuation">.</span>separator <span class="token operator">+</span> <span class="token string">&quot;yuzi-generator-demo-projects/springboot-init&quot;</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> inputFilePath1 <span class="token operator">=</span> <span class="token string">&quot;src/main/java/com/yupi/springbootinit/common&quot;</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> inputFilePath2 <span class="token operator">=</span> <span class="token string">&quot;src/main/java/com/yupi/springbootinit/constant&quot;</span><span class="token punctuation">;</span>

        <span class="token comment">// 模型参数信息（首次）</span>
<span class="token comment">//        Meta.ModelConfig.ModelInfo modelInfo = new Meta.ModelConfig.ModelInfo();</span>
<span class="token comment">//        modelInfo.setFieldName(&quot;outputText&quot;);</span>
<span class="token comment">//        modelInfo.setType(&quot;String&quot;);</span>
<span class="token comment">//        modelInfo.setDefaultValue(&quot;sum = &quot;);</span>

        <span class="token comment">// 模型参数信息（第二次）</span>
        <span class="token class-name">Meta<span class="token punctuation">.</span>ModelConfig<span class="token punctuation">.</span>ModelInfo</span> modelInfo <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Meta<span class="token punctuation">.</span>ModelConfig<span class="token punctuation">.</span>ModelInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        modelInfo<span class="token punctuation">.</span><span class="token function">setFieldName</span><span class="token punctuation">(</span><span class="token string">&quot;className&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        modelInfo<span class="token punctuation">.</span><span class="token function">setType</span><span class="token punctuation">(</span><span class="token string">&quot;String&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 替换变量（首次）</span>
<span class="token comment">//        String searchStr = &quot;Sum: &quot;;</span>
        <span class="token comment">// 替换变量（第二次）</span>
        <span class="token class-name">String</span> searchStr <span class="token operator">=</span> <span class="token string">&quot;BaseResponse&quot;</span><span class="token punctuation">;</span>

        <span class="token comment">// 文件过滤</span>
        <span class="token class-name">TemplateMakerFileConfig</span> templateMakerFileConfig <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">TemplateMakerFileConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">TemplateMakerFileConfig<span class="token punctuation">.</span>FileInfoConfig</span> fileInfoConfig1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">TemplateMakerFileConfig<span class="token punctuation">.</span>FileInfoConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        fileInfoConfig1<span class="token punctuation">.</span><span class="token function">setPath</span><span class="token punctuation">(</span>inputFilePath1<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">FileFilterConfig</span><span class="token punctuation">&gt;</span></span> fileFilterConfigList <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">FileFilterConfig</span> fileFilterConfig <span class="token operator">=</span> <span class="token class-name">FileFilterConfig</span><span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">range</span><span class="token punctuation">(</span><span class="token class-name">FileFilterRangeEnum</span><span class="token punctuation">.</span><span class="token constant">FILE_NAME</span><span class="token punctuation">.</span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">rule</span><span class="token punctuation">(</span><span class="token class-name">FileFilterRuleEnum</span><span class="token punctuation">.</span><span class="token constant">CONTAINS</span><span class="token punctuation">.</span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">value</span><span class="token punctuation">(</span><span class="token string">&quot;Base&quot;</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        fileFilterConfigList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>fileFilterConfig<span class="token punctuation">)</span><span class="token punctuation">;</span>
        fileInfoConfig1<span class="token punctuation">.</span><span class="token function">setFilterConfigList</span><span class="token punctuation">(</span>fileFilterConfigList<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">TemplateMakerFileConfig<span class="token punctuation">.</span>FileInfoConfig</span> fileInfoConfig2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">TemplateMakerFileConfig<span class="token punctuation">.</span>FileInfoConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        fileInfoConfig2<span class="token punctuation">.</span><span class="token function">setPath</span><span class="token punctuation">(</span>inputFilePath2<span class="token punctuation">)</span><span class="token punctuation">;</span>
        templateMakerFileConfig<span class="token punctuation">.</span><span class="token function">setFiles</span><span class="token punctuation">(</span><span class="token class-name">Arrays</span><span class="token punctuation">.</span><span class="token function">asList</span><span class="token punctuation">(</span>fileInfoConfig1<span class="token punctuation">,</span> fileInfoConfig2<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 分组配置</span>
        <span class="token class-name">TemplateMakerFileConfig<span class="token punctuation">.</span>FileGroupConfig</span> fileGroupConfig <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">TemplateMakerFileConfig<span class="token punctuation">.</span>FileGroupConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        fileGroupConfig<span class="token punctuation">.</span><span class="token function">setCondition</span><span class="token punctuation">(</span><span class="token string">&quot;outputText&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        fileGroupConfig<span class="token punctuation">.</span><span class="token function">setGroupKey</span><span class="token punctuation">(</span><span class="token string">&quot;test&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        fileGroupConfig<span class="token punctuation">.</span><span class="token function">setGroupName</span><span class="token punctuation">(</span><span class="token string">&quot;测试分组&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        templateMakerFileConfig<span class="token punctuation">.</span><span class="token function">setFileGroupConfig</span><span class="token punctuation">(</span>fileGroupConfig<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">long</span> id <span class="token operator">=</span> <span class="token function">makeTemplate</span><span class="token punctuation">(</span>meta<span class="token punctuation">,</span> originProjectPath<span class="token punctuation">,</span> templateMakerFileConfig<span class="token punctuation">,</span> modelInfo<span class="token punctuation">,</span> searchStr<span class="token punctuation">,</span> <span class="token number">1735281524670181376L</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * 模型去重
     *
     * @param modelInfoList
     * @return
     */</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Meta<span class="token punctuation">.</span>ModelConfig<span class="token punctuation">.</span>ModelInfo</span><span class="token punctuation">&gt;</span></span> <span class="token function">distinctModels</span><span class="token punctuation">(</span><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Meta<span class="token punctuation">.</span>ModelConfig<span class="token punctuation">.</span>ModelInfo</span><span class="token punctuation">&gt;</span></span> modelInfoList<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Meta<span class="token punctuation">.</span>ModelConfig<span class="token punctuation">.</span>ModelInfo</span><span class="token punctuation">&gt;</span></span> newModelInfoList <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>modelInfoList<span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span><span class="token class-name">Collectors</span><span class="token punctuation">.</span><span class="token function">toMap</span><span class="token punctuation">(</span><span class="token class-name">Meta<span class="token punctuation">.</span>ModelConfig<span class="token punctuation">.</span>ModelInfo</span><span class="token operator">::</span><span class="token function">getFieldName</span><span class="token punctuation">,</span> o <span class="token operator">-&gt;</span> o<span class="token punctuation">,</span> <span class="token punctuation">(</span>e<span class="token punctuation">,</span> r<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> r<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">values</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> newModelInfoList<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * 文件去重
     *
     * @param fileInfoList
     * @return
     */</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Meta<span class="token punctuation">.</span>FileConfig<span class="token punctuation">.</span>FileInfo</span><span class="token punctuation">&gt;</span></span> <span class="token function">distinctFiles</span><span class="token punctuation">(</span><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Meta<span class="token punctuation">.</span>FileConfig<span class="token punctuation">.</span>FileInfo</span><span class="token punctuation">&gt;</span></span> fileInfoList<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 策略：同分组内文件 merge，不同分组保留</span>

        <span class="token comment">// 1. 有分组的，以组为单位划分</span>
        <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">List</span><span class="token punctuation">&lt;</span><span class="token class-name">Meta<span class="token punctuation">.</span>FileConfig<span class="token punctuation">.</span>FileInfo</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> groupKeyFileInfoListMap <span class="token operator">=</span> fileInfoList
                <span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>fileInfo <span class="token operator">-&gt;</span> <span class="token class-name">StrUtil</span><span class="token punctuation">.</span><span class="token function">isNotBlank</span><span class="token punctuation">(</span>fileInfo<span class="token punctuation">.</span><span class="token function">getGroupKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span>
                        <span class="token class-name">Collectors</span><span class="token punctuation">.</span><span class="token function">groupingBy</span><span class="token punctuation">(</span><span class="token class-name">Meta<span class="token punctuation">.</span>FileConfig<span class="token punctuation">.</span>FileInfo</span><span class="token operator">::</span><span class="token function">getGroupKey</span><span class="token punctuation">)</span>
                <span class="token punctuation">)</span><span class="token punctuation">;</span>


        <span class="token comment">// 2. 同组内的文件配置合并</span>
        <span class="token comment">// 保存每个组对应的合并后的对象 map</span>
        <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Meta<span class="token punctuation">.</span>FileConfig<span class="token punctuation">.</span>FileInfo</span><span class="token punctuation">&gt;</span></span> groupKeyMergedFileInfoMap <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Map<span class="token punctuation">.</span>Entry</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">List</span><span class="token punctuation">&lt;</span><span class="token class-name">Meta<span class="token punctuation">.</span>FileConfig<span class="token punctuation">.</span>FileInfo</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> entry <span class="token operator">:</span> groupKeyFileInfoListMap<span class="token punctuation">.</span><span class="token function">entrySet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Meta<span class="token punctuation">.</span>FileConfig<span class="token punctuation">.</span>FileInfo</span><span class="token punctuation">&gt;</span></span> tempFileInfoList <span class="token operator">=</span> entry<span class="token punctuation">.</span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Meta<span class="token punctuation">.</span>FileConfig<span class="token punctuation">.</span>FileInfo</span><span class="token punctuation">&gt;</span></span> newFileInfoList <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>tempFileInfoList<span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                    <span class="token punctuation">.</span><span class="token function">flatMap</span><span class="token punctuation">(</span>fileInfo <span class="token operator">-&gt;</span> fileInfo<span class="token punctuation">.</span><span class="token function">getFiles</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                    <span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span>
                            <span class="token class-name">Collectors</span><span class="token punctuation">.</span><span class="token function">toMap</span><span class="token punctuation">(</span><span class="token class-name">Meta<span class="token punctuation">.</span>FileConfig<span class="token punctuation">.</span>FileInfo</span><span class="token operator">::</span><span class="token function">getInputPath</span><span class="token punctuation">,</span> o <span class="token operator">-&gt;</span> o<span class="token punctuation">,</span> <span class="token punctuation">(</span>e<span class="token punctuation">,</span> r<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> r<span class="token punctuation">)</span>
                    <span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">values</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment">// 使用新的 group 配置</span>
            <span class="token class-name">Meta<span class="token punctuation">.</span>FileConfig<span class="token punctuation">.</span>FileInfo</span> newFileInfo <span class="token operator">=</span> <span class="token class-name">CollUtil</span><span class="token punctuation">.</span><span class="token function">getLast</span><span class="token punctuation">(</span>tempFileInfoList<span class="token punctuation">)</span><span class="token punctuation">;</span>
            newFileInfo<span class="token punctuation">.</span><span class="token function">setFiles</span><span class="token punctuation">(</span>newFileInfoList<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">String</span> groupKey <span class="token operator">=</span> entry<span class="token punctuation">.</span><span class="token function">getKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            groupKeyMergedFileInfoMap<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>groupKey<span class="token punctuation">,</span> newFileInfo<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token comment">// 3. 将文件分组添加到结果列表</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Meta<span class="token punctuation">.</span>FileConfig<span class="token punctuation">.</span>FileInfo</span><span class="token punctuation">&gt;</span></span> resultList <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>groupKeyMergedFileInfoMap<span class="token punctuation">.</span><span class="token function">values</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 4. 将未分组的文件添加到结果列表</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Meta<span class="token punctuation">.</span>FileConfig<span class="token punctuation">.</span>FileInfo</span><span class="token punctuation">&gt;</span></span> noGroupFileInfoList <span class="token operator">=</span> fileInfoList<span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>fileInfo <span class="token operator">-&gt;</span> <span class="token class-name">StrUtil</span><span class="token punctuation">.</span><span class="token function">isBlank</span><span class="token punctuation">(</span>fileInfo<span class="token punctuation">.</span><span class="token function">getGroupKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span><span class="token class-name">Collectors</span><span class="token punctuation">.</span><span class="token function">toList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        resultList<span class="token punctuation">.</span><span class="token function">addAll</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>noGroupFileInfoList<span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span>
                        <span class="token class-name">Collectors</span><span class="token punctuation">.</span><span class="token function">toMap</span><span class="token punctuation">(</span><span class="token class-name">Meta<span class="token punctuation">.</span>FileConfig<span class="token punctuation">.</span>FileInfo</span><span class="token operator">::</span><span class="token function">getInputPath</span><span class="token punctuation">,</span> o <span class="token operator">-&gt;</span> o<span class="token punctuation">,</span> <span class="token punctuation">(</span>e<span class="token punctuation">,</span> r<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> r<span class="token punctuation">)</span>
                <span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">values</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> resultList<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br><span class="line-number">103</span><br><span class="line-number">104</span><br><span class="line-number">105</span><br><span class="line-number">106</span><br><span class="line-number">107</span><br><span class="line-number">108</span><br><span class="line-number">109</span><br><span class="line-number">110</span><br><span class="line-number">111</span><br><span class="line-number">112</span><br><span class="line-number">113</span><br><span class="line-number">114</span><br><span class="line-number">115</span><br><span class="line-number">116</span><br><span class="line-number">117</span><br><span class="line-number">118</span><br><span class="line-number">119</span><br><span class="line-number">120</span><br><span class="line-number">121</span><br><span class="line-number">122</span><br><span class="line-number">123</span><br><span class="line-number">124</span><br><span class="line-number">125</span><br><span class="line-number">126</span><br><span class="line-number">127</span><br><span class="line-number">128</span><br><span class="line-number">129</span><br><span class="line-number">130</span><br><span class="line-number">131</span><br><span class="line-number">132</span><br><span class="line-number">133</span><br><span class="line-number">134</span><br><span class="line-number">135</span><br><span class="line-number">136</span><br><span class="line-number">137</span><br><span class="line-number">138</span><br><span class="line-number">139</span><br><span class="line-number">140</span><br><span class="line-number">141</span><br><span class="line-number">142</span><br><span class="line-number">143</span><br><span class="line-number">144</span><br><span class="line-number">145</span><br><span class="line-number">146</span><br><span class="line-number">147</span><br><span class="line-number">148</span><br><span class="line-number">149</span><br><span class="line-number">150</span><br><span class="line-number">151</span><br><span class="line-number">152</span><br><span class="line-number">153</span><br><span class="line-number">154</span><br><span class="line-number">155</span><br><span class="line-number">156</span><br><span class="line-number">157</span><br><span class="line-number">158</span><br><span class="line-number">159</span><br><span class="line-number">160</span><br><span class="line-number">161</span><br><span class="line-number">162</span><br><span class="line-number">163</span><br><span class="line-number">164</span><br><span class="line-number">165</span><br><span class="line-number">166</span><br><span class="line-number">167</span><br><span class="line-number">168</span><br><span class="line-number">169</span><br><span class="line-number">170</span><br><span class="line-number">171</span><br><span class="line-number">172</span><br><span class="line-number">173</span><br><span class="line-number">174</span><br><span class="line-number">175</span><br><span class="line-number">176</span><br><span class="line-number">177</span><br><span class="line-number">178</span><br><span class="line-number">179</span><br><span class="line-number">180</span><br><span class="line-number">181</span><br><span class="line-number">182</span><br><span class="line-number">183</span><br><span class="line-number">184</span><br><span class="line-number">185</span><br><span class="line-number">186</span><br><span class="line-number">187</span><br><span class="line-number">188</span><br><span class="line-number">189</span><br><span class="line-number">190</span><br><span class="line-number">191</span><br><span class="line-number">192</span><br><span class="line-number">193</span><br><span class="line-number">194</span><br><span class="line-number">195</span><br><span class="line-number">196</span><br><span class="line-number">197</span><br><span class="line-number">198</span><br><span class="line-number">199</span><br><span class="line-number">200</span><br><span class="line-number">201</span><br><span class="line-number">202</span><br><span class="line-number">203</span><br><span class="line-number">204</span><br><span class="line-number">205</span><br><span class="line-number">206</span><br><span class="line-number">207</span><br><span class="line-number">208</span><br><span class="line-number">209</span><br><span class="line-number">210</span><br><span class="line-number">211</span><br><span class="line-number">212</span><br><span class="line-number">213</span><br><span class="line-number">214</span><br><span class="line-number">215</span><br><span class="line-number">216</span><br><span class="line-number">217</span><br><span class="line-number">218</span><br><span class="line-number">219</span><br><span class="line-number">220</span><br><span class="line-number">221</span><br><span class="line-number">222</span><br><span class="line-number">223</span><br><span class="line-number">224</span><br><span class="line-number">225</span><br><span class="line-number">226</span><br><span class="line-number">227</span><br><span class="line-number">228</span><br><span class="line-number">229</span><br><span class="line-number">230</span><br><span class="line-number">231</span><br><span class="line-number">232</span><br><span class="line-number">233</span><br><span class="line-number">234</span><br><span class="line-number">235</span><br><span class="line-number">236</span><br><span class="line-number">237</span><br><span class="line-number">238</span><br><span class="line-number">239</span><br><span class="line-number">240</span><br><span class="line-number">241</span><br><span class="line-number">242</span><br><span class="line-number">243</span><br><span class="line-number">244</span><br><span class="line-number">245</span><br><span class="line-number">246</span><br><span class="line-number">247</span><br><span class="line-number">248</span><br><span class="line-number">249</span><br><span class="line-number">250</span><br><span class="line-number">251</span><br><span class="line-number">252</span><br><span class="line-number">253</span><br><span class="line-number">254</span><br><span class="line-number">255</span><br><span class="line-number">256</span><br><span class="line-number">257</span><br><span class="line-number">258</span><br><span class="line-number">259</span><br><span class="line-number">260</span><br><span class="line-number">261</span><br><span class="line-number">262</span><br><span class="line-number">263</span><br><span class="line-number">264</span><br><span class="line-number">265</span><br><span class="line-number">266</span><br><span class="line-number">267</span><br><span class="line-number">268</span><br><span class="line-number">269</span><br><span class="line-number">270</span><br><span class="line-number">271</span><br><span class="line-number">272</span><br><span class="line-number">273</span><br><span class="line-number">274</span><br><span class="line-number">275</span><br><span class="line-number">276</span><br><span class="line-number">277</span><br><span class="line-number">278</span><br><span class="line-number">279</span><br><span class="line-number">280</span><br><span class="line-number">281</span><br><span class="line-number">282</span><br><span class="line-number">283</span><br><span class="line-number">284</span><br><span class="line-number">285</span><br><span class="line-number">286</span><br><span class="line-number">287</span><br><span class="line-number">288</span><br><span class="line-number">289</span><br><span class="line-number">290</span><br><span class="line-number">291</span><br><span class="line-number">292</span><br><span class="line-number">293</span><br><span class="line-number">294</span><br><span class="line-number">295</span><br><span class="line-number">296</span><br><span class="line-number">297</span><br><span class="line-number">298</span><br><span class="line-number">299</span><br><span class="line-number">300</span><br></div></div><h3 id="_4、模型分组"><a href="#_4、模型分组" class="header-anchor">#</a> 4、模型分组</h3> <p>和文件分组一样，之前我们的制作工具已经实现了模型分组的能力。那现在我们的模板制作工具也需要能够同时指定多个模型参数进行 “挖坑”，并生成模型分组配置。</p> <h4 id="实现思路-2"><a href="#实现思路-2" class="header-anchor">#</a> 实现思路</h4> <p>模型分组的实现思路和文件分组逻辑几乎一致，此处不再赘述。</p> <p>但有一点需要注意，之前我们在测试模板制作工具时，传入的都是单个模型参数和要替换的字符串参数（searchStr）。但现在如果要一次性输入多个模型参数，也要传入多个要替换的字符串。准确地说，每个模型和要替换的字符串参数应该一一对应。所以我们需要用额外的类来封装这些参数。</p> <h4 id="开发实现-3"><a href="#开发实现-3" class="header-anchor">#</a> 开发实现</h4> <p>1）首先像封装文件配置类（TemplateMakerFileConfig）一样，封装所有模型参数、分组参数为模型配置类 <code>TemplateMakerModelConfig</code>，放到 <code>template.model</code> 目录下。</p> <p>代码如下：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>yupi<span class="token punctuation">.</span>maker<span class="token punctuation">.</span>template<span class="token punctuation">.</span>model</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">lombok<span class="token punctuation">.</span></span><span class="token class-name">Data</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">lombok<span class="token punctuation">.</span></span><span class="token class-name">NoArgsConstructor</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">List</span></span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@Data</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TemplateMakerModelConfig</span> <span class="token punctuation">{</span>

    <span class="token keyword">private</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ModelInfoConfig</span><span class="token punctuation">&gt;</span></span> models<span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token class-name">ModelGroupConfig</span> modelGroupConfig<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@NoArgsConstructor</span>
    <span class="token annotation punctuation">@Data</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">ModelInfoConfig</span> <span class="token punctuation">{</span>

        <span class="token keyword">private</span> <span class="token class-name">String</span> fieldName<span class="token punctuation">;</span>

        <span class="token keyword">private</span> <span class="token class-name">String</span> type<span class="token punctuation">;</span>

        <span class="token keyword">private</span> <span class="token class-name">String</span> description<span class="token punctuation">;</span>

        <span class="token keyword">private</span> <span class="token class-name">Object</span> defaultValue<span class="token punctuation">;</span>

        <span class="token keyword">private</span> <span class="token class-name">String</span> abbr<span class="token punctuation">;</span>

        <span class="token comment">// 用于替换哪些文本</span>
        <span class="token keyword">private</span> <span class="token class-name">String</span> replaceText<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Data</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">ModelGroupConfig</span> <span class="token punctuation">{</span>

        <span class="token keyword">private</span> <span class="token class-name">String</span> condition<span class="token punctuation">;</span>

        <span class="token keyword">private</span> <span class="token class-name">String</span> groupKey<span class="token punctuation">;</span>

        <span class="token keyword">private</span> <span class="token class-name">String</span> groupName<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br></div></div><p>2）修改模型去重方法，和文件去重逻辑一致，实现同组模型信息的去重合并。</p> <p>模型去重方法的代码如下：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">/**
 * 模型去重
 *
 * @param modelInfoList
 * @return
 */</span>
<span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Meta<span class="token punctuation">.</span>ModelConfig<span class="token punctuation">.</span>ModelInfo</span><span class="token punctuation">&gt;</span></span> <span class="token function">distinctModels</span><span class="token punctuation">(</span><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Meta<span class="token punctuation">.</span>ModelConfig<span class="token punctuation">.</span>ModelInfo</span><span class="token punctuation">&gt;</span></span> modelInfoList<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 策略：同分组内模型 merge，不同分组保留</span>

    <span class="token comment">// 1. 有分组的，以组为单位划分</span>
    <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">List</span><span class="token punctuation">&lt;</span><span class="token class-name">Meta<span class="token punctuation">.</span>ModelConfig<span class="token punctuation">.</span>ModelInfo</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> groupKeyModelInfoListMap <span class="token operator">=</span> modelInfoList
            <span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>modelInfo <span class="token operator">-&gt;</span> <span class="token class-name">StrUtil</span><span class="token punctuation">.</span><span class="token function">isNotBlank</span><span class="token punctuation">(</span>modelInfo<span class="token punctuation">.</span><span class="token function">getGroupKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span>
                    <span class="token class-name">Collectors</span><span class="token punctuation">.</span><span class="token function">groupingBy</span><span class="token punctuation">(</span><span class="token class-name">Meta<span class="token punctuation">.</span>ModelConfig<span class="token punctuation">.</span>ModelInfo</span><span class="token operator">::</span><span class="token function">getGroupKey</span><span class="token punctuation">)</span>
            <span class="token punctuation">)</span><span class="token punctuation">;</span>


    <span class="token comment">// 2. 同组内的模型配置合并</span>
    <span class="token comment">// 保存每个组对应的合并后的对象 map</span>
    <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Meta<span class="token punctuation">.</span>ModelConfig<span class="token punctuation">.</span>ModelInfo</span><span class="token punctuation">&gt;</span></span> groupKeyMergedModelInfoMap <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Map<span class="token punctuation">.</span>Entry</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">List</span><span class="token punctuation">&lt;</span><span class="token class-name">Meta<span class="token punctuation">.</span>ModelConfig<span class="token punctuation">.</span>ModelInfo</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> entry <span class="token operator">:</span> groupKeyModelInfoListMap<span class="token punctuation">.</span><span class="token function">entrySet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Meta<span class="token punctuation">.</span>ModelConfig<span class="token punctuation">.</span>ModelInfo</span><span class="token punctuation">&gt;</span></span> tempModelInfoList <span class="token operator">=</span> entry<span class="token punctuation">.</span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Meta<span class="token punctuation">.</span>ModelConfig<span class="token punctuation">.</span>ModelInfo</span><span class="token punctuation">&gt;</span></span> newModelInfoList <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>tempModelInfoList<span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">flatMap</span><span class="token punctuation">(</span>modelInfo <span class="token operator">-&gt;</span> modelInfo<span class="token punctuation">.</span><span class="token function">getModels</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span>
                        <span class="token class-name">Collectors</span><span class="token punctuation">.</span><span class="token function">toMap</span><span class="token punctuation">(</span><span class="token class-name">Meta<span class="token punctuation">.</span>ModelConfig<span class="token punctuation">.</span>ModelInfo</span><span class="token operator">::</span><span class="token function">getFieldName</span><span class="token punctuation">,</span> o <span class="token operator">-&gt;</span> o<span class="token punctuation">,</span> <span class="token punctuation">(</span>e<span class="token punctuation">,</span> r<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> r<span class="token punctuation">)</span>
                <span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">values</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 使用新的 group 配置</span>
        <span class="token class-name">Meta<span class="token punctuation">.</span>ModelConfig<span class="token punctuation">.</span>ModelInfo</span> newModelInfo <span class="token operator">=</span> <span class="token class-name">CollUtil</span><span class="token punctuation">.</span><span class="token function">getLast</span><span class="token punctuation">(</span>tempModelInfoList<span class="token punctuation">)</span><span class="token punctuation">;</span>
        newModelInfo<span class="token punctuation">.</span><span class="token function">setModels</span><span class="token punctuation">(</span>newModelInfoList<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> groupKey <span class="token operator">=</span> entry<span class="token punctuation">.</span><span class="token function">getKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        groupKeyMergedModelInfoMap<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>groupKey<span class="token punctuation">,</span> newModelInfo<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 3. 将模型分组添加到结果列表</span>
    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Meta<span class="token punctuation">.</span>ModelConfig<span class="token punctuation">.</span>ModelInfo</span><span class="token punctuation">&gt;</span></span> resultList <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>groupKeyMergedModelInfoMap<span class="token punctuation">.</span><span class="token function">values</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 4. 将未分组的模型添加到结果列表</span>
    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Meta<span class="token punctuation">.</span>ModelConfig<span class="token punctuation">.</span>ModelInfo</span><span class="token punctuation">&gt;</span></span> noGroupModelInfoList <span class="token operator">=</span> modelInfoList<span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>modelInfo <span class="token operator">-&gt;</span> <span class="token class-name">StrUtil</span><span class="token punctuation">.</span><span class="token function">isBlank</span><span class="token punctuation">(</span>modelInfo<span class="token punctuation">.</span><span class="token function">getGroupKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span><span class="token class-name">Collectors</span><span class="token punctuation">.</span><span class="token function">toList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    resultList<span class="token punctuation">.</span><span class="token function">addAll</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>noGroupModelInfoList<span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span>
                    <span class="token class-name">Collectors</span><span class="token punctuation">.</span><span class="token function">toMap</span><span class="token punctuation">(</span><span class="token class-name">Meta<span class="token punctuation">.</span>ModelConfig<span class="token punctuation">.</span>ModelInfo</span><span class="token operator">::</span><span class="token function">getFieldName</span><span class="token punctuation">,</span> o <span class="token operator">-&gt;</span> o<span class="token punctuation">,</span> <span class="token punctuation">(</span>e<span class="token punctuation">,</span> r<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> r<span class="token punctuation">)</span>
            <span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">values</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> resultList<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br></div></div><p>3）修改 <code>makeTemplate</code> 的输入参数，使用封装好的模型配置类 <code>TemplateMakerModelConfig</code> 代替 modelInfo 和 searchStr。8J8aZQ9pRnWasqusHGea5EeJjD5lqENi9OUTo+mr6wM=</p> <p>修改后的方法参数如下：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">long</span> <span class="token function">makeTemplate</span><span class="token punctuation">(</span><span class="token class-name">Meta</span> newMeta<span class="token punctuation">,</span>
                                <span class="token class-name">String</span> originProjectPath<span class="token punctuation">,</span>
                                <span class="token class-name">TemplateMakerFileConfig</span> templateMakerFileConfig<span class="token punctuation">,</span>
                                <span class="token class-name">TemplateMakerModelConfig</span> templateMakerModelConfig<span class="token punctuation">,</span>
                                <span class="token class-name">Long</span> id<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>由于参数修改了，我们也要像从文件配置中读取信息一样，从模型配置中读出分组和模型列表信息，并转换为用于生成元信息配置的 <code>newModelInfoList</code>。</p> <p>代码如下：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// 处理模型信息</span>
<span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">TemplateMakerModelConfig<span class="token punctuation">.</span>ModelInfoConfig</span><span class="token punctuation">&gt;</span></span> models <span class="token operator">=</span> templateMakerModelConfig<span class="token punctuation">.</span><span class="token function">getModels</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// - 转换为配置接受的 ModelInfo 对象</span>
<span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Meta<span class="token punctuation">.</span>ModelConfig<span class="token punctuation">.</span>ModelInfo</span><span class="token punctuation">&gt;</span></span> inputModelInfoList <span class="token operator">=</span> models<span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>modelInfoConfig <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
    <span class="token class-name">Meta<span class="token punctuation">.</span>ModelConfig<span class="token punctuation">.</span>ModelInfo</span> modelInfo <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Meta<span class="token punctuation">.</span>ModelConfig<span class="token punctuation">.</span>ModelInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">BeanUtil</span><span class="token punctuation">.</span><span class="token function">copyProperties</span><span class="token punctuation">(</span>modelInfoConfig<span class="token punctuation">,</span> modelInfo<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> modelInfo<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span><span class="token class-name">Collectors</span><span class="token punctuation">.</span><span class="token function">toList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// - 本次新增的模型配置列表</span>
<span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Meta<span class="token punctuation">.</span>ModelConfig<span class="token punctuation">.</span>ModelInfo</span><span class="token punctuation">&gt;</span></span> newModelInfoList <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// - 如果是模型组</span>
<span class="token class-name">TemplateMakerModelConfig<span class="token punctuation">.</span>ModelGroupConfig</span> modelGroupConfig <span class="token operator">=</span> templateMakerModelConfig<span class="token punctuation">.</span><span class="token function">getModelGroupConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>modelGroupConfig <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">String</span> condition <span class="token operator">=</span> modelGroupConfig<span class="token punctuation">.</span><span class="token function">getCondition</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">String</span> groupKey <span class="token operator">=</span> modelGroupConfig<span class="token punctuation">.</span><span class="token function">getGroupKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">String</span> groupName <span class="token operator">=</span> modelGroupConfig<span class="token punctuation">.</span><span class="token function">getGroupName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Meta<span class="token punctuation">.</span>ModelConfig<span class="token punctuation">.</span>ModelInfo</span> groupModelInfo <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Meta<span class="token punctuation">.</span>ModelConfig<span class="token punctuation">.</span>ModelInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    groupModelInfo<span class="token punctuation">.</span><span class="token function">setGroupKey</span><span class="token punctuation">(</span>groupKey<span class="token punctuation">)</span><span class="token punctuation">;</span>
    groupModelInfo<span class="token punctuation">.</span><span class="token function">setGroupName</span><span class="token punctuation">(</span>groupName<span class="token punctuation">)</span><span class="token punctuation">;</span>
    groupModelInfo<span class="token punctuation">.</span><span class="token function">setCondition</span><span class="token punctuation">(</span>condition<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 模型全放到一个分组内</span>
    groupModelInfo<span class="token punctuation">.</span><span class="token function">setModels</span><span class="token punctuation">(</span>inputModelInfoList<span class="token punctuation">)</span><span class="token punctuation">;</span>
    newModelInfoList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>groupModelInfo<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token comment">// 不分组，添加所有的模型信息到列表</span>
    newModelInfoList<span class="token punctuation">.</span><span class="token function">addAll</span><span class="token punctuation">(</span>inputModelInfoList<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br></div></div><p>之前生成元信息配置，是增加了单个 ModelInfo 对象，现在需要改为增加 <code>newModelInfoList</code> 列表：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// 1. 追加配置参数</span>
<span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Meta<span class="token punctuation">.</span>FileConfig<span class="token punctuation">.</span>FileInfo</span><span class="token punctuation">&gt;</span></span> fileInfoList <span class="token operator">=</span> newMeta<span class="token punctuation">.</span><span class="token function">getFileConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getFiles</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
fileInfoList<span class="token punctuation">.</span><span class="token function">addAll</span><span class="token punctuation">(</span>newFileInfoList<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Meta<span class="token punctuation">.</span>ModelConfig<span class="token punctuation">.</span>ModelInfo</span><span class="token punctuation">&gt;</span></span> modelInfoList <span class="token operator">=</span> newMeta<span class="token punctuation">.</span><span class="token function">getModelConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getModels</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
modelInfoList<span class="token punctuation">.</span><span class="token function">addAll</span><span class="token punctuation">(</span>newModelInfoList<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>4）修改 <code>makeFileTemplate</code> 方法，要能够支持使用多个模型参数对文件 “挖坑”。</p> <p>实现思路是依次遍历模型参数，对文件内容进行替换，将上一轮替换后的结果作为新一轮要替换的内容，从而实现多轮替换。</p> <p>先调整方法的输入参数，以及调用该方法时传入的参数：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">Meta<span class="token punctuation">.</span>FileConfig<span class="token punctuation">.</span>FileInfo</span> <span class="token function">makeFileTemplate</span><span class="token punctuation">(</span>
    <span class="token class-name">TemplateMakerModelConfig</span> templateMakerModelConfig<span class="token punctuation">,</span>
    <span class="token class-name">String</span> sourceRootPath<span class="token punctuation">,</span>
    <span class="token class-name">File</span> inputFile<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>然后实现多轮替换逻辑，修改的关键代码如下：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// 支持多个模型：对同一个文件的内容，遍历模型进行多轮替换</span>
<span class="token class-name">TemplateMakerModelConfig<span class="token punctuation">.</span>ModelGroupConfig</span> modelGroupConfig <span class="token operator">=</span> templateMakerModelConfig<span class="token punctuation">.</span><span class="token function">getModelGroupConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">String</span> newFileContent <span class="token operator">=</span> fileContent<span class="token punctuation">;</span>
<span class="token class-name">String</span> replacement<span class="token punctuation">;</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">TemplateMakerModelConfig<span class="token punctuation">.</span>ModelInfoConfig</span> modelInfoConfig <span class="token operator">:</span> templateMakerModelConfig<span class="token punctuation">.</span><span class="token function">getModels</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 不是分组</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>modelGroupConfig <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        replacement <span class="token operator">=</span> <span class="token class-name">String</span><span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token string">&quot;${%s}&quot;</span><span class="token punctuation">,</span> modelInfoConfig<span class="token punctuation">.</span><span class="token function">getFieldName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token comment">// 是分组</span>
        <span class="token class-name">String</span> groupKey <span class="token operator">=</span> modelGroupConfig<span class="token punctuation">.</span><span class="token function">getGroupKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 注意挖坑要多一个层级</span>
        replacement <span class="token operator">=</span> <span class="token class-name">String</span><span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token string">&quot;${%s.%s}&quot;</span><span class="token punctuation">,</span> groupKey<span class="token punctuation">,</span> modelInfoConfig<span class="token punctuation">.</span><span class="token function">getFieldName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// 多次替换</span>
    newFileContent <span class="token operator">=</span> <span class="token class-name">StrUtil</span><span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span>newFileContent<span class="token punctuation">,</span> modelInfoConfig<span class="token punctuation">.</span><span class="token function">getReplaceText</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> replacement<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><p>5）测试验证，定义一组能够替换 MySQL 配置的模型组参数，用来替换 <code>application.yml</code> 配置文件。</p> <p>代码如下：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token class-name">String</span> inputFilePath2 <span class="token operator">=</span> <span class="token string">&quot;src/main/resources/application.yml&quot;</span><span class="token punctuation">;</span>

<span class="token comment">// 模型参数配置</span>
<span class="token class-name">TemplateMakerModelConfig</span> templateMakerModelConfig <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">TemplateMakerModelConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// - 模型组配置</span>
<span class="token class-name">TemplateMakerModelConfig<span class="token punctuation">.</span>ModelGroupConfig</span> modelGroupConfig <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">TemplateMakerModelConfig<span class="token punctuation">.</span>ModelGroupConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
modelGroupConfig<span class="token punctuation">.</span><span class="token function">setGroupKey</span><span class="token punctuation">(</span><span class="token string">&quot;mysql&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
modelGroupConfig<span class="token punctuation">.</span><span class="token function">setGroupName</span><span class="token punctuation">(</span><span class="token string">&quot;数据库配置&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
templateMakerModelConfig<span class="token punctuation">.</span><span class="token function">setModelGroupConfig</span><span class="token punctuation">(</span>modelGroupConfig<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// - 模型配置</span>
<span class="token class-name">TemplateMakerModelConfig<span class="token punctuation">.</span>ModelInfoConfig</span> modelInfoConfig1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">TemplateMakerModelConfig<span class="token punctuation">.</span>ModelInfoConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
modelInfoConfig1<span class="token punctuation">.</span><span class="token function">setFieldName</span><span class="token punctuation">(</span><span class="token string">&quot;url&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
modelInfoConfig1<span class="token punctuation">.</span><span class="token function">setType</span><span class="token punctuation">(</span><span class="token string">&quot;String&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
modelInfoConfig1<span class="token punctuation">.</span><span class="token function">setDefaultValue</span><span class="token punctuation">(</span><span class="token string">&quot;jdbc:mysql://localhost:3306/my_db&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
modelInfoConfig1<span class="token punctuation">.</span><span class="token function">setReplaceText</span><span class="token punctuation">(</span><span class="token string">&quot;jdbc:mysql://localhost:3306/my_db&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token class-name">TemplateMakerModelConfig<span class="token punctuation">.</span>ModelInfoConfig</span> modelInfoConfig2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">TemplateMakerModelConfig<span class="token punctuation">.</span>ModelInfoConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
modelInfoConfig2<span class="token punctuation">.</span><span class="token function">setFieldName</span><span class="token punctuation">(</span><span class="token string">&quot;username&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
modelInfoConfig2<span class="token punctuation">.</span><span class="token function">setType</span><span class="token punctuation">(</span><span class="token string">&quot;String&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
modelInfoConfig2<span class="token punctuation">.</span><span class="token function">setDefaultValue</span><span class="token punctuation">(</span><span class="token string">&quot;root&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
modelInfoConfig2<span class="token punctuation">.</span><span class="token function">setReplaceText</span><span class="token punctuation">(</span><span class="token string">&quot;root&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">TemplateMakerModelConfig<span class="token punctuation">.</span>ModelInfoConfig</span><span class="token punctuation">&gt;</span></span> modelInfoConfigList <span class="token operator">=</span> <span class="token class-name">Arrays</span><span class="token punctuation">.</span><span class="token function">asList</span><span class="token punctuation">(</span>modelInfoConfig1<span class="token punctuation">,</span> modelInfoConfig2<span class="token punctuation">)</span><span class="token punctuation">;</span>
templateMakerModelConfig<span class="token punctuation">.</span><span class="token function">setModels</span><span class="token punctuation">(</span>modelInfoConfigList<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br></div></div><p>执行，成功制作出了有多个参数的模板文件：</p> <p><img alt="image.png" data-src="https://img.xiaoying.org.cn/img/202502181317210.png" loading="lazy" class="lazy"></p> <p>也成功生成了元信息文件：</p> <p><img alt="image.png" data-src="https://img.xiaoying.org.cn/img/202502181322080.png" loading="lazy" class="lazy"></p> <p>可以尝试更换模型参数组的 groupKey 或模型的 fieldName，测试能够正常追加模型配置。</p> <p>至此，模型分组能力开发完成。</p> <h4 id="完整代码-5"><a href="#完整代码-5" class="header-anchor">#</a> 完整代码</h4> <p><code>TemplateMaker</code> 的完整代码如下：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>yupi<span class="token punctuation">.</span>maker<span class="token punctuation">.</span>template</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">cn<span class="token punctuation">.</span>hutool<span class="token punctuation">.</span>core<span class="token punctuation">.</span>bean<span class="token punctuation">.</span></span><span class="token class-name">BeanUtil</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">cn<span class="token punctuation">.</span>hutool<span class="token punctuation">.</span>core<span class="token punctuation">.</span>bean<span class="token punctuation">.</span>copier<span class="token punctuation">.</span></span><span class="token class-name">CopyOptions</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">cn<span class="token punctuation">.</span>hutool<span class="token punctuation">.</span>core<span class="token punctuation">.</span>collection<span class="token punctuation">.</span></span><span class="token class-name">CollUtil</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">cn<span class="token punctuation">.</span>hutool<span class="token punctuation">.</span>core<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">FileUtil</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">cn<span class="token punctuation">.</span>hutool<span class="token punctuation">.</span>core<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">IdUtil</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">cn<span class="token punctuation">.</span>hutool<span class="token punctuation">.</span>core<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">StrUtil</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">cn<span class="token punctuation">.</span>hutool<span class="token punctuation">.</span>json<span class="token punctuation">.</span></span><span class="token class-name">JSONUtil</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>yupi<span class="token punctuation">.</span>maker<span class="token punctuation">.</span>meta<span class="token punctuation">.</span></span><span class="token class-name">Meta</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>yupi<span class="token punctuation">.</span>maker<span class="token punctuation">.</span>meta<span class="token punctuation">.</span>enums<span class="token punctuation">.</span></span><span class="token class-name">FileGenerateTypeEnum</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>yupi<span class="token punctuation">.</span>maker<span class="token punctuation">.</span>meta<span class="token punctuation">.</span>enums<span class="token punctuation">.</span></span><span class="token class-name">FileTypeEnum</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>yupi<span class="token punctuation">.</span>maker<span class="token punctuation">.</span>template<span class="token punctuation">.</span>enums<span class="token punctuation">.</span></span><span class="token class-name">FileFilterRangeEnum</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>yupi<span class="token punctuation">.</span>maker<span class="token punctuation">.</span>template<span class="token punctuation">.</span>enums<span class="token punctuation">.</span></span><span class="token class-name">FileFilterRuleEnum</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>yupi<span class="token punctuation">.</span>maker<span class="token punctuation">.</span>template<span class="token punctuation">.</span>model<span class="token punctuation">.</span></span><span class="token class-name">FileFilterConfig</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>yupi<span class="token punctuation">.</span>maker<span class="token punctuation">.</span>template<span class="token punctuation">.</span>model<span class="token punctuation">.</span></span><span class="token class-name">TemplateMakerFileConfig</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>yupi<span class="token punctuation">.</span>maker<span class="token punctuation">.</span>template<span class="token punctuation">.</span>model<span class="token punctuation">.</span></span><span class="token class-name">TemplateMakerModelConfig</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">File</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>nio<span class="token punctuation">.</span>file<span class="token punctuation">.</span></span><span class="token class-name">Paths</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token operator">*</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>stream<span class="token punctuation">.</span></span><span class="token class-name">Collectors</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TemplateMaker</span> <span class="token punctuation">{</span>

    <span class="token comment">/**
     * 制作模板
     *
     * @param newMeta
     * @param originProjectPath
     * @param templateMakerFileConfig
     * @param templateMakerModelConfig
     * @param id
     * @return
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">long</span> <span class="token function">makeTemplate</span><span class="token punctuation">(</span><span class="token class-name">Meta</span> newMeta<span class="token punctuation">,</span> <span class="token class-name">String</span> originProjectPath<span class="token punctuation">,</span> <span class="token class-name">TemplateMakerFileConfig</span> templateMakerFileConfig<span class="token punctuation">,</span> <span class="token class-name">TemplateMakerModelConfig</span> templateMakerModelConfig<span class="token punctuation">,</span> <span class="token class-name">Long</span> id<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 没有 id 则生成</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>id <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            id <span class="token operator">=</span> <span class="token class-name">IdUtil</span><span class="token punctuation">.</span><span class="token function">getSnowflakeNextId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token comment">// 复制目录</span>
        <span class="token class-name">String</span> projectPath <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">getProperty</span><span class="token punctuation">(</span><span class="token string">&quot;user.dir&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> tempDirPath <span class="token operator">=</span> projectPath <span class="token operator">+</span> <span class="token class-name">File</span><span class="token punctuation">.</span>separator <span class="token operator">+</span> <span class="token string">&quot;.temp&quot;</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> templatePath <span class="token operator">=</span> tempDirPath <span class="token operator">+</span> <span class="token class-name">File</span><span class="token punctuation">.</span>separator <span class="token operator">+</span> id<span class="token punctuation">;</span>

        <span class="token comment">// 是否为首次制作模板</span>
        <span class="token comment">// 目录不存在，则是首次制作</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token class-name">FileUtil</span><span class="token punctuation">.</span><span class="token function">exist</span><span class="token punctuation">(</span>templatePath<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">FileUtil</span><span class="token punctuation">.</span><span class="token function">mkdir</span><span class="token punctuation">(</span>templatePath<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">FileUtil</span><span class="token punctuation">.</span><span class="token function">copy</span><span class="token punctuation">(</span>originProjectPath<span class="token punctuation">,</span> templatePath<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token comment">// 一、输入信息</span>
        <span class="token comment">// 输入文件信息</span>
        <span class="token class-name">String</span> sourceRootPath <span class="token operator">=</span> templatePath <span class="token operator">+</span> <span class="token class-name">File</span><span class="token punctuation">.</span>separator <span class="token operator">+</span> <span class="token class-name">FileUtil</span><span class="token punctuation">.</span><span class="token function">getLastPathEle</span><span class="token punctuation">(</span><span class="token class-name">Paths</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>originProjectPath<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 注意 win 系统需要对路径进行转义</span>
    	sourceRootPath <span class="token operator">=</span> sourceRootPath<span class="token punctuation">.</span><span class="token function">replaceAll</span><span class="token punctuation">(</span><span class="token string">&quot;\\\\&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;/&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">TemplateMakerFileConfig<span class="token punctuation">.</span>FileInfoConfig</span><span class="token punctuation">&gt;</span></span> fileConfigInfoList <span class="token operator">=</span> templateMakerFileConfig<span class="token punctuation">.</span><span class="token function">getFiles</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 二、生成文件模板</span>
        <span class="token comment">// 遍历输入文件</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Meta<span class="token punctuation">.</span>FileConfig<span class="token punctuation">.</span>FileInfo</span><span class="token punctuation">&gt;</span></span> newFileInfoList <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">TemplateMakerFileConfig<span class="token punctuation">.</span>FileInfoConfig</span> fileInfoConfig <span class="token operator">:</span> fileConfigInfoList<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">String</span> inputFilePath <span class="token operator">=</span> fileInfoConfig<span class="token punctuation">.</span><span class="token function">getPath</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment">// 如果填的是相对路径，要改为绝对路径</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>inputFilePath<span class="token punctuation">.</span><span class="token function">startsWith</span><span class="token punctuation">(</span>sourceRootPath<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                inputFilePath <span class="token operator">=</span> sourceRootPath <span class="token operator">+</span> <span class="token class-name">File</span><span class="token punctuation">.</span>separator <span class="token operator">+</span> inputFilePath<span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            <span class="token comment">// 获取过滤后的文件列表（不会存在目录）</span>
            <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">File</span><span class="token punctuation">&gt;</span></span> fileList <span class="token operator">=</span> <span class="token class-name">FileFilter</span><span class="token punctuation">.</span><span class="token function">doFilter</span><span class="token punctuation">(</span>inputFilePath<span class="token punctuation">,</span> fileInfoConfig<span class="token punctuation">.</span><span class="token function">getFilterConfigList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">File</span> file <span class="token operator">:</span> fileList<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token class-name">Meta<span class="token punctuation">.</span>FileConfig<span class="token punctuation">.</span>FileInfo</span> fileInfo <span class="token operator">=</span> <span class="token function">makeFileTemplate</span><span class="token punctuation">(</span>templateMakerModelConfig<span class="token punctuation">,</span> sourceRootPath<span class="token punctuation">,</span> file<span class="token punctuation">)</span><span class="token punctuation">;</span>
                newFileInfoList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>fileInfo<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>

        <span class="token comment">// 如果是文件组</span>
        <span class="token class-name">TemplateMakerFileConfig<span class="token punctuation">.</span>FileGroupConfig</span> fileGroupConfig <span class="token operator">=</span> templateMakerFileConfig<span class="token punctuation">.</span><span class="token function">getFileGroupConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>fileGroupConfig <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">String</span> condition <span class="token operator">=</span> fileGroupConfig<span class="token punctuation">.</span><span class="token function">getCondition</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">String</span> groupKey <span class="token operator">=</span> fileGroupConfig<span class="token punctuation">.</span><span class="token function">getGroupKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">String</span> groupName <span class="token operator">=</span> fileGroupConfig<span class="token punctuation">.</span><span class="token function">getGroupName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment">// 新增分组配置</span>
            <span class="token class-name">Meta<span class="token punctuation">.</span>FileConfig<span class="token punctuation">.</span>FileInfo</span> groupFileInfo <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Meta<span class="token punctuation">.</span>FileConfig<span class="token punctuation">.</span>FileInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            groupFileInfo<span class="token punctuation">.</span><span class="token function">setType</span><span class="token punctuation">(</span><span class="token class-name">FileTypeEnum</span><span class="token punctuation">.</span><span class="token constant">GROUP</span><span class="token punctuation">.</span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            groupFileInfo<span class="token punctuation">.</span><span class="token function">setCondition</span><span class="token punctuation">(</span>condition<span class="token punctuation">)</span><span class="token punctuation">;</span>
            groupFileInfo<span class="token punctuation">.</span><span class="token function">setGroupKey</span><span class="token punctuation">(</span>groupKey<span class="token punctuation">)</span><span class="token punctuation">;</span>
            groupFileInfo<span class="token punctuation">.</span><span class="token function">setGroupName</span><span class="token punctuation">(</span>groupName<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// 文件全放到一个分组内</span>
            groupFileInfo<span class="token punctuation">.</span><span class="token function">setFiles</span><span class="token punctuation">(</span>newFileInfoList<span class="token punctuation">)</span><span class="token punctuation">;</span>
            newFileInfoList <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            newFileInfoList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>groupFileInfo<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token comment">// 处理模型信息</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">TemplateMakerModelConfig<span class="token punctuation">.</span>ModelInfoConfig</span><span class="token punctuation">&gt;</span></span> models <span class="token operator">=</span> templateMakerModelConfig<span class="token punctuation">.</span><span class="token function">getModels</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// - 转换为配置接受的 ModelInfo 对象</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Meta<span class="token punctuation">.</span>ModelConfig<span class="token punctuation">.</span>ModelInfo</span><span class="token punctuation">&gt;</span></span> inputModelInfoList <span class="token operator">=</span> models<span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>modelInfoConfig <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            <span class="token class-name">Meta<span class="token punctuation">.</span>ModelConfig<span class="token punctuation">.</span>ModelInfo</span> modelInfo <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Meta<span class="token punctuation">.</span>ModelConfig<span class="token punctuation">.</span>ModelInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">BeanUtil</span><span class="token punctuation">.</span><span class="token function">copyProperties</span><span class="token punctuation">(</span>modelInfoConfig<span class="token punctuation">,</span> modelInfo<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> modelInfo<span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span><span class="token class-name">Collectors</span><span class="token punctuation">.</span><span class="token function">toList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// - 本次新增的模型配置列表</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Meta<span class="token punctuation">.</span>ModelConfig<span class="token punctuation">.</span>ModelInfo</span><span class="token punctuation">&gt;</span></span> newModelInfoList <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// - 如果是模型组</span>
        <span class="token class-name">TemplateMakerModelConfig<span class="token punctuation">.</span>ModelGroupConfig</span> modelGroupConfig <span class="token operator">=</span> templateMakerModelConfig<span class="token punctuation">.</span><span class="token function">getModelGroupConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>modelGroupConfig <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">String</span> condition <span class="token operator">=</span> modelGroupConfig<span class="token punctuation">.</span><span class="token function">getCondition</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">String</span> groupKey <span class="token operator">=</span> modelGroupConfig<span class="token punctuation">.</span><span class="token function">getGroupKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">String</span> groupName <span class="token operator">=</span> modelGroupConfig<span class="token punctuation">.</span><span class="token function">getGroupName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">Meta<span class="token punctuation">.</span>ModelConfig<span class="token punctuation">.</span>ModelInfo</span> groupModelInfo <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Meta<span class="token punctuation">.</span>ModelConfig<span class="token punctuation">.</span>ModelInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            groupModelInfo<span class="token punctuation">.</span><span class="token function">setGroupKey</span><span class="token punctuation">(</span>groupKey<span class="token punctuation">)</span><span class="token punctuation">;</span>
            groupModelInfo<span class="token punctuation">.</span><span class="token function">setGroupName</span><span class="token punctuation">(</span>groupName<span class="token punctuation">)</span><span class="token punctuation">;</span>
            groupModelInfo<span class="token punctuation">.</span><span class="token function">setCondition</span><span class="token punctuation">(</span>condition<span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment">// 模型全放到一个分组内</span>
            groupModelInfo<span class="token punctuation">.</span><span class="token function">setModels</span><span class="token punctuation">(</span>inputModelInfoList<span class="token punctuation">)</span><span class="token punctuation">;</span>
            newModelInfoList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>groupModelInfo<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token comment">// 不分组，添加所有的模型信息到列表</span>
            newModelInfoList<span class="token punctuation">.</span><span class="token function">addAll</span><span class="token punctuation">(</span>inputModelInfoList<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token comment">// 三、生成配置文件</span>
        <span class="token class-name">String</span> metaOutputPath <span class="token operator">=</span> sourceRootPath <span class="token operator">+</span> <span class="token class-name">File</span><span class="token punctuation">.</span>separator <span class="token operator">+</span> <span class="token string">&quot;meta.json&quot;</span><span class="token punctuation">;</span>

        <span class="token comment">// 如果已有 meta 文件，说明不是第一次制作，则在 meta 基础上进行修改</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">FileUtil</span><span class="token punctuation">.</span><span class="token function">exist</span><span class="token punctuation">(</span>metaOutputPath<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">Meta</span> oldMeta <span class="token operator">=</span> <span class="token class-name">JSONUtil</span><span class="token punctuation">.</span><span class="token function">toBean</span><span class="token punctuation">(</span><span class="token class-name">FileUtil</span><span class="token punctuation">.</span><span class="token function">readUtf8String</span><span class="token punctuation">(</span>metaOutputPath<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">Meta</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">BeanUtil</span><span class="token punctuation">.</span><span class="token function">copyProperties</span><span class="token punctuation">(</span>newMeta<span class="token punctuation">,</span> oldMeta<span class="token punctuation">,</span> <span class="token class-name">CopyOptions</span><span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ignoreNullValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            newMeta <span class="token operator">=</span> oldMeta<span class="token punctuation">;</span>

            <span class="token comment">// 1. 追加配置参数</span>
            <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Meta<span class="token punctuation">.</span>FileConfig<span class="token punctuation">.</span>FileInfo</span><span class="token punctuation">&gt;</span></span> fileInfoList <span class="token operator">=</span> newMeta<span class="token punctuation">.</span><span class="token function">getFileConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getFiles</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            fileInfoList<span class="token punctuation">.</span><span class="token function">addAll</span><span class="token punctuation">(</span>newFileInfoList<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Meta<span class="token punctuation">.</span>ModelConfig<span class="token punctuation">.</span>ModelInfo</span><span class="token punctuation">&gt;</span></span> modelInfoList <span class="token operator">=</span> newMeta<span class="token punctuation">.</span><span class="token function">getModelConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getModels</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            modelInfoList<span class="token punctuation">.</span><span class="token function">addAll</span><span class="token punctuation">(</span>newModelInfoList<span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment">// 配置去重</span>
            newMeta<span class="token punctuation">.</span><span class="token function">getFileConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setFiles</span><span class="token punctuation">(</span><span class="token function">distinctFiles</span><span class="token punctuation">(</span>fileInfoList<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            newMeta<span class="token punctuation">.</span><span class="token function">getModelConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setModels</span><span class="token punctuation">(</span><span class="token function">distinctModels</span><span class="token punctuation">(</span>modelInfoList<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token comment">// 1. 构造配置参数</span>
            <span class="token class-name">Meta<span class="token punctuation">.</span>FileConfig</span> fileConfig <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Meta<span class="token punctuation">.</span>FileConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            newMeta<span class="token punctuation">.</span><span class="token function">setFileConfig</span><span class="token punctuation">(</span>fileConfig<span class="token punctuation">)</span><span class="token punctuation">;</span>
            fileConfig<span class="token punctuation">.</span><span class="token function">setSourceRootPath</span><span class="token punctuation">(</span>sourceRootPath<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Meta<span class="token punctuation">.</span>FileConfig<span class="token punctuation">.</span>FileInfo</span><span class="token punctuation">&gt;</span></span> fileInfoList <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            fileConfig<span class="token punctuation">.</span><span class="token function">setFiles</span><span class="token punctuation">(</span>fileInfoList<span class="token punctuation">)</span><span class="token punctuation">;</span>
            fileInfoList<span class="token punctuation">.</span><span class="token function">addAll</span><span class="token punctuation">(</span>newFileInfoList<span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token class-name">Meta<span class="token punctuation">.</span>ModelConfig</span> modelConfig <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Meta<span class="token punctuation">.</span>ModelConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            newMeta<span class="token punctuation">.</span><span class="token function">setModelConfig</span><span class="token punctuation">(</span>modelConfig<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Meta<span class="token punctuation">.</span>ModelConfig<span class="token punctuation">.</span>ModelInfo</span><span class="token punctuation">&gt;</span></span> modelInfoList <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            modelConfig<span class="token punctuation">.</span><span class="token function">setModels</span><span class="token punctuation">(</span>modelInfoList<span class="token punctuation">)</span><span class="token punctuation">;</span>
            modelInfoList<span class="token punctuation">.</span><span class="token function">addAll</span><span class="token punctuation">(</span>newModelInfoList<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token comment">// 2. 输出元信息文件</span>
        <span class="token class-name">FileUtil</span><span class="token punctuation">.</span><span class="token function">writeUtf8String</span><span class="token punctuation">(</span><span class="token class-name">JSONUtil</span><span class="token punctuation">.</span><span class="token function">toJsonPrettyStr</span><span class="token punctuation">(</span>newMeta<span class="token punctuation">)</span><span class="token punctuation">,</span> metaOutputPath<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> id<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * 制作文件模板
     *
     * @param templateMakerModelConfig
     * @param sourceRootPath
     * @param inputFile
     * @return
     */</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">Meta<span class="token punctuation">.</span>FileConfig<span class="token punctuation">.</span>FileInfo</span> <span class="token function">makeFileTemplate</span><span class="token punctuation">(</span><span class="token class-name">TemplateMakerModelConfig</span> templateMakerModelConfig<span class="token punctuation">,</span> <span class="token class-name">String</span> sourceRootPath<span class="token punctuation">,</span> <span class="token class-name">File</span> inputFile<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 要挖坑的文件绝对路径（用于制作模板）</span>
        <span class="token comment">// 注意 win 系统需要对路径进行转义</span>
        <span class="token class-name">String</span> fileInputAbsolutePath <span class="token operator">=</span> inputFile<span class="token punctuation">.</span><span class="token function">getAbsolutePath</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">replaceAll</span><span class="token punctuation">(</span><span class="token string">&quot;\\\\&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;/&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> fileOutputAbsolutePath <span class="token operator">=</span> fileInputAbsolutePath <span class="token operator">+</span> <span class="token string">&quot;.ftl&quot;</span><span class="token punctuation">;</span>
    
        <span class="token comment">// 文件输入输出相对路径（用于生成配置）</span>
        <span class="token class-name">String</span> fileInputPath <span class="token operator">=</span> fileInputAbsolutePath<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span>sourceRootPath <span class="token operator">+</span> <span class="token string">&quot;/&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> fileOutputPath <span class="token operator">=</span> fileInputPath <span class="token operator">+</span> <span class="token string">&quot;.ftl&quot;</span><span class="token punctuation">;</span>
        
        <span class="token comment">// 使用字符串替换，生成模板文件</span>
        <span class="token class-name">String</span> fileContent<span class="token punctuation">;</span>
        <span class="token comment">// 如果已有模板文件，说明不是第一次制作，则在模板基础上再次挖坑</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">FileUtil</span><span class="token punctuation">.</span><span class="token function">exist</span><span class="token punctuation">(</span>fileOutputAbsolutePath<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            fileContent <span class="token operator">=</span> <span class="token class-name">FileUtil</span><span class="token punctuation">.</span><span class="token function">readUtf8String</span><span class="token punctuation">(</span>fileOutputAbsolutePath<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            fileContent <span class="token operator">=</span> <span class="token class-name">FileUtil</span><span class="token punctuation">.</span><span class="token function">readUtf8String</span><span class="token punctuation">(</span>fileInputAbsolutePath<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token comment">// 支持多个模型：对同一个文件的内容，遍历模型进行多轮替换</span>
        <span class="token class-name">TemplateMakerModelConfig<span class="token punctuation">.</span>ModelGroupConfig</span> modelGroupConfig <span class="token operator">=</span> templateMakerModelConfig<span class="token punctuation">.</span><span class="token function">getModelGroupConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> newFileContent <span class="token operator">=</span> fileContent<span class="token punctuation">;</span>
        <span class="token class-name">String</span> replacement<span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">TemplateMakerModelConfig<span class="token punctuation">.</span>ModelInfoConfig</span> modelInfoConfig <span class="token operator">:</span> templateMakerModelConfig<span class="token punctuation">.</span><span class="token function">getModels</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// 不是分组</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>modelGroupConfig <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                replacement <span class="token operator">=</span> <span class="token class-name">String</span><span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token string">&quot;${%s}&quot;</span><span class="token punctuation">,</span> modelInfoConfig<span class="token punctuation">.</span><span class="token function">getFieldName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                <span class="token comment">// 是分组</span>
                <span class="token class-name">String</span> groupKey <span class="token operator">=</span> modelGroupConfig<span class="token punctuation">.</span><span class="token function">getGroupKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token comment">// 注意挖坑要多一个层级</span>
                replacement <span class="token operator">=</span> <span class="token class-name">String</span><span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token string">&quot;${%s.%s}&quot;</span><span class="token punctuation">,</span> groupKey<span class="token punctuation">,</span> modelInfoConfig<span class="token punctuation">.</span><span class="token function">getFieldName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token comment">// 多次替换</span>
            newFileContent <span class="token operator">=</span> <span class="token class-name">StrUtil</span><span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span>newFileContent<span class="token punctuation">,</span> modelInfoConfig<span class="token punctuation">.</span><span class="token function">getReplaceText</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> replacement<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token comment">// 文件配置信息</span>
        <span class="token class-name">Meta<span class="token punctuation">.</span>FileConfig<span class="token punctuation">.</span>FileInfo</span> fileInfo <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Meta<span class="token punctuation">.</span>FileConfig<span class="token punctuation">.</span>FileInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        fileInfo<span class="token punctuation">.</span><span class="token function">setInputPath</span><span class="token punctuation">(</span>fileInputPath<span class="token punctuation">)</span><span class="token punctuation">;</span>
        fileInfo<span class="token punctuation">.</span><span class="token function">setOutputPath</span><span class="token punctuation">(</span>fileOutputPath<span class="token punctuation">)</span><span class="token punctuation">;</span>
        fileInfo<span class="token punctuation">.</span><span class="token function">setType</span><span class="token punctuation">(</span><span class="token class-name">FileTypeEnum</span><span class="token punctuation">.</span><span class="token constant">FILE</span><span class="token punctuation">.</span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 和原文件一致，没有挖坑，则为静态生成</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>newFileContent<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>fileContent<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// 输出路径 = 输入路径</span>
            fileInfo<span class="token punctuation">.</span><span class="token function">setOutputPath</span><span class="token punctuation">(</span>fileInputPath<span class="token punctuation">)</span><span class="token punctuation">;</span>
            fileInfo<span class="token punctuation">.</span><span class="token function">setGenerateType</span><span class="token punctuation">(</span><span class="token class-name">FileGenerateTypeEnum</span><span class="token punctuation">.</span><span class="token constant">STATIC</span><span class="token punctuation">.</span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token comment">// 生成模板文件</span>
            fileInfo<span class="token punctuation">.</span><span class="token function">setGenerateType</span><span class="token punctuation">(</span><span class="token class-name">FileGenerateTypeEnum</span><span class="token punctuation">.</span><span class="token constant">DYNAMIC</span><span class="token punctuation">.</span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">FileUtil</span><span class="token punctuation">.</span><span class="token function">writeUtf8String</span><span class="token punctuation">(</span>newFileContent<span class="token punctuation">,</span> fileOutputAbsolutePath<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> fileInfo<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Meta</span> meta <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Meta</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        meta<span class="token punctuation">.</span><span class="token function">setName</span><span class="token punctuation">(</span><span class="token string">&quot;acm-template-generator&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        meta<span class="token punctuation">.</span><span class="token function">setDescription</span><span class="token punctuation">(</span><span class="token string">&quot;ACM 示例模板生成器&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">String</span> projectPath <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">getProperty</span><span class="token punctuation">(</span><span class="token string">&quot;user.dir&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> originProjectPath <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span>projectPath<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getParent</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token class-name">File</span><span class="token punctuation">.</span>separator <span class="token operator">+</span> <span class="token string">&quot;yuzi-generator-demo-projects/springboot-init&quot;</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> inputFilePath1 <span class="token operator">=</span> <span class="token string">&quot;src/main/java/com/yupi/springbootinit/common&quot;</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> inputFilePath2 <span class="token operator">=</span> <span class="token string">&quot;src/main/resources/application.yml&quot;</span><span class="token punctuation">;</span>

        <span class="token comment">// 模型参数配置</span>
        <span class="token class-name">TemplateMakerModelConfig</span> templateMakerModelConfig <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">TemplateMakerModelConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// - 模型组配置</span>
        <span class="token class-name">TemplateMakerModelConfig<span class="token punctuation">.</span>ModelGroupConfig</span> modelGroupConfig <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">TemplateMakerModelConfig<span class="token punctuation">.</span>ModelGroupConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        modelGroupConfig<span class="token punctuation">.</span><span class="token function">setGroupKey</span><span class="token punctuation">(</span><span class="token string">&quot;mysql&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        modelGroupConfig<span class="token punctuation">.</span><span class="token function">setGroupName</span><span class="token punctuation">(</span><span class="token string">&quot;数据库配置&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        templateMakerModelConfig<span class="token punctuation">.</span><span class="token function">setModelGroupConfig</span><span class="token punctuation">(</span>modelGroupConfig<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// - 模型配置</span>
        <span class="token class-name">TemplateMakerModelConfig<span class="token punctuation">.</span>ModelInfoConfig</span> modelInfoConfig1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">TemplateMakerModelConfig<span class="token punctuation">.</span>ModelInfoConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        modelInfoConfig1<span class="token punctuation">.</span><span class="token function">setFieldName</span><span class="token punctuation">(</span><span class="token string">&quot;url&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        modelInfoConfig1<span class="token punctuation">.</span><span class="token function">setType</span><span class="token punctuation">(</span><span class="token string">&quot;String&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        modelInfoConfig1<span class="token punctuation">.</span><span class="token function">setDefaultValue</span><span class="token punctuation">(</span><span class="token string">&quot;jdbc:mysql://localhost:3306/my_db&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        modelInfoConfig1<span class="token punctuation">.</span><span class="token function">setReplaceText</span><span class="token punctuation">(</span><span class="token string">&quot;jdbc:mysql://localhost:3306/my_db&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">TemplateMakerModelConfig<span class="token punctuation">.</span>ModelInfoConfig</span> modelInfoConfig2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">TemplateMakerModelConfig<span class="token punctuation">.</span>ModelInfoConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        modelInfoConfig2<span class="token punctuation">.</span><span class="token function">setFieldName</span><span class="token punctuation">(</span><span class="token string">&quot;username&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        modelInfoConfig2<span class="token punctuation">.</span><span class="token function">setType</span><span class="token punctuation">(</span><span class="token string">&quot;String&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        modelInfoConfig2<span class="token punctuation">.</span><span class="token function">setDefaultValue</span><span class="token punctuation">(</span><span class="token string">&quot;root&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        modelInfoConfig2<span class="token punctuation">.</span><span class="token function">setReplaceText</span><span class="token punctuation">(</span><span class="token string">&quot;root&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">TemplateMakerModelConfig<span class="token punctuation">.</span>ModelInfoConfig</span><span class="token punctuation">&gt;</span></span> modelInfoConfigList <span class="token operator">=</span> <span class="token class-name">Arrays</span><span class="token punctuation">.</span><span class="token function">asList</span><span class="token punctuation">(</span>modelInfoConfig1<span class="token punctuation">,</span> modelInfoConfig2<span class="token punctuation">)</span><span class="token punctuation">;</span>
        templateMakerModelConfig<span class="token punctuation">.</span><span class="token function">setModels</span><span class="token punctuation">(</span>modelInfoConfigList<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 替换变量（首次）</span>
<span class="token comment">//        String searchStr = &quot;Sum: &quot;;</span>
        <span class="token comment">// 替换变量（第二次）</span>
        <span class="token class-name">String</span> searchStr <span class="token operator">=</span> <span class="token string">&quot;BaseResponse&quot;</span><span class="token punctuation">;</span>

        <span class="token comment">// 文件过滤</span>
        <span class="token class-name">TemplateMakerFileConfig</span> templateMakerFileConfig <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">TemplateMakerFileConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">TemplateMakerFileConfig<span class="token punctuation">.</span>FileInfoConfig</span> fileInfoConfig1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">TemplateMakerFileConfig<span class="token punctuation">.</span>FileInfoConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        fileInfoConfig1<span class="token punctuation">.</span><span class="token function">setPath</span><span class="token punctuation">(</span>inputFilePath1<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">FileFilterConfig</span><span class="token punctuation">&gt;</span></span> fileFilterConfigList <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">FileFilterConfig</span> fileFilterConfig <span class="token operator">=</span> <span class="token class-name">FileFilterConfig</span><span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">range</span><span class="token punctuation">(</span><span class="token class-name">FileFilterRangeEnum</span><span class="token punctuation">.</span><span class="token constant">FILE_NAME</span><span class="token punctuation">.</span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">rule</span><span class="token punctuation">(</span><span class="token class-name">FileFilterRuleEnum</span><span class="token punctuation">.</span><span class="token constant">CONTAINS</span><span class="token punctuation">.</span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">value</span><span class="token punctuation">(</span><span class="token string">&quot;Base&quot;</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        fileFilterConfigList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>fileFilterConfig<span class="token punctuation">)</span><span class="token punctuation">;</span>
        fileInfoConfig1<span class="token punctuation">.</span><span class="token function">setFilterConfigList</span><span class="token punctuation">(</span>fileFilterConfigList<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">TemplateMakerFileConfig<span class="token punctuation">.</span>FileInfoConfig</span> fileInfoConfig2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">TemplateMakerFileConfig<span class="token punctuation">.</span>FileInfoConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        fileInfoConfig2<span class="token punctuation">.</span><span class="token function">setPath</span><span class="token punctuation">(</span>inputFilePath2<span class="token punctuation">)</span><span class="token punctuation">;</span>
        templateMakerFileConfig<span class="token punctuation">.</span><span class="token function">setFiles</span><span class="token punctuation">(</span><span class="token class-name">Arrays</span><span class="token punctuation">.</span><span class="token function">asList</span><span class="token punctuation">(</span>fileInfoConfig1<span class="token punctuation">,</span> fileInfoConfig2<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 分组配置</span>
        <span class="token class-name">TemplateMakerFileConfig<span class="token punctuation">.</span>FileGroupConfig</span> fileGroupConfig <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">TemplateMakerFileConfig<span class="token punctuation">.</span>FileGroupConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        fileGroupConfig<span class="token punctuation">.</span><span class="token function">setCondition</span><span class="token punctuation">(</span><span class="token string">&quot;outputText&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        fileGroupConfig<span class="token punctuation">.</span><span class="token function">setGroupKey</span><span class="token punctuation">(</span><span class="token string">&quot;test&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        fileGroupConfig<span class="token punctuation">.</span><span class="token function">setGroupName</span><span class="token punctuation">(</span><span class="token string">&quot;测试分组&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        templateMakerFileConfig<span class="token punctuation">.</span><span class="token function">setFileGroupConfig</span><span class="token punctuation">(</span>fileGroupConfig<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">long</span> id <span class="token operator">=</span> <span class="token function">makeTemplate</span><span class="token punctuation">(</span>meta<span class="token punctuation">,</span> originProjectPath<span class="token punctuation">,</span> templateMakerFileConfig<span class="token punctuation">,</span> templateMakerModelConfig<span class="token punctuation">,</span> <span class="token number">1735281524670181376L</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * 模型去重
     *
     * @param modelInfoList
     * @return
     */</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Meta<span class="token punctuation">.</span>ModelConfig<span class="token punctuation">.</span>ModelInfo</span><span class="token punctuation">&gt;</span></span> <span class="token function">distinctModels</span><span class="token punctuation">(</span><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Meta<span class="token punctuation">.</span>ModelConfig<span class="token punctuation">.</span>ModelInfo</span><span class="token punctuation">&gt;</span></span> modelInfoList<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 策略：同分组内模型 merge，不同分组保留</span>

        <span class="token comment">// 1. 有分组的，以组为单位划分</span>
        <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">List</span><span class="token punctuation">&lt;</span><span class="token class-name">Meta<span class="token punctuation">.</span>ModelConfig<span class="token punctuation">.</span>ModelInfo</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> groupKeyModelInfoListMap <span class="token operator">=</span> modelInfoList
                <span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>modelInfo <span class="token operator">-&gt;</span> <span class="token class-name">StrUtil</span><span class="token punctuation">.</span><span class="token function">isNotBlank</span><span class="token punctuation">(</span>modelInfo<span class="token punctuation">.</span><span class="token function">getGroupKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span>
                        <span class="token class-name">Collectors</span><span class="token punctuation">.</span><span class="token function">groupingBy</span><span class="token punctuation">(</span><span class="token class-name">Meta<span class="token punctuation">.</span>ModelConfig<span class="token punctuation">.</span>ModelInfo</span><span class="token operator">::</span><span class="token function">getGroupKey</span><span class="token punctuation">)</span>
                <span class="token punctuation">)</span><span class="token punctuation">;</span>


        <span class="token comment">// 2. 同组内的模型配置合并</span>
        <span class="token comment">// 保存每个组对应的合并后的对象 map</span>
        <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Meta<span class="token punctuation">.</span>ModelConfig<span class="token punctuation">.</span>ModelInfo</span><span class="token punctuation">&gt;</span></span> groupKeyMergedModelInfoMap <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Map<span class="token punctuation">.</span>Entry</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">List</span><span class="token punctuation">&lt;</span><span class="token class-name">Meta<span class="token punctuation">.</span>ModelConfig<span class="token punctuation">.</span>ModelInfo</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> entry <span class="token operator">:</span> groupKeyModelInfoListMap<span class="token punctuation">.</span><span class="token function">entrySet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Meta<span class="token punctuation">.</span>ModelConfig<span class="token punctuation">.</span>ModelInfo</span><span class="token punctuation">&gt;</span></span> tempModelInfoList <span class="token operator">=</span> entry<span class="token punctuation">.</span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Meta<span class="token punctuation">.</span>ModelConfig<span class="token punctuation">.</span>ModelInfo</span><span class="token punctuation">&gt;</span></span> newModelInfoList <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>tempModelInfoList<span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                    <span class="token punctuation">.</span><span class="token function">flatMap</span><span class="token punctuation">(</span>modelInfo <span class="token operator">-&gt;</span> modelInfo<span class="token punctuation">.</span><span class="token function">getModels</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                    <span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span>
                            <span class="token class-name">Collectors</span><span class="token punctuation">.</span><span class="token function">toMap</span><span class="token punctuation">(</span><span class="token class-name">Meta<span class="token punctuation">.</span>ModelConfig<span class="token punctuation">.</span>ModelInfo</span><span class="token operator">::</span><span class="token function">getFieldName</span><span class="token punctuation">,</span> o <span class="token operator">-&gt;</span> o<span class="token punctuation">,</span> <span class="token punctuation">(</span>e<span class="token punctuation">,</span> r<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> r<span class="token punctuation">)</span>
                    <span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">values</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment">// 使用新的 group 配置</span>
            <span class="token class-name">Meta<span class="token punctuation">.</span>ModelConfig<span class="token punctuation">.</span>ModelInfo</span> newModelInfo <span class="token operator">=</span> <span class="token class-name">CollUtil</span><span class="token punctuation">.</span><span class="token function">getLast</span><span class="token punctuation">(</span>tempModelInfoList<span class="token punctuation">)</span><span class="token punctuation">;</span>
            newModelInfo<span class="token punctuation">.</span><span class="token function">setModels</span><span class="token punctuation">(</span>newModelInfoList<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">String</span> groupKey <span class="token operator">=</span> entry<span class="token punctuation">.</span><span class="token function">getKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            groupKeyMergedModelInfoMap<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>groupKey<span class="token punctuation">,</span> newModelInfo<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token comment">// 3. 将模型分组添加到结果列表</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Meta<span class="token punctuation">.</span>ModelConfig<span class="token punctuation">.</span>ModelInfo</span><span class="token punctuation">&gt;</span></span> resultList <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>groupKeyMergedModelInfoMap<span class="token punctuation">.</span><span class="token function">values</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 4. 将未分组的模型添加到结果列表</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Meta<span class="token punctuation">.</span>ModelConfig<span class="token punctuation">.</span>ModelInfo</span><span class="token punctuation">&gt;</span></span> noGroupModelInfoList <span class="token operator">=</span> modelInfoList<span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>modelInfo <span class="token operator">-&gt;</span> <span class="token class-name">StrUtil</span><span class="token punctuation">.</span><span class="token function">isBlank</span><span class="token punctuation">(</span>modelInfo<span class="token punctuation">.</span><span class="token function">getGroupKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span><span class="token class-name">Collectors</span><span class="token punctuation">.</span><span class="token function">toList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        resultList<span class="token punctuation">.</span><span class="token function">addAll</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>noGroupModelInfoList<span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span>
                        <span class="token class-name">Collectors</span><span class="token punctuation">.</span><span class="token function">toMap</span><span class="token punctuation">(</span><span class="token class-name">Meta<span class="token punctuation">.</span>ModelConfig<span class="token punctuation">.</span>ModelInfo</span><span class="token operator">::</span><span class="token function">getFieldName</span><span class="token punctuation">,</span> o <span class="token operator">-&gt;</span> o<span class="token punctuation">,</span> <span class="token punctuation">(</span>e<span class="token punctuation">,</span> r<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> r<span class="token punctuation">)</span>
                <span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">values</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> resultList<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * 文件去重
     *
     * @param fileInfoList
     * @return
     */</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Meta<span class="token punctuation">.</span>FileConfig<span class="token punctuation">.</span>FileInfo</span><span class="token punctuation">&gt;</span></span> <span class="token function">distinctFiles</span><span class="token punctuation">(</span><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Meta<span class="token punctuation">.</span>FileConfig<span class="token punctuation">.</span>FileInfo</span><span class="token punctuation">&gt;</span></span> fileInfoList<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 策略：同分组内文件 merge，不同分组保留</span>

        <span class="token comment">// 1. 有分组的，以组为单位划分</span>
        <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">List</span><span class="token punctuation">&lt;</span><span class="token class-name">Meta<span class="token punctuation">.</span>FileConfig<span class="token punctuation">.</span>FileInfo</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> groupKeyFileInfoListMap <span class="token operator">=</span> fileInfoList
                <span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>fileInfo <span class="token operator">-&gt;</span> <span class="token class-name">StrUtil</span><span class="token punctuation">.</span><span class="token function">isNotBlank</span><span class="token punctuation">(</span>fileInfo<span class="token punctuation">.</span><span class="token function">getGroupKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span>
                        <span class="token class-name">Collectors</span><span class="token punctuation">.</span><span class="token function">groupingBy</span><span class="token punctuation">(</span><span class="token class-name">Meta<span class="token punctuation">.</span>FileConfig<span class="token punctuation">.</span>FileInfo</span><span class="token operator">::</span><span class="token function">getGroupKey</span><span class="token punctuation">)</span>
                <span class="token punctuation">)</span><span class="token punctuation">;</span>


        <span class="token comment">// 2. 同组内的文件配置合并</span>
        <span class="token comment">// 保存每个组对应的合并后的对象 map</span>
        <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Meta<span class="token punctuation">.</span>FileConfig<span class="token punctuation">.</span>FileInfo</span><span class="token punctuation">&gt;</span></span> groupKeyMergedFileInfoMap <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Map<span class="token punctuation">.</span>Entry</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">List</span><span class="token punctuation">&lt;</span><span class="token class-name">Meta<span class="token punctuation">.</span>FileConfig<span class="token punctuation">.</span>FileInfo</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> entry <span class="token operator">:</span> groupKeyFileInfoListMap<span class="token punctuation">.</span><span class="token function">entrySet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Meta<span class="token punctuation">.</span>FileConfig<span class="token punctuation">.</span>FileInfo</span><span class="token punctuation">&gt;</span></span> tempFileInfoList <span class="token operator">=</span> entry<span class="token punctuation">.</span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Meta<span class="token punctuation">.</span>FileConfig<span class="token punctuation">.</span>FileInfo</span><span class="token punctuation">&gt;</span></span> newFileInfoList <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>tempFileInfoList<span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                    <span class="token punctuation">.</span><span class="token function">flatMap</span><span class="token punctuation">(</span>fileInfo <span class="token operator">-&gt;</span> fileInfo<span class="token punctuation">.</span><span class="token function">getFiles</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                    <span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span>
                            <span class="token class-name">Collectors</span><span class="token punctuation">.</span><span class="token function">toMap</span><span class="token punctuation">(</span><span class="token class-name">Meta<span class="token punctuation">.</span>FileConfig<span class="token punctuation">.</span>FileInfo</span><span class="token operator">::</span><span class="token function">getInputPath</span><span class="token punctuation">,</span> o <span class="token operator">-&gt;</span> o<span class="token punctuation">,</span> <span class="token punctuation">(</span>e<span class="token punctuation">,</span> r<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> r<span class="token punctuation">)</span>
                    <span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">values</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment">// 使用新的 group 配置</span>
            <span class="token class-name">Meta<span class="token punctuation">.</span>FileConfig<span class="token punctuation">.</span>FileInfo</span> newFileInfo <span class="token operator">=</span> <span class="token class-name">CollUtil</span><span class="token punctuation">.</span><span class="token function">getLast</span><span class="token punctuation">(</span>tempFileInfoList<span class="token punctuation">)</span><span class="token punctuation">;</span>
            newFileInfo<span class="token punctuation">.</span><span class="token function">setFiles</span><span class="token punctuation">(</span>newFileInfoList<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">String</span> groupKey <span class="token operator">=</span> entry<span class="token punctuation">.</span><span class="token function">getKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            groupKeyMergedFileInfoMap<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>groupKey<span class="token punctuation">,</span> newFileInfo<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token comment">// 3. 将文件分组添加到结果列表</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Meta<span class="token punctuation">.</span>FileConfig<span class="token punctuation">.</span>FileInfo</span><span class="token punctuation">&gt;</span></span> resultList <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>groupKeyMergedFileInfoMap<span class="token punctuation">.</span><span class="token function">values</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 4. 将未分组的文件添加到结果列表</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Meta<span class="token punctuation">.</span>FileConfig<span class="token punctuation">.</span>FileInfo</span><span class="token punctuation">&gt;</span></span> noGroupFileInfoList <span class="token operator">=</span> fileInfoList<span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>fileInfo <span class="token operator">-&gt;</span> <span class="token class-name">StrUtil</span><span class="token punctuation">.</span><span class="token function">isBlank</span><span class="token punctuation">(</span>fileInfo<span class="token punctuation">.</span><span class="token function">getGroupKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span><span class="token class-name">Collectors</span><span class="token punctuation">.</span><span class="token function">toList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        resultList<span class="token punctuation">.</span><span class="token function">addAll</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>noGroupFileInfoList<span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span>
                        <span class="token class-name">Collectors</span><span class="token punctuation">.</span><span class="token function">toMap</span><span class="token punctuation">(</span><span class="token class-name">Meta<span class="token punctuation">.</span>FileConfig<span class="token punctuation">.</span>FileInfo</span><span class="token operator">::</span><span class="token function">getInputPath</span><span class="token punctuation">,</span> o <span class="token operator">-&gt;</span> o<span class="token punctuation">,</span> <span class="token punctuation">(</span>e<span class="token punctuation">,</span> r<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> r<span class="token punctuation">)</span>
                <span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">values</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> resultList<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br><span class="line-number">103</span><br><span class="line-number">104</span><br><span class="line-number">105</span><br><span class="line-number">106</span><br><span class="line-number">107</span><br><span class="line-number">108</span><br><span class="line-number">109</span><br><span class="line-number">110</span><br><span class="line-number">111</span><br><span class="line-number">112</span><br><span class="line-number">113</span><br><span class="line-number">114</span><br><span class="line-number">115</span><br><span class="line-number">116</span><br><span class="line-number">117</span><br><span class="line-number">118</span><br><span class="line-number">119</span><br><span class="line-number">120</span><br><span class="line-number">121</span><br><span class="line-number">122</span><br><span class="line-number">123</span><br><span class="line-number">124</span><br><span class="line-number">125</span><br><span class="line-number">126</span><br><span class="line-number">127</span><br><span class="line-number">128</span><br><span class="line-number">129</span><br><span class="line-number">130</span><br><span class="line-number">131</span><br><span class="line-number">132</span><br><span class="line-number">133</span><br><span class="line-number">134</span><br><span class="line-number">135</span><br><span class="line-number">136</span><br><span class="line-number">137</span><br><span class="line-number">138</span><br><span class="line-number">139</span><br><span class="line-number">140</span><br><span class="line-number">141</span><br><span class="line-number">142</span><br><span class="line-number">143</span><br><span class="line-number">144</span><br><span class="line-number">145</span><br><span class="line-number">146</span><br><span class="line-number">147</span><br><span class="line-number">148</span><br><span class="line-number">149</span><br><span class="line-number">150</span><br><span class="line-number">151</span><br><span class="line-number">152</span><br><span class="line-number">153</span><br><span class="line-number">154</span><br><span class="line-number">155</span><br><span class="line-number">156</span><br><span class="line-number">157</span><br><span class="line-number">158</span><br><span class="line-number">159</span><br><span class="line-number">160</span><br><span class="line-number">161</span><br><span class="line-number">162</span><br><span class="line-number">163</span><br><span class="line-number">164</span><br><span class="line-number">165</span><br><span class="line-number">166</span><br><span class="line-number">167</span><br><span class="line-number">168</span><br><span class="line-number">169</span><br><span class="line-number">170</span><br><span class="line-number">171</span><br><span class="line-number">172</span><br><span class="line-number">173</span><br><span class="line-number">174</span><br><span class="line-number">175</span><br><span class="line-number">176</span><br><span class="line-number">177</span><br><span class="line-number">178</span><br><span class="line-number">179</span><br><span class="line-number">180</span><br><span class="line-number">181</span><br><span class="line-number">182</span><br><span class="line-number">183</span><br><span class="line-number">184</span><br><span class="line-number">185</span><br><span class="line-number">186</span><br><span class="line-number">187</span><br><span class="line-number">188</span><br><span class="line-number">189</span><br><span class="line-number">190</span><br><span class="line-number">191</span><br><span class="line-number">192</span><br><span class="line-number">193</span><br><span class="line-number">194</span><br><span class="line-number">195</span><br><span class="line-number">196</span><br><span class="line-number">197</span><br><span class="line-number">198</span><br><span class="line-number">199</span><br><span class="line-number">200</span><br><span class="line-number">201</span><br><span class="line-number">202</span><br><span class="line-number">203</span><br><span class="line-number">204</span><br><span class="line-number">205</span><br><span class="line-number">206</span><br><span class="line-number">207</span><br><span class="line-number">208</span><br><span class="line-number">209</span><br><span class="line-number">210</span><br><span class="line-number">211</span><br><span class="line-number">212</span><br><span class="line-number">213</span><br><span class="line-number">214</span><br><span class="line-number">215</span><br><span class="line-number">216</span><br><span class="line-number">217</span><br><span class="line-number">218</span><br><span class="line-number">219</span><br><span class="line-number">220</span><br><span class="line-number">221</span><br><span class="line-number">222</span><br><span class="line-number">223</span><br><span class="line-number">224</span><br><span class="line-number">225</span><br><span class="line-number">226</span><br><span class="line-number">227</span><br><span class="line-number">228</span><br><span class="line-number">229</span><br><span class="line-number">230</span><br><span class="line-number">231</span><br><span class="line-number">232</span><br><span class="line-number">233</span><br><span class="line-number">234</span><br><span class="line-number">235</span><br><span class="line-number">236</span><br><span class="line-number">237</span><br><span class="line-number">238</span><br><span class="line-number">239</span><br><span class="line-number">240</span><br><span class="line-number">241</span><br><span class="line-number">242</span><br><span class="line-number">243</span><br><span class="line-number">244</span><br><span class="line-number">245</span><br><span class="line-number">246</span><br><span class="line-number">247</span><br><span class="line-number">248</span><br><span class="line-number">249</span><br><span class="line-number">250</span><br><span class="line-number">251</span><br><span class="line-number">252</span><br><span class="line-number">253</span><br><span class="line-number">254</span><br><span class="line-number">255</span><br><span class="line-number">256</span><br><span class="line-number">257</span><br><span class="line-number">258</span><br><span class="line-number">259</span><br><span class="line-number">260</span><br><span class="line-number">261</span><br><span class="line-number">262</span><br><span class="line-number">263</span><br><span class="line-number">264</span><br><span class="line-number">265</span><br><span class="line-number">266</span><br><span class="line-number">267</span><br><span class="line-number">268</span><br><span class="line-number">269</span><br><span class="line-number">270</span><br><span class="line-number">271</span><br><span class="line-number">272</span><br><span class="line-number">273</span><br><span class="line-number">274</span><br><span class="line-number">275</span><br><span class="line-number">276</span><br><span class="line-number">277</span><br><span class="line-number">278</span><br><span class="line-number">279</span><br><span class="line-number">280</span><br><span class="line-number">281</span><br><span class="line-number">282</span><br><span class="line-number">283</span><br><span class="line-number">284</span><br><span class="line-number">285</span><br><span class="line-number">286</span><br><span class="line-number">287</span><br><span class="line-number">288</span><br><span class="line-number">289</span><br><span class="line-number">290</span><br><span class="line-number">291</span><br><span class="line-number">292</span><br><span class="line-number">293</span><br><span class="line-number">294</span><br><span class="line-number">295</span><br><span class="line-number">296</span><br><span class="line-number">297</span><br><span class="line-number">298</span><br><span class="line-number">299</span><br><span class="line-number">300</span><br><span class="line-number">301</span><br><span class="line-number">302</span><br><span class="line-number">303</span><br><span class="line-number">304</span><br><span class="line-number">305</span><br><span class="line-number">306</span><br><span class="line-number">307</span><br><span class="line-number">308</span><br><span class="line-number">309</span><br><span class="line-number">310</span><br><span class="line-number">311</span><br><span class="line-number">312</span><br><span class="line-number">313</span><br><span class="line-number">314</span><br><span class="line-number">315</span><br><span class="line-number">316</span><br><span class="line-number">317</span><br><span class="line-number">318</span><br><span class="line-number">319</span><br><span class="line-number">320</span><br><span class="line-number">321</span><br><span class="line-number">322</span><br><span class="line-number">323</span><br><span class="line-number">324</span><br><span class="line-number">325</span><br><span class="line-number">326</span><br><span class="line-number">327</span><br><span class="line-number">328</span><br><span class="line-number">329</span><br><span class="line-number">330</span><br><span class="line-number">331</span><br><span class="line-number">332</span><br><span class="line-number">333</span><br><span class="line-number">334</span><br><span class="line-number">335</span><br><span class="line-number">336</span><br><span class="line-number">337</span><br><span class="line-number">338</span><br><span class="line-number">339</span><br><span class="line-number">340</span><br><span class="line-number">341</span><br><span class="line-number">342</span><br><span class="line-number">343</span><br><span class="line-number">344</span><br><span class="line-number">345</span><br><span class="line-number">346</span><br><span class="line-number">347</span><br><span class="line-number">348</span><br><span class="line-number">349</span><br><span class="line-number">350</span><br><span class="line-number">351</span><br><span class="line-number">352</span><br><span class="line-number">353</span><br><span class="line-number">354</span><br><span class="line-number">355</span><br><span class="line-number">356</span><br><span class="line-number">357</span><br><span class="line-number">358</span><br><span class="line-number">359</span><br><span class="line-number">360</span><br><span class="line-number">361</span><br><span class="line-number">362</span><br><span class="line-number">363</span><br><span class="line-number">364</span><br><span class="line-number">365</span><br><span class="line-number">366</span><br><span class="line-number">367</span><br><span class="line-number">368</span><br><span class="line-number">369</span><br><span class="line-number">370</span><br><span class="line-number">371</span><br><span class="line-number">372</span><br><span class="line-number">373</span><br><span class="line-number">374</span><br><span class="line-number">375</span><br><span class="line-number">376</span><br><span class="line-number">377</span><br><span class="line-number">378</span><br><span class="line-number">379</span><br><span class="line-number">380</span><br><span class="line-number">381</span><br><span class="line-number">382</span><br><span class="line-number">383</span><br><span class="line-number">384</span><br><span class="line-number">385</span><br><span class="line-number">386</span><br><span class="line-number">387</span><br><span class="line-number">388</span><br><span class="line-number">389</span><br><span class="line-number">390</span><br><span class="line-number">391</span><br><span class="line-number">392</span><br><span class="line-number">393</span><br><span class="line-number">394</span><br><span class="line-number">395</span><br><span class="line-number">396</span><br><span class="line-number">397</span><br><span class="line-number">398</span><br></div></div><h2 id="最后"><a href="#最后" class="header-anchor">#</a> 最后</h2> <p>以上就是本节教程，我们给制作工具项目增加了模板制作功能，能够根据用户指定的文件和模型参数快速生成模板和元信息配置。并且支持了单次制作多个模板、文件过滤、文件分组、模型分组等多个功能。</p> <p>本节教程涉及到大量的编码，在编码中，其实蕴含了很多小技巧，比如 Lambda 表达式编程、复用变量、抽象封装方法等。建议大家自己实现这些代码，锻炼一下自己的逻辑思维能力。</p> <p>在下节教程中，我们将进一步完善模板制作工具，并且使用本阶段开发的制作工具，来快速制作 Spring Boot 项目模板代码生成器。</p></div></div> <!----> <div class="page-edit"><!----> <div class="tags"><a href="/tags/?tag=%E6%98%9F%E7%90%83%E9%A1%B9%E7%9B%AE" title="标签">#星球项目</a><a href="/tags/?tag=%E4%BB%A3%E7%A0%81%E7%94%9F%E6%88%90%E5%99%A8" title="标签">#代码生成器</a></div> <!----></div> <div class="page-nav-wapper"><div class="page-nav-centre-wrap"><a href="/pages/b972ff/" class="page-nav-centre page-nav-centre-prev"><div class="tooltip">命令行开发</div></a> <!----></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/pages/b972ff/" class="prev">命令行开发</a></span> <!----></p></div></div></div> <div class="article-list"><div class="article-title"><a href="/archives/" class="iconfont icon-bi">最近更新</a></div> <div class="article-wrapper"><dl><dd>01</dd> <dt><a href="/pages/2e0a98/"><div>
            暂停windows更新
            <span class="title-tag">
              原创
            </span></div></a> <span class="date">07-30</span></dt></dl><dl><dd>02</dd> <dt><a href="/pages/eff348/"><div>
            关联到已存在的 GitHub 仓库
            <span class="title-tag">
              原创
            </span></div></a> <span class="date">07-28</span></dt></dl><dl><dd>03</dd> <dt><a href="/pages/f02c4b/"><div>
            numpy
            <span class="title-tag">
              原创
            </span></div></a> <span class="date">07-24</span></dt></dl><dl><dd>04</dd> <dt><a href="/pages/cf83bf/"><div>
            pandas 基础操作
            <span class="title-tag">
              原创
            </span></div></a> <span class="date">07-24</span></dt></dl><dl><dd>05</dd> <dt><a href="/pages/27beb1/"><div>
            node后端部署
            <span class="title-tag">
              原创
            </span></div></a> <span class="date">04-10</span></dt></dl> <dl><dd></dd> <dt><a href="/archives/" class="more">更多文章&gt;</a></dt></dl></div></div></main></div> <div class="footer"><div class="icons"><a href="https://github.com/xugaoyi/vuepress-theme-vdoing" title="github" target="_blank" class="iconfont icon-github"></a><a href="https://mail.163.com/js6/main.jsp?sid=YAoleRcXgSntbqVGwDXXGltbASZPXVBD&amp;df=mail163_letter#module=compose.ComposeModule%7C%7B%22type%22%3A%22compose%22%2C%22fullScreen%22%3Atrue%2C%22cid%22%3A%22c%3A1702008591824%22%7D" title="邮件" target="_blank" class="iconfont icon-youjian"></a><a href="https://qm.qq.com/q/1qZrTBvhuU" title="QQ" target="_blank" class="iconfont icon-QQ"></a><a href=" https://b23.tv/XXqWiXR" title="哔哩哔哩" target="_blank" class="iconfont icon-bilibili"></a></div> 
    Copyright © 2023-2025
    <span><a target="_blank" href="https://github.com/liyao52033/vuepress-default">liyao52033</a></span></div> <div class="buttons"><div title="返回顶部" class="button blur go-to-top iconfont icon-fanhuidingbu" style="display:none;"></div> <div title="去评论" class="button blur go-to-comment iconfont icon-pinglun" style="display:none;"></div> <div title="主题模式" class="button blur theme-mode-but iconfont icon-zhuti"><ul class="select-box" style="display:none;"><li class="iconfont icon-zidong">
          跟随系统
        </li><li class="iconfont icon-rijianmoshi">
          浅色模式
        </li><li class="iconfont icon-yejianmoshi">
          深色模式
        </li><li class="iconfont icon-yuedu">
          阅读模式
        </li></ul></div></div> <div class="body-bg" style="background:url() center center / cover no-repeat;opacity:0.5;"></div> <!----> <!----></div><div class="global-ui"><div></div><div></div><div></div></div></div>
    <script src="/assets/js/app.0e4893f0.js" defer></script><script src="/assets/js/3.68e95ad6.js" defer></script><script src="/assets/js/2.56a7fb29.js" defer></script><script src="/assets/js/102.e765a012.js" defer></script><script src="/assets/js/25.571f3d43.js" defer></script><script src="/assets/js/45.ab1d84cf.js" defer></script><script src="/assets/js/44.6f56586a.js" defer></script>
  </body>
</html>
